# Created by Danny Tsang <danny@tsang.uk>
# Bed
- id: "1601641236163"
  alias: "^Bedroom: Close Blinds When Someone Is In Bed After Sunset"
  description: ""
  trigger:
    - platform: state
      entity_id: binary_sensor.bed_occupied
      from: "off"
      to: "on"
      for: 00:00:30
  condition:
    - condition: state
      entity_id: cover.bedroom_blind
      state: open
    - condition: state
      entity_id: input_boolean.enable_bedroom_blind_automations
      state: "on"
    - condition: sun
      after: sunset
    - condition: state
      entity_id: binary_sensor.bedroom_window
      state: "off"
  action:
    - data:
        title: Close bedroom blinds
        message:
          ":sleeping_accommodation: :window: Someone is in bed ({{states('sensor.bed_sensor')}}),
          bedroom window is closed and it's getting late. Closing blinds."
      service: script.post_to_home_log
    - service: cover.close_cover
      target:
        entity_id: cover.bedroom_blind
  mode: single
- id: "1600127180656"
  alias: "^Bedroom: Close Blinds Before Sunrise"
  description: ""
  trigger:
    - event: sunrise
      offset: -02:00:00
      platform: sun
  condition:
    - condition: device
      device_id: e5a40dac52c048169af0a3120fd75346
      domain: cover
      entity_id: cover.bedroom_blind
      type: is_open
  action:
    - data:
        message:
          ":sunrise: Bedroom blind is open and it's nearly sunrise. Closing
          blinds"
      service: script.post_to_home_log
    - service: cover.close_cover
      target:
        entity_id: cover.bedroom_blind
  mode: single
# Bed Notifications
- id: "1615208851217"
  alias: "^Bedroom: One Person In Bed Notification"
  description: ""
  trigger:
    - platform: numeric_state
      entity_id: sensor.bed_sensor
      above: "100"
      below: "600"
  condition: []
  action:
    - data:
        title: Close bedroom blinds
        message: ":sleeping_accommodation: One person is in bed"
      service: script.post_to_home_log
  mode: single
- id: "1615209203993"
  alias: "^Bedroom: Someone Getting Out Of Bed Notification"
  description: ""
  trigger:
    - platform: numeric_state
      entity_id: sensor.bed_sensor
      above: "100"
      below: "600"
  condition: []
  action:
    - data:
        title: Close bedroom blinds
        message: ":sleeping_accommodation: One person got out of bed. One person left."
      service: script.post_to_home_log
  mode: single
- id: "1615209163907"
  alias: "^Bedroom: Two People In Bed Notification"
  description: ""
  trigger:
    - platform: numeric_state
      entity_id: sensor.bed_sensor
      above: "600"
  condition: []
  action:
    - data:
        title: Close bedroom blinds
        message:
          ":sleeping_accommodation: An extra person got into Bed. There are now
          two people are in bed."
      service: script.post_to_home_log
  mode: single
- id: "1615689096351"
  alias: "^Bedroom: Window Closed And Someone Is In Bed At Night"
  description: ""
  trigger:
    - platform: state
      entity_id: binary_sensor.bedroom_window
      from: "on"
      to: "off"
      for: 00:00:30
  condition:
    - condition: state
      entity_id: binary_sensor.bed_occupied
      state: "on"
    - condition: state
      entity_id: cover.bedroom_blind
      state: open
    - condition: state
      entity_id: input_boolean.enable_bedroom_blind_automations
      state: "on"
    - condition: sun
      after: sunset
  action:
    - service: script.post_to_home_log
      data:
        title: Close bedroom blinds
        message:
          ":sleeping_accommodation: :window: Bedroom window shut, someone is
          in bed ({{states('sensor.bed_sensor')}}) and it's getting late. Closing
          blinds."
    - service: cover.close_cover
      target:
        entity_id: cover.bedroom_blind
  mode: single
- id: "1601641292576"
  alias: "^Bedroom: Open Blind When No One Is In Bed"
  description: ""
  trigger:
    - platform: state
      entity_id: binary_sensor.bed_occupied
      from: "on"
      to: "off"
      for: 00:00:30
  condition:
    - condition: state
      entity_id: cover.bedroom_blind
      state: closed
    - condition: sun
      after: sunrise
      after_offset: -01:00:00
      before: sunset
    - condition: state
      entity_id: input_boolean.enable_bedroom_blind_automations
      state: "on"
  action:
    - delay: 00:01:00
    - data:
        title: Open Blinds
        message:
          ":bed: :window: No one is in bed ({{states('sensor.bed_sensor')}}).
          Opening the blinds."
      service: script.post_to_home_log
    - service: cover.open_cover
      target:
        entity_id: cover.bedroom_blind
  mode: single
# TV
- id: "1612997966835"
  alias: "^Bedroom: NowTv Playing"
  description: ""
  trigger:
    - platform: state
      entity_id: media_player.nowtv_stick
      to: playing
  condition: []
  action:
    - service: script.post_to_home_log
      data:
        message:
          ":tv: NowTv is playing {{ state_attr('media_player.nowtv_stick',
          'app_name') }}"
  mode: queued
  max: 10
# Plugs / switches
- id: "1581800266867"
  alias: "^Turn off Electric Blanket After 1 hour"
  description: ""
  trigger:
    - entity_id: switch.blanket
      for: 01:00:00
      platform: state
      to: "'on'"
  condition: []
  action:
    - data: {}
      entity_id: switch.blanket
      service: switch.turn_off
    - data:
        message: Electric blanket has been on for 1 hour. Turning electric blanket off.
      service: script.post_to_home_log
