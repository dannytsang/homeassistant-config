# Created by Danny Tsang <danny@tsang.uk>
# Bed
- id: "1601641292576"
  alias: "Bedroom: Open Blind No One Is In Bed"
  description: ""
  trigger:
    - platform: state
      entity_id: binary_sensor.bed_occupied
      from: "on"
      to: "off"
      for: 00:00:30
  condition:
    - condition: device
      device_id: e5a40dac52c048169af0a3120fd75346
      domain: cover
      entity_id: cover.bedroom_blind
      type: is_closed
    - condition: sun
      after: sunrise
      after_offset: -01:00:00
      before: sunset
    - condition: state
      entity_id: input_boolean.enable_bedroom_blind_automations
      state: "on"
  action:
    - delay: 00:01:00
    - data:
        title: Open Blinds
        message: ":bed: :window: No one is in bed ({{states('sensor.bed_sensor')}}). Opening the blinds"
      service: script.post_to_home_log
    - device_id: e5a40dac52c048169af0a3120fd75346
      domain: cover
      entity_id: cover.bedroom_blind
      position: 100
      type: set_position
  mode: single
- id: "1601641236163"
  alias: "Bedroom: Close Blinds When Someone Is In Bed After Sunset"
  description: ""
  trigger:
    - platform: state
      entity_id: binary_sensor.bed_occupied
      from: "off"
      to: "on"
      for: 00:00:30
  condition:
    - condition: device
      device_id: e5a40dac52c048169af0a3120fd75346
      domain: cover
      entity_id: cover.bedroom_blind
      type: is_open
    - condition: state
      entity_id: input_boolean.enable_bedroom_blind_automations
      state: "on"
    - condition: sun
      after: sunset
  action:
    - data:
        title: Close bedroom blinds
        message:
          ":sleeping_accommodation: :window: Someone is in bed ({{states('sensor.bed_sensor')}}), bedroom window is closed
          and it's getting late. Closing blinds."
      service: script.post_to_home_log
    - device_id: e5a40dac52c048169af0a3120fd75346
      domain: cover
      entity_id: cover.bedroom_blind
      position: 0
      type: set_position
  mode: single
- id: "1600127180656"
  alias: "Bedroom: Close Blinds Before Sunrise"
  description: ""
  trigger:
    - event: sunrise
      offset: -02:00:00
      platform: sun
  condition:
    - condition: device
      device_id: e5a40dac52c048169af0a3120fd75346
      domain: cover
      entity_id: cover.bedroom_blind
      type: is_open
  action:
    - data:
        message:
          ":sunrise: Bedroom blind is open and it's nearly sunrise. Closing
          blinds"
      service: script.post_to_home_log
    - device_id: e5a40dac52c048169af0a3120fd75346
      domain: cover
      entity_id: cover.bedroom_blind
      position: 0
      type: set_position
  mode: single
# TV
- id: "1612997966835"
  alias: "Bedroom: NowTv Playing"
  description: ""
  trigger:
    - platform: state
      entity_id: media_player.nowtv_stick
      to: playing
  condition: []
  action:
    - service: script.post_to_home_log
      data:
        message:
          ":tv: NowTv is playing {{ state_attr('media_player.nowtv_stick',
          'app_name') }}"
  mode: queued
  max: 10
# Plugs / switches
- id: "1581800266867"
  alias: Turn off Electric Blanket After 1 hour
  description: ""
  trigger:
    - entity_id: switch.blanket
      for: 01:00:00
      platform: state
      to: "'on'"
  condition: []
  action:
    - data: {}
      entity_id: switch.blanket
      service: switch.turn_off
    - data:
        message: Electric blanket has been on for 1 hour. Turning electric blanket off.
      service: script.post_to_home_log
