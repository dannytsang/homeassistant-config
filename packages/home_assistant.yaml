# Created by Danny Tsang <danny@tsang.uk>
automation:
  - id: "1608489438291"
    alias: "Home Assistant: Shutdown"
    description: ""
    trigger:
      - platform: homeassistant
        event: shutdown
    condition: []
    action:
      - service: script.send_to_home_log
        data:
          message: ":black_square_for_stop: Shutting down."
          title: "Home Assistant"
    mode: single
  - id: "1608489396143"
    alias: "Home Assistant: Start Up"
    description: ""
    trigger:
      - platform: homeassistant
        event: start
    condition: []
    action:
      - service: script.send_to_home_log
        data:
          message: ":arrow_forward: Started."
          title: "Home Assistant"
      - parallel:
          - service: script.send_to_home_log
            data:
              message: "Performing startup checks."
              title: "Home Assistant"
          - service: script.check_terinas_work_laptop_status
            data: {}
          - service: script.3d_printer_check_turn_off_light
    mode: single

sensor:
  - platform: template
    sensors:
      # https://www.reddit.com/r/homeassistant/comments/plmy7e/use_this_template_and_show_us_some_details_about/?utm_medium=android_app&utm_source=share
      total_sensors:
        friendly_name: "Total Sensors"
        icon_template: mdi:radio-tower
        value_template: >-
          {% set ns = namespace(domains=[]) %}
          {%- for s in states -%}
          {%- set ns.domains = (ns.domains + [s.domain])|unique|list -%}
          {%- endfor %}
          {{ states|length }}
        attribute_templates:
          break_down: >-
            {% set ns = namespace(domains=[]) %}
            {%- for s in states -%}
            {%- set ns.domains = (ns.domains + [s.domain])|unique|list -%}
            {%- endfor %}
            [{%- for domain in ns.domains %}
              {"{{ domain }}":{{ states[domain]|length }}},
            {%- endfor %}]
