# Created by Danny Tsang <danny@tsang.uk>
automation:
  #region Motion
  - id: "1606428361967"
    alias: "Office: Motion Detected And Light Is On"
    description:
      "Split automation depending on light state due to dynamic attributes based on state.
      See https://community.home-assistant.io/t/dynamic-attributes/93226/2?u=tuxinator94"
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.office_motion_2_presence
        to: "on"
      - trigger: numeric_state
        entity_id:
          - sensor.office_motion_2_target_distance
        above: 0.1
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_motion_triggers
        state: "on"
      - or:
          - condition: state
            entity_id: light.office_2
            state: "on"
          - condition: state
            entity_id: light.office_3
            state: "on"
    actions:
      - choose:
          - conditions:
              - and:
                  - condition: sun
                    before: sunset
                    before_offset: "-01:00:00"
                  - condition: numeric_state
                    entity_id: sensor.office_motion_2_illuminance_lux
                    above: input_number.office_light_level_threshold
              - not:
                  - condition: state
                    entity_id: sensor.office_motion_2_illuminance_lux
                    state: "unavailable"
            sequence:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :paw_prints: :bulb: :high_brightness: Motion detected in the office
                        but it's bright enough ({{ states('sensor.office_motion_2_illuminance_lux') }} >
                        {{ states('input_number.office_light_level_threshold', with_unit=True) }}).
                        Skipping turning light on.
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: timer.cancel
                    data: {}
                    target:
                      entity_id: timer.office_lights_off
          - conditions:
              - and:
                  - condition: numeric_state
                    entity_id: sensor.office_motion_2_illuminance_lux
                    below: input_number.office_light_level_threshold
                  - or:
                      - condition: numeric_state
                        entity_id: light.office_2
                        attribute: brightness
                        below: "200"
                      - condition: numeric_state
                        entity_id: light.office_3
                        attribute: brightness
                        below: "200"
            sequence:
              - parallel:
                  - action: scene.turn_on
                    target:
                      entity_id: scene.office_main_light_on
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :paw_prints: :bulb: :high_brightness: Motion detected in the office
                        and it's dark ({{ states('sensor.office_motion_2_illuminance_lux') }} <
                        {{ states('input_number.office_light_level_threshold', with_unit=True) }}).
                        Turning up :bulb: :high_brightness: lights.
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: timer.cancel
                    data: {}
                    target:
                      entity_id: timer.office_lights_off
          - conditions:
              - and:
                  - or:
                      - condition: numeric_state
                        entity_id: sensor.office_motion_2_illuminance_lux
                        above: input_number.office_light_level_threshold
                      - condition: state
                        entity_id: sensor.office_motion_2_illuminance_lux
                        state: "unavailable"
                  - or:
                      - condition: numeric_state
                        entity_id: light.office_2
                        attribute: brightness
                        below: "200"
                      - condition: numeric_state
                        entity_id: light.office_3
                        attribute: brightness
                        below: "200"
            sequence:
              - parallel:
                  - action: scene.turn_on
                    target:
                      entity_id: scene.office_main_light_off
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :paw_prints: :bulb: :high_brightness: Motion detected in the office
                        and bright ({{ states('sensor.office_motion_2_illuminance_lux') }} <
                        {{ states('input_number.office_light_level_threshold', with_unit=True) }}).
                        Turning office lights off.
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: timer.cancel
                    data: {}
                    target:
                      entity_id: timer.office_lights_off
          - conditions:
              - condition: state
                entity_id: timer.office_lights_off
                state: "active"
            sequence:
              - parallel:
                  - action: scene.turn_on
                    target:
                      entity_id: scene.office_main_light_off
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :paw_prints: :bulb: :high_brightness: Motion detected in the office
                        Cancelling Timer.
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: timer.cancel
                    data: {}
                    target:
                      entity_id: timer.office_lights_off
        default: []
    mode: queued
    max: 10
  - id: "1632064858461"
    alias: "Office: Motion Detected And Light Is Off"
    description:
      "Split automation depending on light state due to dynamic attributes based on state.
      See https://community.home-assistant.io/t/dynamic-attributes/93226/2?u=tuxinator94"
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.office_motion_2_presence
        to: "on"
      - trigger: numeric_state
        entity_id:
          - sensor.office_motion_2_target_distance
        above: 0.1
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_motion_triggers
        state: "on"
      - or:
          - condition: state
            entity_id: light.office_2
            state: "off"
          - condition: state
            entity_id: light.office_3
            state: "off"
    actions:
      - choose:
          - conditions:
              - or:
                  - and:
                      - condition: sun
                        before: sunset
                        before_offset: "-01:00:00"
                      - condition: numeric_state
                        entity_id: sensor.office_motion_2_illuminance_lux
                        above: input_number.office_light_level_threshold
                  - condition: state
                    entity_id: sensor.office_motion_2_illuminance_lux
                    state: "unavailable"
            sequence:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :paw_prints: :bulb: :high_brightness: Motion detected in the office
                        but it's bright enough ({{ states('sensor.office_motion_2_illuminance_lux') }} >
                        {{ states('input_number.office_light_level_threshold', with_unit=True) }}).
                        Skipping turning light on.
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: timer.cancel
                    data: {}
                    target:
                      entity_id: timer.office_lights_off
                  - sequence:
                      - action: scene.turn_on
                        target:
                          entity_id: scene.office_room_brightness_above_threshold
                        data: {}
                      - delay:
                          seconds: 1
                      - action: light.turn_off
                        target:
                          entity_id:
                            - light.office_4
                        data: {}
        default:
          - parallel:
              - action: scene.turn_on
                target:
                  entity_id: scene.office_main_light_on
              - action: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: :bulb: :high_brightness: Motion detected in the office
                    and it's dark ({{ states('sensor.office_motion_2_illuminance_lux') }} <
                    {{ states('input_number.office_light_level_threshold') }}).
                    Turning :bulb: :high_brightness: lights on.
                  title: ":office: Office"
                  log_level: "Debug"
              - action: timer.cancel
                data: {}
                target:
                  entity_id: timer.office_lights_off
    mode: single
  - id: "1587044886896"
    alias: "Office: No Motion Detected"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sensor.office_motion_2_target_distance
        below: 0.01
        for: 00:02:00
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_motion_triggers
        state: "on"
      - condition: numeric_state
        entity_id: sensor.office_motion_2_target_distance
        below: 0.01
      - condition: state
        entity_id: binary_sensor.office_motion_2_presence
        state: "off"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                :no_pedestrians: No motion in the office. Starting timer for 2 minutes
                before turning lights off.
              title: ":office: Office"
              log_level: "Debug"
          - action: timer.start
            data:
              duration: "00:02:00"
            target:
              entity_id: timer.office_lights_off
    mode: single
  - id: "1587044886897"
    alias: "Office: Office Light Off Timer Finished"
    description: ""
    triggers:
      - trigger: event
        event_type: timer.finished
        event_data:
          entity_id: timer.office_lights_off

    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_motion_triggers
        state: "on"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                :no_pedestrians: No motion in the office for 2 minutes.
                Turning lights off.
              title: ":office: Office"
              log_level: "Debug"
          - action: scene.turn_on
            target:
              entity_id: scene.office_main_light_off
    mode: single
  #endregion
  #region Plugs / switches
  - id: "1622584959878"
    alias: "Office: High Temperature"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sensor.office_area_mean_temperature
        above: "26"
      - trigger: numeric_state
        entity_id: sensor.office_area_mean_temperature
        above: "29"
        for: 00:01:00
      - trigger: numeric_state
        entity_id: sensor.office_area_mean_temperature
        for: 00:01:00
        above: "31"
    conditions:
      - condition: state
        entity_id: switch.office_fan
        state: "off"
    actions:
      - choose:
          - conditions:
              - condition: state
                entity_id: group.adult_people
                state: "home"
              - condition: time
                before: "22:00:00"
              - condition: time
                after: "08:30:00"
            sequence:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message:
                        ":hotsprings: :people_holding_hands: Office temperature is high
                        ({{ states('sensor.office_area_mean_temperature') }}c) and someone is home.
                        Turning on fan."
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: switch.turn_on
                    target:
                      entity_id: switch.office_fan
          - conditions:
              - condition: numeric_state
                entity_id: sensor.office_area_mean_temperature
                above: "29"
            sequence:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :warning: :hotsprings: Office temperature is above 29c
                        ({{ states('sensor.office_area_mean_temperature') }}c).
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: script.send_actionable_notification_with_2_buttons
                    data:
                      message: Turn on office fan?
                      title: â™¨ï¸ðŸ¢Office temperature is 29c+
                      people:
                        - person.danny
                      action1_title: "Yes"
                      action1_name: switch_on_office_fan
                      action2_title: "No"
                      action2_name: ignore
          - conditions:
              - condition: numeric_state
                entity_id: sensor.office_area_mean_temperature
                above: "31"
            sequence:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :warning: :hotsprings: Temperature is above 31c. Turning
                        fan on.
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: switch.turn_on
                    target:
                      entity_id: switch.office_fan
        default: []
    mode: single
  - id: "1728046359271"
    alias: "Office: Fan Switch Is Off"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - climate.office_air_conditioner
        to: unavailable
        for:
          minutes: 5
    conditions:
      - condition: state
        entity_id: switch.office_fan
        state: "off"
    actions:
      - action: script.send_direct_notification
        metadata: {}
        data:
          message: Office Fan switch has turned off.
          title: ":office: Office"
          people:
            entity_id:
              - person.danny
    mode: single
  #endregion
  #region Computer related automations
  - id: "1619865008647"
    alias: "Office: Computer Turned On"
    description: ""
    triggers:
      - trigger: state
        entity_id: group.jd_computer
        from: "not_home"
        to: "home"
    conditions: []
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: "Turned on."
              title: ":desktop_computer: Computer"
              log_level: "Debug"
          - action: switch.turn_on
            target:
              entity_id: switch.goxlr
          - action: script.send_to_home_log
            data:
              message: ":level_slider: Turned on GoXLR."
              title: ":desktop_computer: Computer"
              log_level: "Debug"
          - if:
              - condition: state
                entity_id: switch.office_monitor_bar
                state: "off"
            then:
              - action: switch.turn_on
                target:
                  entity_id: switch.office_monitor_bar
              - action: script.send_to_home_log
                data:
                  message: "Turned on monitor light."
                  title: ":desktop_computer: Computer"
                  log_level: "Debug"
    mode: single
  - id: "1606256309890"
    alias: "Office: Computer Turned Off For A Period Of Time"
    description: ""
    triggers:
      - trigger: state
        entity_id: group.jd_computer
        for: 00:10:00
        to: "not_home"
        from: "home"
        id: router
    conditions:
      - not:
          - condition: state
            entity_id: device_tracker.udm_pro
            state: "unavailable"
    actions:
      - choose:
          - conditions:
              - condition: trigger
                id: router
            sequence:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message: "Turned off for more than 10 minutes."
                      title: ":desktop_computer: Computer"
                      log_level: "Debug"
                  - action: scene.turn_on
                    target:
                      entity_id: scene.office_desk_lights_off
                  - action: script.send_to_home_log
                    data:
                      messsage: Turned off desk lights.
                      log_level: "Debug"
                  - action: switch.turn_off
                    target:
                      entity_id: switch.goxlr
                  - action: script.send_to_home_log
                    data:
                      message: "Turned off for more than 10 minutes. Turned
                        off :level_slider: goXLR"
                      title: ":desktop_computer: Computer"
                      log_level: "Debug"
                  - action: script.office_turn_off_backup_drive
          - conditions:
              - condition: trigger
                id: pc
            sequence:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message: ":desktop_computer: :tv: Computer turned off for more than 10 minutes."
                      log_level: "Debug"
                  - action: scene.turn_on
                    target:
                      entity_id: scene.office_desk_lights_off
                  - action: script.send_to_home_log
                    data:
                      messsage: Turned off desk lights.
                      log_level: "Debug"
                  - action: switch.turn_off
                    target:
                      entity_id:
                        - switch.goxlr
                  - action: script.send_to_home_log
                    data:
                      message: "Turned off for more than 10 minutes. Turned
                        off :level_slider: goXLR"
                      title: ":desktop_computer: Computer"
                      log_level: "Debug"
                  - action: script.office_turn_off_backup_drive
        default: []
    mode: single
  - id: "1678741966796"
    alias: "Office: Computer Turned Off"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - group.jd_computer
        from: "home"
        to: "not_home"
        for:
          hours: 0
          minutes: 1
          seconds: 0
    conditions: []
    actions:
      - if:
          - alias: Is work computer on?
            condition: state
            entity_id: group.dannys_work_computer
            state: "not_home"
        then:
          - parallel:
              - action: script.send_to_home_log
                data:
                  message: >-
                    Computer turned off. Turning monitor light off.
                  title: ":office: Office"
                  log_level: "Debug"
              - action: switch.turn_off
                target:
                  entity_id:
                    - switch.office_monitor_bar
    mode: single
  - id: "1678741966794"
    alias: "Office: Computer Turned Off After Sunrise"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - group.jd_computer
        from: "home"
        to: "not_home"
        for:
          hours: 0
          minutes: 5
          seconds: 0
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - condition: sun
        after: sunrise
      - condition: time
        after: "08:00:30"
      - condition: sun
        before: sunset
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                Computer turned off. Opening blinds.
              title: ":office: Office"
              log_level: "Debug"
          - action: script.office_open_blinds
            data: {}
    mode: single
  - id: "1619865008649"
    alias: "Office: Work Computer Turned On"
    description: ""
    triggers:
      - trigger: state
        entity_id: group.dannys_work_computer
        from: "not_home"
        to: "home"
    conditions:
      - condition: state
        entity_id: switch.office_monitor_bar
        state: "off"
    actions:
      - parallel:
          - action: switch.turn_on
            target:
              entity_id: switch.office_monitor_bar
          - action: script.send_to_home_log
            data:
              message: "Turned on monitor light."
              title: ":desktop_computer: Computer"
              log_level: "Debug"
    mode: single
  - id: "1678741966795"
    alias: "Office: Work Computer Turned Off"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - group.dannys_work_computer
        from: "home"
        to: "not_home"
        for:
          hours: 0
          minutes: 1
          seconds: 0
    conditions: []
    actions:
      - parallel:
          - if:
              - alias: Is personal computer on?
                condition: state
                entity_id: group.jd_computer
                state: "not_home"
            then:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        Danny's work computer turned off. Turning monitor light off.
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: switch.turn_off
                    target:
                      entity_id:
                        - switch.office_monitor_bar
    mode: single
  #endregion
  #region Blinds
  - id: "1622374444832"
    alias: "Office: Open Blinds In The Morning"
    description: ""
    triggers:
      - trigger: time
        at: "08:00:00"
    conditions: []
    actions:
      - action: weather.get_forecasts
        target:
          entity_id: weather.home
        data:
          type: hourly
        response_variable: weather
      - choose:
          - alias: "Really bright and blinds are closed already"
            conditions:
              - condition: numeric_state
                entity_id: sensor.front_garden_motion_illuminance_lux
                above: input_number.blind_high_brightness_threshold
              - or:
                  - condition: state
                    entity_id: group.dannys_work_computer
                    state: "home"
                  - condition: state
                    entity_id: group.jd_computer
                    state: "home"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    :clock{{ now().strftime('%I') | int }}{% if now().minute | int > 25 and now().minute | int < 35 %}30{% else %}{% endif %}:
                    Keeping blinds closed.
                  title: ":office: Office"
                  log_level: "Debug"
          - conditions:
              - condition: numeric_state
                entity_id: sensor.front_garden_motion_illuminance_lux
                above: input_number.blind_low_brightness_threshold
              - condition: numeric_state
                entity_id: sensor.front_garden_motion_illuminance_lux
                below: input_number.blind_high_brightness_threshold
              - or:
                  - condition: state
                    entity_id: group.dannys_work_computer
                    state: "home"
                  - condition: state
                    entity_id: group.jd_computer
                    state: "home"
            sequence:
              - parallel:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :clock{{ now().strftime('%I') | int }}{% if now().minute | int > 25 and now().minute | int < 35 %}30{% else %}{% endif %}:
                        It's bright outside ({{ states('sensor.front_garden_motion_illuminance_lux', with_unit=True) }}) so partially opening office blinds.
                      title: ":office: Office"
                      log_level: "Debug"
                  - action: cover.set_cover_tilt_position
                    data:
                      tilt_position: 25
                    target:
                      entity_id: cover.office_blinds
        default:
          - parallel:
              - action: script.send_to_home_log
                data:
                  message: >-
                    :clock{{ now().strftime('%I') | int }}{% if now().minute | int > 25 and now().minute | int < 35 %}30{% else %}{% endif %}:
                    Opening blinds.
                  title: ":office: Office"
                  log_level: "Debug"
              - action: script.office_open_blinds
                data: {}
    mode: single
  - id: "1622374233312"
    alias: "Office: Close Office Blinds At Night 2"
    description: ""
    triggers:
      - trigger: sun
        event: sunset
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - condition: numeric_state
        entity_id: cover.office_blinds
        attribute: current_tilt_position
        above: 25
    actions:
      - choose:
          - conditions:
              - condition: state
                entity_id: binary_sensor.office_windows
                state: "on"
            sequence:
              - action: script.send_to_home_log
                data:
                  message:
                    ":warning: :window: Office window is still open so not closing
                    blinds. before closing blinds. :warning:"
                  title: ":office: Office"
                  log_level: "Debug"
        default:
          - parallel:
              - action: script.send_to_home_log
                data:
                  message: ":city_sunset: :sun_with_face: :window: It's getting dark, closing office blinds."
                  title: ":office: Office"
                  log_level: "Debug"
              - action: cover.set_cover_tilt_position
                data:
                  tilt_position: 25
                target:
                  entity_id: cover.office_blinds
    mode: single
  - id: "1622374233310"
    alias: "Office: Close Office Blinds At Night 2"
    description: ""
    triggers:
      - trigger: sun
        event: sunset
        offset: 01:00:00
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - condition: numeric_state
        entity_id: cover.office_blinds
        attribute: current_tilt_position
        above: 0
    actions:
      - choose:
          - conditions:
              - condition: state
                entity_id: binary_sensor.office_windows
                state: "on"
            sequence:
              - action: script.send_to_home_log
                data:
                  message:
                    ":warning: :window: Office window is still open so not closing
                    blinds. before closing blinds. :warning:"
                  title: ":office: Office"
                  log_level: "Debug"
        default:
          - parallel:
              - action: script.send_to_home_log
                data:
                  message: ":city_sunset: :sun_with_face: :window: It's getting dark, closing office blinds."
                  title: ":office: Office"
                  log_level: "Debug"
              - action: script.office_close_blinds
                data: {}
    mode: single
  - id: "1622666920056"
    alias: "Office: Window Closed At Night"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.office_windows
        from: "on"
        to: "off"
        for:
          hours: 0
          minutes: 1
          seconds: 0
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - or:
          - condition: sun
            after: sunset
            after_offset: -01:00:00
          - condition: sun
            before: sunrise
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                :window: :city_sunset: Office window closed and it's dark. Closing
                blinds.
              title: ":office: Office"
              log_level: "Debug"
          - action: script.office_close_blinds
            data: {}
    mode: single
  - id: "1680528200295"
    alias: "Office: No Direct Sun Light In The Morning"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sun.sun
        attribute: azimuth
        below: input_number.office_blinds_morning_sun_azimuth_threshold
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - condition: numeric_state
        entity_id: cover.office_blinds
        attribute: current_tilt_position
        below: 50
      - condition: time
        after: "08:10:00"
      - condition: sun
        before: sunset
      - condition: state
        entity_id: binary_sensor.office_windows
        state: "off"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                Morning :sun: sun is out of the way. Opening :office: office blinds.

                Azimuth: {{ state_attr('sun.sun', 'azimuth') }} ({{ states('input_number.living_room_blinds_morning_sun_azimuth_threshold')}}).

                Elevation: {{ state_attr('sun.sun', 'elevation') }}.
              title: ":office: Office"
              log_level: "Debug"
          - action: script.office_open_blinds
            data: {}
    mode: single
  - id: "1680528200297"
    alias: "Office: No Direct Sun Light In The Afternoon"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sun.sun
        attribute: azimuth
        above: input_number.office_blinds_afternoon_sun_azimuth_threshold
      - trigger: numeric_state
        entity_id: sun.sun
        attribute: elevation
        above: input_number.office_blinds_afternoon_sun_elevation_threshold
    conditions:
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - condition: numeric_state
        entity_id: sun.sun
        attribute: azimuth
        above: input_number.office_blinds_afternoon_sun_azimuth_threshold
      - condition: numeric_state
        entity_id: sun.sun
        attribute: elevation
        above: input_number.office_blinds_afternoon_sun_elevation_threshold
      - condition: numeric_state
        entity_id: cover.office_blinds
        attribute: current_tilt_position
        below: 50
      - condition: state
        entity_id: binary_sensor.office_windows
        state: "off"
      - condition: state
        entity_id: light.office_key_lights
        state: "off"
    actions:
      - action: script.send_to_home_log
        data:
          message: >-
            Afternoon :sun: sun is out of the way. Opening :office: office blinds.

            Azimuth: {{ state_attr('sun.sun', 'azimuth') }} ({{ states('input_number.office_blinds_afternoon_sun_azimuth_threshold')}}).

            Elevation: {{ state_attr('sun.sun', 'elevation') }} ({{ states('input_number.office_blinds_afternoon_sun_elevation_threshold')}}).
          title: ":office: Office"
          log_level: "Debug"
      - action: script.office_open_blinds
        data: {}
    mode: single
  - id: "1678300398737"
    alias: "Office: Bright Outside"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sensor.front_garden_motion_illuminance_lux
        above: input_number.blind_low_brightness_threshold
        for: "00:01:00"
    conditions:
      - condition: sun
        after: sunrise
      - condition: time
        after: "08:10:00"
      - condition: sun
        before: sunset
      - condition: numeric_state
        entity_id: sensor.front_garden_motion_illuminance_lux
        above: input_number.blind_high_brightness_threshold
      # Between morning and afternoon non direct sun light positon
      - condition: numeric_state
        entity_id: sun.sun
        attribute: azimuth
        above: input_number.office_blinds_morning_sun_azimuth_threshold
      - condition: numeric_state
        entity_id: sun.sun
        attribute: azimuth
        below: input_number.office_blinds_afternoon_sun_azimuth_threshold
      - condition: numeric_state
        entity_id: sun.sun
        attribute: elevation
        below: input_number.office_blinds_afternoon_sun_elevation_threshold
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - condition: numeric_state
        entity_id: cover.office_blinds
        attribute: current_tilt_position
        above: 25
      - condition: state
        entity_id: binary_sensor.office_windows
        state: "off"
      - or:
          - condition: state
            entity_id: group.dannys_work_computer
            state: "home"
          - condition: state
            entity_id: group.jd_computer
            state: "home"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                It's bright outside ({{ states('sensor.front_garden_motion_illuminance_lux', with_unit=True) }}) and computer is on.
                Partially closing blinds.

                Azimuth: {{ state_attr('sun.sun', 'azimuth') }}.

                Elevation: {{ state_attr('sun.sun', 'elevation') }}.
              title: ":office: Office"
              log_level: "Debug"
          - action: cover.set_cover_tilt_position
            data:
              tilt_position: 25
            target:
              entity_id: cover.office_blinds
    mode: single
  - id: "1678300398736"
    alias: "Office: Really Bright Outside"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sensor.front_garden_motion_illuminance_lux
        above: input_number.blind_high_brightness_threshold
        for: "00:01:00"
    conditions:
      - condition: sun
        after: sunrise
      - condition: time
        after: "08:00:30"
      - condition: sun
        before: sunset
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - condition: numeric_state
        entity_id: cover.office_blinds
        attribute: current_tilt_position
        above: 0
      - condition: numeric_state
        entity_id: sun.sun
        attribute: azimuth
        above: input_number.office_blinds_morning_sun_azimuth_threshold
      - condition: numeric_state
        entity_id: sun.sun
        attribute: azimuth
        below: input_number.office_blinds_afternoon_sun_azimuth_threshold
      - condition: state
        entity_id: binary_sensor.office_windows
        state: "off"
      - or:
          - condition: state
            entity_id: group.dannys_work_computer
            state: "home"
          - condition: state
            entity_id: group.jd_computer
            state: "home"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                It's really bright outside ({{ states('sensor.front_garden_motion_illuminance_lux', with_unit=True) }}).
                Closing blinds.
              title: ":office: Office"
              log_level: "Debug"
          - action: script.office_close_blinds
            data: {}
    mode: single
  - id: "1678637987424"
    alias: "Office: Outside Went Darker"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sensor.front_garden_motion_illuminance_lux
        for:
          hours: 0
          minutes: 5
          seconds: 0
        below: input_number.blind_low_brightness_threshold
    conditions:
      - condition: sun
        after: sunrise
      - condition: time
        after: "08:00:30"
      - condition: sun
        before: sunset
      - condition: numeric_state
        entity_id: cover.office_blinds
        attribute: current_tilt_position
        below: 50
      - condition: state
        entity_id: input_boolean.enable_office_blind_automations
        state: "on"
      - condition: state
        entity_id: binary_sensor.office_windows
        state: "off"
      - condition: state
        entity_id: light.office_key_lights
        state: "off"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                It is not as bright outside ({{ states('sensor.front_garden_motion_illuminance_lux', with_unit=True) }}).
                Opening Blinds
              title: ":office: Office"
              log_level: "Debug"
          - action: script.office_open_blinds
            data: {}
    mode: single
  #endregion
  #region Lights
  - id: "1719349686247"
    alias: "Office: Light On And Bright Room"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - light.office_area_lights
        to: "on"
        for:
          hours: 1
          minutes: 0
          seconds: 0
    conditions:
      - condition: sun
        before: sunset
        after: sunrise
      - condition: numeric_state
        entity_id: sensor.office_area_mean_light_level
        above: input_number.office_light_level_threshold
    actions:
      - parallel:
          - action: light.turn_off
            metadata: {}
            data:
              transition: 1
            target:
              entity_id:
                - light.office_3
                - light.office_2
          - sequence:
              - action: scene.turn_on
                target:
                  entity_id: scene.office_room_brightness_above_threshold
                data: {}
              - delay:
                  seconds: 1
              - action: light.turn_off
                target:
                  entity_id:
                    - light.office_4
                data: {}
    mode: single
  - id: "1721434316175"
    alias: "Office: Fly Zapper"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - switch.fly_zapper
        for:
          hours: 2
          minutes: 0
          seconds: 0
    conditions: []
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                Turning off fly zapper after 2 hours.
              title: ":office: Office"
              log_level: "Debug"
          - action: switch.turn_off
            metadata: {}
            data: {}
            target:
              entity_id: switch.fly_zapper
    mode: single
  - id: "1722108194998"
    alias: "Office: Remote Keylight"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - sensor.office_remote_action
        to: open
    conditions: []
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                Remote command received: toggle key lights.
              title: ":office: Office"
              log_level: "Debug"
          - action: light.toggle
            metadata: {}
            data: {}
            target:
              entity_id: light.office_key_lights
    mode: single
  - id: "1722108194999"
    alias: "Office: Remote Fan"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - sensor.office_remote_action
        to: close
    conditions: []
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                Remote command received: toggle fan.
              title: ":office: Office"
              log_level: "Debug"
          - action: switch.toggle
            metadata: {}
            data: {}
            target:
              entity_id: switch.office_fan
    mode: single
  #endregion
  #region Air Conditioner
  - id: "1724261391488"
    alias: "Office: Scheduled Air Conditioning On"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - input_boolean.enable_office_air_conditioner_schedule_1
          - input_boolean.enable_office_air_conditioner_schedule_2
          - binary_sensor.office_air_conditioner_schedule_1
          - binary_sensor.office_air_conditioner_schedule_2
        from: "off"
        to: "on"
    conditions:
      - or:
          - and:
              - condition: state
                entity_id: input_boolean.enable_office_air_conditioner_schedule_1
                state: "on"
              - condition: state
                entity_id: binary_sensor.office_air_conditioner_schedule_1
                state: "on"
          - and:
              - condition: state
                entity_id: input_boolean.enable_office_air_conditioner_schedule_2
                state: "on"
              - condition: state
                entity_id: binary_sensor.office_air_conditioner_schedule_2
                state: "on"
          - and:
              - condition: state
                entity_id: input_boolean.enable_office_air_conditioner_schedule_3
                state: "on"
              - condition: state
                entity_id: binary_sensor.office_air_conditioner_schedule_3
                state: "on"
      - condition: state
        entity_id: input_boolean.enable_office_air_conditioner_automations
        state: "on"
    actions:
      - action: script.check_office_air_conditioner
        data: {}
    mode: single
  - id: "1724261391489"
    alias: "Office: Scheduled Air Conditioning Off"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - input_boolean.enable_office_air_conditioner_schedule_1
          - input_boolean.enable_office_air_conditioner_schedule_2
          - input_boolean.enable_office_air_conditioner_schedule_3
          - binary_sensor.office_air_conditioner_schedule_1
          - binary_sensor.office_air_conditioner_schedule_2
          - binary_sensor.office_air_conditioner_schedule_3
        to: "off"
    conditions:
      - or:
          - and:
              - condition: state
                entity_id: input_boolean.enable_office_air_conditioner_schedule_1
                state: "on"
              - condition: state
                entity_id: binary_sensor.office_air_conditioner_schedule_1
                state: "off"
          - and:
              - condition: state
                entity_id: input_boolean.enable_office_air_conditioner_schedule_2
                state: "on"
              - condition: state
                entity_id: binary_sensor.office_air_conditioner_schedule_2
                state: "off"
          - and:
              - condition: state
                entity_id: input_boolean.enable_office_air_conditioner_schedule_3
                state: "on"
              - condition: state
                entity_id: binary_sensor.office_air_conditioner_schedule_3
                state: "off"
      - condition: state
        entity_id: input_boolean.enable_office_air_conditioner_automations
        state: "on"
    actions:
      - action: script.check_office_air_conditioner
        data: {}
    mode: single
  #endregion

scene:
  - id: "1600795089307"
    name: "Office: Turn On Main Light"
    entities:
      light.office_2:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 255
        color_temp: 285
        friendly_name: Office Light 3
        supported_features: 55
        state: "on"
      light.office_3:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 255
        color_temp: 285
        friendly_name: Office Light 3
        supported_features: 55
        state: "on"
    icon: mdi:lightbulb
  - id: "1606247204381"
    name: Office Turn Off Main Light
    entities:
      light.office_2:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light 2
        supported_features: 55
        state: "off"
      light.office_light:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light
        supported_features: 55
        state: "off"
      light.office_3:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light 3
        supported_features: 55
        state: "off"
      light.office_4:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light 4
        supported_features: 55
        state: "off"
  - id: "1612921949654"
    name: Office Dim Main Lights
    entities:
      light.office_2:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 51
        color_temp: 285
        friendly_name: Office Light 3
        supported_features: 55
        state: "on"
      light.office_3:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 51
        color_temp: 285
        friendly_name: Office Light 3
        supported_features: 55
        state: "on"
  - id: "1606247529306"
    name: Office Turn Off All Lights
    entities:
      light.office_light:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light
        supported_features: 55
        state: "off"
      light.office_2:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light 2
        supported_features: 55
        state: "off"
      light.office_3:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light 3
        supported_features: 55
        state: "off"
      light.office_4:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light 4
        supported_features: 55
        state: "off"
  - id: "1600776152370"
    name: "Office: Doorbell Notification"
    entities:
      light.office_light:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 255
        hs_color:
          - 120
          - 100
        rgb_color:
          - 0
          - 255
          - 0
        xy_color:
          - 0.172
          - 0.747
        friendly_name: Office Light
        supported_features: 55
        state: "on"
    icon: mdi:lightbulb
  - id: "1606170296807"
    name: Office Sun Light
    entities:
      light.office_light:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 128
        color_temp: 245
        friendly_name: Office Light
        supported_features: 55
        state: "on"
  # Notifications
  - id: "1645654665047"
    name: Office PC Turned Off Notification
    entities:
      light.office_light:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        supported_color_modes:
          - color_temp
          - hs
        color_mode: hs
        brightness: 255
        hs_color:
          - 299.997
          - 100
        rgb_color:
          - 254
          - 0
          - 255
        xy_color:
          - 0.384
          - 0.154
        friendly_name: Office Light
        supported_features: 55
        state: "on"
    icon: mdi:lightbulb
  - id: "1613476016502"
    name: "Office: Turn Off Light Notification"
    entities:
      light.office_light:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Office Light
        supported_features: 55
        state: "off"
  - id: "1613476289811"
    name: "Office: Front Door Open Notification"
    entities:
      light.office_light:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 255
        hs_color:
          - 240
          - 100
        rgb_color:
          - 0
          - 0
          - 255
        xy_color:
          - 0.136
          - 0.04
        friendly_name: Office Light
        supported_features: 55
        state: "on"
  - id: "1613476535744"
    name: "Office: Front Garden Motion Notification"
    entities:
      light.office_light:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 255
        hs_color:
          - 284.995
          - 100
        rgb_color:
          - 191
          - 0
          - 255
        xy_color:
          - 0.301
          - 0.116
        friendly_name: Office Light
        supported_features: 55
        state: "on"
  - id: "1720024018791"
    name: "Office: Room Brightness Above Threshold"
    entities:
      light.office_4:
        min_color_temp_kelvin: 2000
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 500
        effect_list:
          - blink
          - breathe
          - okay
          - channel_change
          - candle
          - fireplace
          - colorloop
          - finish_effect
          - stop_effect
          - stop_hue_effect
        supported_color_modes:
          - color_temp
          - xy
        effect:
        color_mode: xy
        brightness: 255
        color_temp_kelvin:
        hs_color:
          - 57.874
          - 99.608
        rgb_color:
          - 255
          - 246
          - 1
        xy_color:
          - 0.454
          - 0.508
        friendly_name: Office 4
        supported_features: 44
        state: "on"
    metadata:
      light.office_4:
        entity_only: true
  - id: "1721636570804"
    name: Office Set Light To Red
    entities:
      light.office_4:
        min_color_temp_kelvin: 2000
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 500
        effect_list:
          - blink
          - breathe
          - okay
          - channel_change
          - candle
          - fireplace
          - colorloop
          - finish_effect
          - stop_effect
          - stop_hue_effect
        supported_color_modes:
          - color_temp
          - xy
        effect:
        color_mode: xy
        brightness: 255
        color_temp_kelvin:
        hs_color:
          - 9.231
          - 66.275
        rgb_color:
          - 255
          - 112
          - 86
        xy_color:
          - 0.589
          - 0.329
        friendly_name: Office 4
        supported_features: 44
        state: "on"
    metadata:
      light.office_4:
        entity_only: true
script:
  #region PC
  office_turn_off_backup_drive:
    alias: Office Turn Off Backup Drive
    sequence:
      - and:
          - condition: state
            entity_id: switch.external_hdd
            state: "on"
          - condition: state
            entity_id: group.jd_computer
            state: "not_home"
      - action: script.send_to_home_log
        data:
          message: ":floppy_disk: Turning off external HDD"
          log_level: "Debug"
      - action: switch.turn_off
        target:
          entity_id: switch.external_hdd
    mode: single
  office_pc_turned_off_notification:
    alias: Office PC Turned Off Notification
    sequence:
      - action: scene.turn_on
        data:
          transition: 1
        target:
          entity_id: scene.office_pc_turned_off_notification
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: scene.turn_on
        data:
          transition: 1
        target:
          entity_id: scene.office_turn_off_light_notification
    mode: single
  #endregion
  #region Blinds
  # Used in UI
  office_open_blinds:
    alias: Office Open Blinds
    sequence:
      - action: cover.set_cover_tilt_position
        data:
          tilt_position: 50
        target:
          entity_id: cover.office_blinds
  office_close_blinds:
    alias: Office Close Blinds
    sequence:
      - action: cover.set_cover_tilt_position
        data:
          tilt_position: 0
        target:
          entity_id: cover.office_blinds
  #endregion
  #region Air conditioner
  check_office_air_conditioner:
    alias: Check Office Air Condiitioner
    sequence:
      choose:
        - alias: Negative rates
          conditions:
            - condition: numeric_state
              entity_id:
                - event.octopus_energy_electricity_current_day_rates
              below: 0
            - condition: state
              entity_id: input_boolean.office_air_conditioner_on_when_electricity_cost_nothing
              state: "on"
            - condition: state
              entity_id: input_boolean.enable_office_air_conditioner_automations
              state: "on"
          sequence:
            - parallel:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      Electricity rates went below 0p/kWh. Turning air conditioner on.
                    title: ":office: Office"
                    log_level: "Normal"
                - sequence:
                    - action: climate.set_hvac_mode
                      metadata: {}
                      data:
                        hvac_mode: cool
                      target:
                        entity_id: climate.office_air_conditioner
                    - delay:
                        seconds: 2
                    - action: climate.set_temperature
                      metadata: {}
                      data:
                        temperature: 21
                      target:
                        entity_id: climate.office_air_conditioner
        - alias: Scheduled turn on
          conditions:
            - or:
                - and:
                    - condition: state
                      entity_id: input_boolean.enable_office_air_conditioner_schedule_1
                      state: "on"
                    - condition: state
                      entity_id: binary_sensor.office_air_conditioner_schedule_1
                      state: "on"
                - and:
                    - condition: state
                      entity_id: input_boolean.enable_office_air_conditioner_schedule_2
                      state: "on"
                    - condition: state
                      entity_id: binary_sensor.office_air_conditioner_schedule_2
                      state: "on"
                - and:
                    - condition: state
                      entity_id: input_boolean.enable_office_air_conditioner_schedule_3
                      state: "on"
                    - condition: state
                      entity_id: binary_sensor.office_air_conditioner_schedule_3
                      state: "on"
            - condition: state
              entity_id: input_boolean.enable_office_air_conditioner_automations
              state: "on"
          sequence:
            - parallel:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      Schedule to turn on air conditioner.
                    title: ":office: Office"
                    log_level: "Debug"
                - sequence:
                    - action: climate.set_hvac_mode
                      metadata: {}
                      data:
                        hvac_mode: cool
                      target:
                        entity_id: climate.office_air_conditioner
                    - delay:
                        seconds: 2
                    - action: climate.set_temperature
                      metadata: {}
                      data:
                        temperature: 21
                      target:
                        entity_id: climate.office_air_conditioner
        - conditions:
            - or:
                - and:
                    - condition: state
                      entity_id: input_boolean.enable_office_air_conditioner_schedule_1
                      state: "on"
                    - condition: state
                      entity_id: binary_sensor.office_air_conditioner_schedule_1
                      state: "off"
                - and:
                    - condition: state
                      entity_id: input_boolean.enable_office_air_conditioner_schedule_2
                      state: "on"
                    - condition: state
                      entity_id: binary_sensor.office_air_conditioner_schedule_2
                      state: "off"
                - and:
                    - condition: state
                      entity_id: input_boolean.enable_office_air_conditioner_schedule_3
                      state: "on"
                    - condition: state
                      entity_id: binary_sensor.office_air_conditioner_schedule_3
                      state: "off"
            - condition: state
              entity_id: input_boolean.enable_office_air_conditioner_automations
              state: "on"
          sequence:
            - parallel:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      Schedule to turn off air conditioner.
                    title: ":office: Office"
                    log_level: "Debug"
                - sequence:
                    - action: climate.set_hvac_mode
                      metadata: {}
                      data:
                        hvac_mode: "off"
                      target:
                        entity_id: climate.office_air_conditioner
        - alias: Positive rates
          conditions:
            - condition: numeric_state
              entity_id:
                - event.octopus_energy_electricity_current_day_rates
              above: 0
            - condition: state
              entity_id: input_boolean.office_air_conditioner_on_when_electricity_cost_nothing
              state: "on"
            - condition: state
              entity_id: input_boolean.enable_office_air_conditioner_automations
              state: "on"
          sequence:
            - parallel:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      Electricity rates went above 0p/kWh. Turning air conditioner off.
                    title: ":office: Office"
                    log_level: "Normal"
                - action: climate.set_hvac_mode
                  metadata: {}
                  data:
                    hvac_mode: "off"
                  target:
                    entity_id: climate.office_air_conditioner
      default: []
  #endregion

sensor:
  # historical stats
  # Computer
  - platform: history_stats
    name: PC Uptime Today
    unique_id: 0991cb72-ffe8-408a-826d-48b0230353c8
    entity_id: group.jd_computer
    state: "home"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: PC Uptime Last 24 Hours
    unique_id: 472320b6-4109-4e07-b914-c8ea54491362
    entity_id: group.jd_computer
    state: "home"
    type: time
    end: "{{ now() }}"
    duration:
      hours: 24
  - platform: history_stats
    name: PC Uptime Yesterday
    unique_id: 8f999940-08bd-49be-85f7-495dfcbe4309
    entity_id: group.jd_computer
    state: "home"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      hours: 24
  - platform: history_stats
    name: PC Uptime This Week
    unique_id: 837d727a-2290-4527-ab68-3cd78344321c
    entity_id: group.jd_computer
    state: "home"
    type: time
    start: "{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: PC Uptime Last 30 Days
    unique_id: 9ec48946-234a-4093-844c-800ba67ab340
    entity_id: group.jd_computer
    state: "home"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      days: 30
  - platform: history_stats
    name: Work Computer Uptime Today
    unique_id: cb2cfc1a-39b5-4225-86b4-5b34d287c0b6
    entity_id: group.dannys_work_computer
    state: "home"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: Work Computer Uptime Yesterday
    unique_id: 2fd1cec2-a453-4347-8e7f-14f25e08144c
    entity_id: group.dannys_work_computer
    state: "home"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      hours: 24
  - platform: history_stats
    name: Work Computer Uptime This Week
    unique_id: dc0e517b-2308-4c6f-8ad8-38665f312ce3
    entity_id: group.dannys_work_computer
    state: "home"
    type: time
    start: "{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: Work Computer Uptime Last 30 Days
    unique_id: 3695a5ba-ebfe-43c2-a7b3-2e04704ae4c4
    entity_id: group.dannys_work_computer
    state: "home"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      days: 30
