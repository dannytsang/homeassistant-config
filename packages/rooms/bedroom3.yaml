# Created by Danny Tsang <danny@tsang.uk>
automation:
  - id: "1605925028960"
    alias: "^Ashlee's Room: Close Blinds"
    description: ""
    trigger:
      - platform: time
        at: "19:00:00"
      - platform: time
        at: "22:00:00"
      - platform: sun
        event: sunset
        id: sunset
    condition:
      - condition: state
        entity_id: cover.ashlees_blinds
        state: open
      - condition: state
        entity_id: input_boolean.enable_ashlees_blind_automations
        state: "on"
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: binary_sensor.ashlees_window
                state: "on"
            sequence:
              - service: script.post_to_home_log
                data:
                  message:
                    ":warning: :window: Ashlee's window is still open. Waiting until
                    it's closed before closing blinds. :warning:"
          - conditions:
              - condition: state
                entity_id: input_select.home_mode
                state: No Children
              - condition: trigger
                id: sunset
              - condition: state
                entity_id: binary_sensor.ashlees_window
                state: "off"
            sequence:
              - service: script.post_to_home_log
                data:
                  message: ":city_sunset: :window: It's getting dark, closing Ashlee's blinds."
              - service: cover.close_cover
                target:
                  entity_id: cover.ashlees_blinds
          - conditions:
              - condition: state
                entity_id: binary_sensor.ashlees_window
                state: "off"
            sequence:
              - service: script.post_to_home_log
                data:
                  message: ":city_sunset: :window: It's getting dark, closing Ashlee's blinds."
              - service: cover.close_cover
                target:
                  entity_id: cover.ashlees_blinds
        default: []
    mode: single
  - id: "1605775729191"
    alias: "^Ashlee's Room: Turn Off Lamp After An Hour"
    description: ""
    trigger:
      - platform: state
        entity_id: switch.ashlees_lamp
        to: "on"
        for: 01:00:00
    condition: []
    action:
      - service: switch.turn_off
        target:
          entity_id: switch.ashlees_lamp
      - service: script.post_to_home_log
        data:
          message: "Ashlee's lamp has been on for 1 hour. Turning lamp off."
    mode: single
  - id: "1599994669457"
    alias: "^Ashlee's Room: Open Blinds In The Morning"
    description: ""
    trigger:
      - at: 08:30:00
        platform: time
    condition:
      - condition: state
        entity_id: cover.ashlees_blinds
        state: closed
      - condition: state
        entity_id: input_boolean.enable_ashlees_blind_automations
        state: "on"
    action:
      - choose:
          - conditions:
              - condition: not
                conditions:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: Guest
            sequence:
              - data:
                  message: ":sunrise: :window: Opening Ashlee's blinds"
                service: script.post_to_home_log
              - service: cover.open_cover
                target:
                  entity_id: cover.ashlees_blinds
          - conditions:
              - condition: state
                entity_id: input_select.home_mode
                state: Guest
            sequence:
              - service: script.post_to_home_log
                data:
                  message:
                    ":stop_sign: :sunrise: :window: Guest mode is enabled. Skipping
                    opening Ashlee's bedroom blinds."
        default: []
    mode: single
input_boolean:
  enable_ashlees_blind_automations:
    name: Enable Ashlees Blind Automation
    icon: mdi:window-open
