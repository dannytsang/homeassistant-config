# Created by Danny Tsang <danny@tsang.uk>
automation:
  # region Motion
  - id: "1624918278463"
    alias: "Stairs: Motion Detected For Ambient Lights"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.stairs_motion_occupancy
        from: "off"
        to: "on"
    conditions: []
    actions:
      - parallel:
        - choose:
            - conditions:
                - condition: sun
                  after: sunrise
                - condition: state
                  entity_id: light.stairs_2
                  state: "off"
                - condition: state
                  entity_id: input_boolean.enable_stairs_motion_triggers
                  state: "on"
              sequence:
                - action: script.send_to_home_log
                  data:
                    message: "ğŸ¾ Motion on lower :ladder: stairs and it's night time.
                    Turning ambient ğŸ’¡ light on ğŸ”… dim."
                    title: "Stairs"
                    log_level: "Debug"
                - action: scene.turn_on
                  target:
                    entity_id: scene.stairs_light_2_on
                  data:
                    transition: 0.5
            - conditions:
                - condition: time
                  after: 00:00:00
                - condition: sun
                  before: sunrise
                - condition: state
                  entity_id: light.stairs_2
                  state: "off"
                - condition: state
                  entity_id: input_boolean.enable_stairs_motion_triggers
                  state: "on"
              sequence:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      ğŸ¾ Motion on lower :ladder: stairs and it's night time.
                      Dimming ambient ğŸ’¡ ğŸ”… light.
                    title: "Stairs"
                    log_level: "Debug"
                - action: scene.turn_on
                  target:
                    entity_id: scene.stairs_light_2_dim
                  data:
                    transition: 0.5
          default: []
    mode: single
  - id: "1598726353326"
    alias: "Stairs: Upstairs Dark, Before Kids Bed Time, Light Off And Motion Detected"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        to: "on"
      - alias: If Ring integration d/c then fall back to Zigbee specifically.
        trigger: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    conditions:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: time
        after: "07:00:00"
        before: input_datetime.childrens_bed_time
      - condition: state
        entity_id: light.stairs
        state: "off"
    actions:
      - parallel:
        - action: script.send_to_home_log
          data:
            message: >-
              ğŸ¾ Motion on the :ladder: upstairs, before bed time
              and it's dark
              ({{ states('sensor.stairs_motion_illuminance', with_unit=True) }} <
              {{ states('input_number.stairs_light_level_threshold', with_unit=True) }}).
              Turning ğŸ’¡ ğŸ”† light on.
            title: "Stairs"
            log_level: "Debug"
        - action: scene.turn_on
          target:
            entity_id:
              - scene.stairs_light_on
    mode: queued
    max: 10
  - id: "1598726353327"
    alias: "Stairs: Upstairs Dark, Before Kids Bed Time, Light On And Motion Detected"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        to: "on"
      - alias: If Ring integration d/c then fall back to Zigbee specifically.
        trigger: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    conditions:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: time
        after: "07:00:00"
        before: input_datetime.childrens_bed_time
      - condition: state
        entity_id: light.stairs
        state: "on"
      - condition: numeric_state
        entity_id: light.stairs
        attribute: brightness
        below: 5
    actions:
      - action: script.send_to_home_log
        data:
          message: >-
            ğŸ¾ Motion on upstairs, before bed time, ğŸ’¡ light is on
            and it's dark
            ({{ states('sensor.stairs_motion_illuminance', with_unit=True) }} <
            {{ states('input_number.stairs_light_level_threshold', with_unit=True) }}).
            Turning ğŸ’¡ ğŸ”† light on.
          title: "Stairs"
          log_level: "Debug"
      - action: scene.turn_on
        target:
          entity_id:
            - scene.stairs_light_on
    mode: single
  - id: "1587595659605"
    alias: "Stairs: Upstairs Dark, After Bed Time, Light Off and Motion Detected Before Midnight"
    description: "Deliberately default to dim light because it's safer than having the light go to full
    brightness at night. Bed time ends when the sun is up or after 7am which ever is first."
    triggers:
      - trigger: state
        entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        to: "on"
      - alias: If Ring integration d/c then fall back to Zigbee specifically.
        trigger: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    conditions:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: time
        after: input_datetime.childrens_bed_time
      - condition: state
        entity_id: light.stairs
        state: "off"
    actions:
      - parallel:
        - choose:
          - conditions:
              - condition: state
                entity_id: input_select.home_mode
                state: "No Children"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion :ladder: upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and in No Children Mode.
                    Turning stairs ğŸ’¡ ğŸ”† light on.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.childrens_bedroom_doors
                state: "off"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion on the :ladder: upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and
                    :people_holding_hands: children's doors are shut.
                    Turning ğŸ’¡ ğŸ”† light on.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.childrens_bedroom_doors
                state: "on"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion on the :ladder: upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and
                    :people_holding_hands: children's ğŸšª doors are open.
                    ğŸ’¡ ğŸ”… Dimming light.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_dim
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "off"
              - condition: state
                entity_id: binary_sensor.leos_bedroom_door_contact
                state: "off"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: "ğŸ¾ Motion upstairs and it's dark
                  ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and
                  ğŸ‘¦ Leo's ğŸšª door is shut. Turning ğŸ’¡ ğŸ”† light on."
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_dim
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "off"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.ashlees_bedroom_door_contact
                state: "off"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and
                    ğŸ‘§ Ashlee's ğŸšª door is shut.
                    Turning ğŸ’¡ ğŸ”† light on.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          default: []
    mode: queued
    max: 10
  - id: "1587595659608"
    alias: "Stairs: Upstairs Dark, After Bed Time, Light On and Motion Detected Before Midnight"
    description: "Deliberately default to dim light because it's safer than having the light go to full
    brightness at night. Bed time ends when the sun is up or after 7am which ever is first."
    triggers:
      - trigger: state
        entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        to: "on"
      - alias: If Ring integration d/c then fall back to Zigbee specifically.
        trigger: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    conditions:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: time
        after: input_datetime.childrens_bed_time
      - condition: state
        entity_id: light.stairs
        state: "on"
      - condition: numeric_state
        entity_id: light.stairs
        attribute: brightness
        below: 5
    actions:
      - parallel:
        - choose:
          - conditions:
              - condition: state
                entity_id: input_select.home_mode
                state: "No Children"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance', with_unit=True) }} <
                    {{ states('input_number.stairs_light_level_threshold', with_unit=True) }})
                    and in No Children Mode. Turning up ğŸ’¡ ğŸ”† light.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.childrens_bedroom_doors
                state: "off"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and
                    :people_holding_hands: children's doors are shut.
                    Turning up ğŸ’¡ ğŸ”† light.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.childrens_bedroom_doors
                state: "on"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and
                    :people_holding_hands: children's doors are open.
                    ğŸ’¡ ğŸ”… Dimming light.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_dim
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "off"
              - condition: state
                entity_id: binary_sensor.leos_bedroom_door_contact
                state: "off"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and
                    ğŸ‘¦ Leo's door is shut. Turning up ğŸ’¡ ğŸ”† light.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "off"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.ashlees_bedroom_door_contact
                state: "off"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and
                    ğŸ‘§ Ashlee's door is shut. Turning up ğŸ’¡ ğŸ”† light.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          default: []
    mode: single
  - id: "1587595659606"
    alias: "Stairs: Dark, After Bed Time, Light Off and Motion Detected After Midnight"
    description: "Deliberately default to dim light because it's safer than having the light go to full
    brightness at night. Bed time ends when the sun is up or after 7am which ever is first."
    triggers:
      - trigger: state
        entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        to: "on"
      - alias: If Ring integration d/c then fall back to Zigbee specifically.
        trigger: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    conditions:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - or:
          - condition: sun
            before: sunrise
          - condition: time
            before: "07:00:00"
      - condition: state
        entity_id: light.stairs
        state: "off"
    actions:
      - parallel:
        - choose:
          - alias: Bedroom light is on
            conditions:
              - condition: state
                entity_id: light.bedroom_lamps
                state: "on"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance', with_unit=True) }} <
                    {{ states('input_number.stairs_light_level_threshold', with_unit=True) }})
                    ğŸ›ï¸ bedroom light is on and it's :clock12: late but bedroom light(s) are on.
                    Turning ğŸ’¡ ğŸ”† light on.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - alias: Check if night light settings is turned on.
            conditions:
              - condition: state
                entity_id: input_boolean.enable_stairs_night_light
                state: "on"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion and it's dark
                    ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and it's :clock12: late.
                    Turning night ğŸ’¡ ğŸ”… light on.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_night_light
          default:
            - action: script.send_to_home_log
              data:
                message: >-
                  ğŸ¾ Motion upstairs and it's dark
                  ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and it's :clock12: late.
                  Night mode is turned off so turning ğŸ’¡ ğŸ”† light on.
                title: "Stairs"
                log_level: "Debug"
            - action: scene.turn_on
              target:
                entity_id: scene.stairs_light_on
    mode: single
  - id: "1587595659607"
    alias: "Stairs: Dark, After Bed Time, Light On and Motion Detected After Midnight"
    description: "Deliberately default to dim light because it's safer than having the light go to full
    brightness at night. Bed time ends when the sun is up or after 7am which ever is first."
    triggers:
      - trigger: state
        entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        to: "on"
      - alias: If Ring integration d/c then fall back to Zigbee specifically.
        trigger: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    conditions:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - or:
          - condition: sun
            before: sunrise
          - condition: time
            before: "07:00:00"
      - condition: state
        entity_id: light.stairs
        state: "on"
      - condition: numeric_state
        entity_id: light.stairs
        attribute: brightness
        below: 5
    actions:
      - parallel:
        - choose:
          - alias: Bedroom light is on
            conditions:
              - condition: state
                entity_id: light.bedroom_lamps
                state: "on"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: >-
                    ğŸ¾ Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance', with_unit=True) }} <
                    {{ states('input_number.stairs_light_level_threshold', with_unit=True) }})
                    and it's :clock12: late but bedroom light(s) are on.
                    Turning ğŸ’¡ ğŸ”† light on.
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - alias: Check if night light settings is turned on.
            conditions:
              - condition: state
                entity_id: input_boolean.enable_stairs_night_light
                state: "on"
            sequence:
              - action: script.send_to_home_log
                data:
                  message: "ğŸ¾ Motion upstairs and it's dark
                  ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and it's :clock12: late.
                  Turning stairs night ğŸ’¡ ğŸ”… light up."
                  title: "Stairs"
                  log_level: "Debug"
              - action: scene.turn_on
                target:
                  entity_id: scene.stairs_night_light
          default:
            - action: script.send_to_home_log
              data:
                message: >-
                  ğŸ¾ Motion upstairs and it's dark
                  ({{ states('sensor.stairs_motion_illuminance') }} < 5 lux) and it's :clock12: late.
                  Night mode is turned off so turning ğŸ’¡ ğŸ”† light on.
                title: "Stairs"
                log_level: "Debug"
            - action: scene.turn_on
              target:
                entity_id: scene.stairs_light_on
    mode: single
  - id: "1592062695452"
    alias: "Stairs: Motion Detected And MagicMirror Is Off"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.living_room_area_motion
        to: "on"
      - trigger: state
        entity_id: binary_sensor.stairs_motion_occupancy
        to: "on"
    conditions:
      - condition: state
        entity_id: switch.magic_mirror_plug
        state: "off"
      - condition: state
        entity_id: input_boolean.enable_magic_mirror_automations
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
    actions:
      - parallel:
        - action: switch.turn_on
          target:
            entity_id: switch.magic_mirror_plug
        - action: script.send_to_home_log
          data:
            message: "Turning on :mirror: Magic Mirror."
            title: "ğŸ¾ Motion on the :ladder: stairs/lounge"
            log_level: "Debug"
    mode: queued
    max: 10
  - id: "1587595847618"
    alias: "Stairs: No Motion Detected"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.upstairs_area_motion
        for: 00:01:00
        to: "off"
      - trigger: state
        entity_id: binary_sensor.stairs_motion_occupancy
        to: "off"
        for: 00:01:00
    conditions:
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                ğŸš· No motion at the top of the stairs for 1 minute.
                Turning light off.
              title: "Stairs"
              log_level: "Debug"
          - action: scene.turn_on
            target:
              entity_id: scene.stairs_light_off
            data:
              transition: 1
          - choose:
              - conditions:
                  - condition: state
                    entity_id: light.stairs_2
                    state: "on"
                sequence:
                  - parallel:
                    - action: script.send_to_home_log
                      data:
                        message: >-
                          ğŸš· No motion at the bottom of the stairs for 1 minute.
                          Turning ambient light off.
                        title: "Stairs"
                        log_level: "Debug"
                    - action: scene.turn_on
                      target:
                        entity_id: scene.stairs_light_2_off
                      data:
                        transition: 2
                    - delay:
                        hours: 0
                        minutes: 0
                        seconds: 1
                        milliseconds: 0
                    - action: light.turn_off
                      target:
                        entity_id: light.stairs_2
            default: []
    mode: queued
    max: 10
  - id: "1624918387840"
    alias: "Stairs: No Motion Detected Bottom Of Stairs"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.stairs_motion_occupancy
        to: "off"
        for: 00:01:00
    conditions:
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: state
        entity_id: light.stairs_2
        state: "on"
    actions:
      - parallel:
        - action: script.send_to_home_log
          data:
            message: >-
              ğŸš· No motion at the bottom of the stairs for 1 minute.
              Turning light off.
            title: "Stairs"
            log_level: "Debug"
        - action: scene.turn_on
          target:
            entity_id: scene.stairs_light_2_off
          data:
            transition: 2
    mode: single
  - id: "1591553945554"
    alias: "Stairs: No Motion At Night Turn Off Magic Mirror"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.stairs_motion_occupancy
        for: 00:03:00
        to: "off"
      - trigger: time
        at: "23:30:00"
    conditions:
      - after: "23:00:00"
        before: "05:00:00"
        condition: time
      - condition: state
        entity_id: switch.magic_mirror_plug
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_magic_mirror_automations
        state: "on"
    actions:
      - action: script.get_clock_emoji
        data:
          hour: "{{ now().strftime('%I') | int }}"
          minute: "{{ now().minute | int }}"
        response_variable: clock_result
      - parallel:
        - action: switch.turn_off
          target:
            entity_id: switch.magic_mirror_plug
        - action: script.send_to_home_log
          data:
            message: >-
              {{ clock_result.emoji }}
              ğŸš· Turning off :mirror: Magic Mirror because no motion was detected.
            title: "Stairs"
            log_level: "Debug"
    mode: single
  # region Light Switch
  - id: "1714869692076"
    alias: "Stairs: Light Switch"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.stairs_light_input_0_input
        not_from:
          - "unknown"
          - "unavailable"
        not_to:
          - "unknown"
          - "unavailable"
    conditions: []
    actions:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
          brightness: 255
        target:
          entity_id: light.stairs
    mode: single
  # region Contact sensor
  - id: "1615849889104"
    alias: "Stairs: Light On And Children's Door Open After Bedtime And Before Midnight"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.leos_bedroom_door_contact
        from: "off"
        to: "on"
      - trigger: state
        entity_id: binary_sensor.ashlees_bedroom_door_contact
        from: "off"
        to: "on"
    conditions:
      - condition: time
        after: input_datetime.childrens_bed_time
        before: "23:59:59"
      - condition: state
        entity_id: light.stairs
        state: "on"
      - not:
          - condition: state
            entity_id: input_select.home_mode
            state: "No Children"
    actions:
      - parallel:
        - choose:
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_leos_door_automations
                  state: "on"
                - condition: state
                  entity_id: binary_sensor.leos_bedroom_door_contact
                  state: "on"
              sequence:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      ğŸ¾ ğŸšª ğŸ”… {{ trigger.to_state.name }} opened after bed time and
                      the stairs light are on. ğŸ’¡ ğŸ”… Dimming all lights.
                    title: "Stairs"
                    log_level: "Debug"
                - action: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_dim
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_ashlees_door_automations
                  state: "on"
                - condition: state
                  entity_id: binary_sensor.ashlees_bedroom_door_contact
                  state: "on"
              sequence:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      ğŸšª ğŸ”† {{ trigger.to_state.name }} opened after bed time and
                      the stairs light are on. ğŸ’¡ ğŸ”… Dimming all lights.
                    title: "Stairs"
                    log_level: "Debug"
                - action: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_on
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
          default: []
    mode: queued
    max: 10
  - id: "1615850302527"
    alias: "Stairs: Light On And Children's Door Closed Before Midnight"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.leos_bedroom_door_contact
        from: "on"
        to: "off"
      - trigger: state
        entity_id: binary_sensor.ashlees_bedroom_door_contact
        from: "on"
        to: "off"
    conditions:
      - condition: time
        after: input_datetime.childrens_bed_time
        before: "23:59:59"
      - condition: state
        entity_id: light.stairs
        state: "on"
      - condition: state
        entity_id: input_select.home_mode
        state: "Normal"
    actions:
      - parallel:
        - choose:
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_leos_door_automations
                  state: "on"
                - condition: state
                  entity_id: input_boolean.enable_ashlees_door_automations
                  state: "on"
                - condition: state
                  entity_id: binary_sensor.childrens_bedroom_doors
                  state: "off"
              sequence:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      ğŸšª ğŸ”† {{ trigger.to_state.name }} closed after bed time, :people_holding_hands:
                      children's ğŸšª doors are closed and the light are on. Turn up ğŸ’¡ ğŸ”† all lights.
                    log_level: "Debug"
                - action: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_on
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_leos_door_automations
                  state: "on"
                - condition: state
                  entity_id: input_boolean.enable_ashlees_door_automations
                  state: "off"
                - condition: state
                  entity_id: binary_sensor.leos_bedroom_door_contact
                  state: "off"
              sequence:
                - action: script.send_to_home_log
                  data:
                    message:
                      "ğŸ‘¦ Leo's ğŸšª door closed after bed time and the
                      lights are on. Turn up ğŸ’¡ ğŸ”† all lights."
                    log_level: "Debug"
                - action: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_on
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_leos_door_automations
                  state: "off"
                - condition: state
                  entity_id: input_boolean.enable_ashlees_door_automations
                  state: "on"
                - condition: state
                  entity_id: binary_sensor.ashlees_bedroom_door_contact
                  state: "off"
              sequence:
                - action: script.send_to_home_log
                  data:
                    message: >-
                      ğŸ‘§ Ashlee's ğŸšª door closed after bed time and the
                      stairs light are on. Turn up ğŸ’¡ ğŸ”† all lights.
                    title: "Stairs"
                    log_level: "Debug"
                - action: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_on
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
          default: []
    mode: single
  # region Timed
  - id: "1588856667889"
    alias: "MagicMirror: Turn Off Based On Time During Weekday"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.stairs_motion_occupancy
        to: "off"
        for: 00:05:00
        from: "on"
    conditions:
      - condition: time
        after: 09:00:00
        before: "17:30:00"
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
      - condition: state
        entity_id: input_boolean.enable_magic_mirror_automations
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
    actions:
      - parallel:
        - action: switch.turn_off
          target:
            entity_id: switch.magic_mirror_plug
        - action: script.send_to_home_log
          data:
            message: "ğŸš· No motioned detected. Turning off :mirror: Magic Mirror based on time of the day."
            title: "Stairs"
            log_level: "Debug"
    mode: single
  - id: "1630760046947"
    alias: "Stairs: Close Blinds At Night"
    description: ""
    triggers:
      - trigger: sun
        event: sunset
        offset: 01:00:00
    conditions:
      - condition: state
        entity_id: cover.stairs_blinds
        state: "open"
      - condition: state
        entity_id: input_boolean.enable_stairs_blind_automations
        state: "on"
    actions:
      - parallel:
        - action: script.send_to_home_log
          data:
            message: "ğŸŒ… ğŸªŸ Closing blinds."
            title: "Stairs"
            log_level: "Debug"
        - action: cover.close_cover
          target:
            entity_id: cover.stairs_blinds
    mode: single
  - id: "1630760149356"
    alias: "Stairs: Open Blinds In The Morning"
    description: ""
    triggers:
      - trigger: time
        at: "08:00:00"
    conditions:
      - condition: state
        entity_id: cover.stairs_blinds
        state: "closed"
      - condition: state
        entity_id: input_boolean.enable_stairs_blind_automations
        state: "on"
    actions:
      - parallel:
        - action: script.send_to_home_log
          data:
            message: "ğŸŒ… Opening blinds."
            title: "Stairs"
            log_level: "Debug"
        - action: cover.open_cover
          target:
            entity_id: cover.stairs_blinds
    mode: single
  # region Camera
  - id: "1630015410190"
    alias: "Stairs: Person Detected"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.stairs_person_detected
        from: "off"
        to: "on"
    conditions:
      - condition: state
        entity_id: alarm_control_panel.house_alarm
        state: "armed_away"
    actions:
      - parallel:
        - action: camera.snapshot
          data_template:
            filename:
              "{{ states('input_text.latest_frigate_upstairs_person_file_path')
              }}"
          target:
            entity_id: camera.stairs_high_resolution_channel
        - action: script.send_home_log_with_local_attachments
          data_template:
            title: Person detected on stairs
            message: Frigate detected a person on the stairs.
            filePath:
              "{{ states('input_text.latest_frigate_upstairs_person_file_path')
              }}"
    mode: queued
    max: 10
  # region Light
  - id: "1743186662872"
    alias: "Stairs: Front Door Status On For Long Time"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - light.stairs_ambient
        to: "on"
        for:
          hours: 0
          minutes: 3
          seconds: 0
      - trigger: state
        entity_id:
          - light.stairs_ambient
        to: "on"
        for:
          hours: 0
          minutes: 5
          seconds: 0
    conditions:
      - condition: state
        entity_id: binary_sensor.front_door
        state: "off"
    actions:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.stairs_ambient
    mode: single

scene:
  - id: "1609512133205"
    name: "Stairs: Turn Light On"
    icon: mdi:lightbulb
    entities:
      light.stairs:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 155
        color_temp_kelvin: 3921
        color_temp: 255
        hs_color:
          - 26.851
          - 36.32
        rgb_color:
          - 255
          - 203
          - 162
        xy_color:
          - 0.426
          - 0.366
        friendly_name: Stairs
        supported_features: 40
        state: "on"
    metadata:
      light.stairs:
        entity_only: true
  - id: "stairs_light_off"
    name: "Stairs: Turn Light Off"
    icon: mdi:lightbulb
    entities:
      light.stairs:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode:
        color_temp_kelvin:
        hs_color:
        rgb_color:
        xy_color:
        friendly_name: Stairs
        supported_features: 40
        state: "off"
    metadata:
      light.stairs:
        entity_only: true
  - id: "1612221653166"
    name: "Stairs: Dim Light"
    icon: mdi:lightbulb
    entities:
      light.stairs:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 20
        color_temp_kelvin: 3921
        color_temp: 255
        hs_color:
          - 26.851
          - 36.32
        rgb_color:
          - 255
          - 203
          - 162
        xy_color:
          - 0.426
          - 0.366
        friendly_name: Stairs
        supported_features: 40
        state: "on"
    metadata:
      light.stairs:
        entity_only: true
  - id: "1623880439954"
    name: Stairs Light 2 On
    icon: mdi:led-strip-variant
    entities:
      light.stairs_2:
        min_mireds: 155
        max_mireds: 495
        effect_list:
          - colorloop
          - random
        supported_color_modes:
          - color_temp
          - hs
        color_mode: color_temp
        brightness: 255
        color_temp: 430
        effect: none
        friendly_name: Stairs 2
        supported_features: 63
        state: "on"
  - id: "1623970390049"
    name: Stairs 2 Light Dim
    icon: mdi:led-strip-variant
    entities:
      light.stairs_2:
        min_mireds: 155
        max_mireds: 495
        effect_list:
          - colorloop
          - random
        supported_color_modes:
          - color_temp
          - hs
        color_mode: color_temp
        brightness: 38
        color_temp: 430
        effect: none
        friendly_name: Stairs 2
        supported_features: 63
        state: "on"
  - id: "stairs_light_2_off"
    name: Stairs Light 2 Off
    icon: mdi:led-strip-variant
    entities:
      light.stairs_2:
        min_mireds: 155
        max_mireds: 495
        effect_list:
          - colorloop
          - random
        supported_color_modes:
          - color_temp
          - hs
        color_mode: color_temp
        brightness: 0
        color_temp: 430
        effect: none
        friendly_name: Stairs 2
        supported_features: 63
        state: "on"
  - id: "1612220515925"
    name: "Landing: Set Light To Blue"
    entities:
      light.stairs_ambient:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        color_temp_kelvin:
        hs_color:
          - 237.073
          - 96.471
        rgb_color:
          - 9
          - 21
          - 255
        xy_color:
          - 0.136
          - 0.042
        friendly_name: Stairs Ambient
        supported_features: 40
        state: "on"
    metadata:
      light.stairs_ambient:
        entity_only: true
  - id: "1612220555547"
    name: Landing Set Light To Red
    entities:
      light.stairs_ambient:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        color_temp_kelvin:
        hs_color:
          - 9.231
          - 66.275
        rgb_color:
          - 255
          - 112
          - 86
        xy_color:
          - 0.589
          - 0.329
        friendly_name: Stairs Ambient
        supported_features: 40
        state: "on"
    metadata:
      light.stairs_ambient:
        entity_only: true
  - id: "1631754396696"
    name: Stairs Night Light
    entities:
      light.stairs:
        min_mireds: 111
        max_mireds: 666
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        supported_color_modes:
          - color_temp
          - hs
        color_mode: hs
        brightness: 5
        hs_color:
          - 358.599
          - 100
        rgb_color:
          - 255
          - 0
          - 5
        xy_color:
          - 0.7
          - 0.299
        friendly_name: Stairs Light
        supported_features: 55
        state: "on"
