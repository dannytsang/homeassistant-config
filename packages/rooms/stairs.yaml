# Created by Danny Tsang <danny@tsang.uk>
automation:
  # Motion
  - id: "1624918278463"
    alias: "Stairs: Motion Detected For Ambient Lights"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.stairs_motion_occupancy
        from: "off"
        to: "on"
    condition: []
    action:
      - parallel:
        - choose:
            - conditions:
                - condition: sun
                  after: sunrise
                - condition: state
                  entity_id: light.stairs_2
                  state: "off"
                - condition: state
                  entity_id: input_boolean.enable_stairs_motion_triggers
                  state: "on"
              sequence:
                - service: script.send_to_home_log
                  data:
                    message: ":paw_prints: Motion on lower :ladder: stairs and it's night time.
                    Turning ambient :bulb: light on :low_brightness: dim."
                    title: "Porch"
                    log_level: "Debug"
                - service: scene.turn_on
                  target:
                    entity_id: scene.stairs_light_2_on
                  data:
                    transition: 0.5
            - conditions:
                - condition: time
                  after: 00:00:00
                - condition: sun
                  before: sunrise
                - condition: state
                  entity_id: light.stairs_2
                  state: "off"
                - condition: state
                  entity_id: input_boolean.enable_stairs_motion_triggers
                  state: "on"
              sequence:
                - service: script.send_to_home_log
                  data:
                    message: >-
                      :paw_prints: Motion on lower :ladder: stairs and it's night time.
                      Dimming ambient :bulb: :low_brightness: light.
                    title: "Porch"
                    log_level: "Debug"
                - service: scene.turn_on
                  target:
                    entity_id: scene.stairs_light_2_dim
                  data:
                    transition: 0.5
          default: []
    mode: single
  - id: "1598726353326"
    alias: "Stairs: Upstairs Dark, Before Kids Bed Time, Light Off And Motion Detected"
    description: ""
    trigger:
      - entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        platform: state
        to: "on"
      # If Ring integration d/c then fall back to Zigbee specifically.
      - platform: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    condition:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance_lux
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: time
        after: "07:00:00"
        before: "19:45:00"
      - condition: state
        entity_id: light.stairs
        state: "off"
    action:
      - parallel:
        - service: script.send_to_home_log
          data:
            message: >-
              :paw_prints: Motion on the :ladder: upstairs, before bed time
              and it's dark
              ({{ states('sensor.stairs_motion_illuminance_lux', with_unit=True) }} <
              {{ states('input_number.stairs_light_level_threshold', with_unit=True) }}).
              Turning :bulb: :high_brightness: light on.
            title: "Porch"
            log_level: "Debug"
        - service: scene.turn_on
          target:
            entity_id:
              - scene.stairs_light_on
    mode: queued
    max: 10
  - id: "1598726353327"
    alias: "Stairs: Upstairs Dark, Before Kids Bed Time, Light On And Motion Detected"
    description: ""
    trigger:
      - entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        platform: state
        to: "on"
      # If Ring integration d/c then fall back to Zigbee specifically.
      - platform: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    condition:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance_lux
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: time
        after: "07:00:00"
        before: "19:45:00"
      - condition: state
        entity_id: light.stairs
        state: "on"
      - condition: numeric_state
        entity_id: light.stairs
        attribute: brightness
        below: "5"
    action:
      - service: script.send_to_home_log
        data:
          message: >-
            :paw_prints: Motion on upstairs, before bed time, :bulb: light is on
            and it's dark
            ({{ states('sensor.stairs_motion_illuminance_lux', with_unit=True) }} <
            {{ states('input_number.stairs_light_level_threshold', with_unit=True) }}).
            Turning :bulb: :high_brightness: light on.
          title: "Porch"
          log_level: "Debug"
      - service: scene.turn_on
        target:
          entity_id:
            - scene.stairs_light_on
    mode: single
  - id: "1587595659605"
    alias: "Stairs: Upstairs Dark, After Bed Time, Light Off and Motion Detected Before Midnight"
    description: "Deliberately default to dim light because it's safer than having the light go to full
    brightness at night. Bed time ends when the sun is up or after 7am which ever is first."
    trigger:
      - entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        platform: state
        to: "on"
      # If Ring integration d/c then fall back to Zigbee specifically.
      - platform: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    condition:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance_lux
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: time
        after: "19:45:00"
      - condition: state
        entity_id: light.stairs
        state: "off"
    action:
      - parallel:
        - choose:
          - conditions:
              - condition: state
                entity_id: input_select.home_mode
                state: "No Children"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion :ladder: upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and in No Children Mode.
                    Turning stairs :bulb: :high_brightness: light on.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.childrens_bedroom_doors
                state: "off"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion on the and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and
                    :people_holding_hands: children's doors are shut.
                    Turning :bulb: :high_brightness: light on.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.childrens_bedroom_doors
                state: "on"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion on the :ladder: upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and
                    :people_holding_hands: children's :door: doors are open.
                    :bulb: :low_brightness: Dimming light.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_dim
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "off"
              - condition: state
                entity_id: binary_sensor.leos_bedroom_door
                state: "off"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: ":paw_prints: Motion upstairs and it's dark
                  ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and
                  :boy: Leo's :door: door is shut. Turning :bulb: :high_brightness: light on."
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_dim
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "off"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.ashlees_bedroom_door
                state: "off"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and
                    :girl: Ashlee's :door: door is shut.
                    Turning :bulb: :high_brightness: light on.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          default: []
    mode: queued
    max: 10
  - id: "1587595659608"
    alias: "Stairs: Upstairs Dark, After Bed Time, Light On and Motion Detected Before Midnight"
    description: "Deliberately default to dim light because it's safer than having the light go to full
    brightness at night. Bed time ends when the sun is up or after 7am which ever is first."
    trigger:
      - entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        platform: state
        to: "on"
      # If Ring integration d/c then fall back to Zigbee specifically.
      - platform: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    condition:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance_lux
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: time
        after: "19:45:00"
      - condition: state
        entity_id: light.stairs
        state: "on"
      - condition: numeric_state
        entity_id: light.stairs
        attribute: brightness
        below: "5"
    action:
      - parallel:
        - choose:
          - conditions:
              - condition: state
                entity_id: input_select.home_mode
                state: "No Children"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux', with_unit=True) }} <
                    {{ states('input_number.stairs_light_level_threshold', with_unit=True) }})
                    and in No Children Mode. Turning up :bulb: :high_brightness: light.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.childrens_bedroom_doors
                state: "off"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and
                    :people_holding_hands: children's doors are shut.
                    Turning up :bulb: :high_brightness: light.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.childrens_bedroom_doors
                state: "on"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and
                    :people_holding_hands: children's doors are open.
                    :bulb: :low_brightness: Dimming light.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_dim
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "on"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "off"
              - condition: state
                entity_id: binary_sensor.leos_bedroom_door
                state: "off"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and
                    :boy: Leo's door is shut. Turning up :bulb: :high_brightness: light.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          - conditions:
              - not:
                  - condition: state
                    entity_id: input_select.home_mode
                    state: "No Children"
              - condition: state
                entity_id: input_boolean.enable_leos_door_automations
                state: "off"
              - condition: state
                entity_id: input_boolean.enable_ashlees_door_automations
                state: "on"
              - condition: state
                entity_id: binary_sensor.ashlees_bedroom_door
                state: "off"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and
                    :girl: Ashlee's door is shut. Turning up :bulb: :high_brightness: light.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          default: []
    mode: single
  - id: "1587595659606"
    alias: "Stairs: Dark, After Bed Time, Light Off and Motion Detected After Midnight"
    description: "Deliberately default to dim light because it's safer than having the light go to full
    brightness at night. Bed time ends when the sun is up or after 7am which ever is first."
    trigger:
      - entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        platform: state
        to: "on"
      # If Ring integration d/c then fall back to Zigbee specifically.
      - platform: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    condition:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance_lux
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - or:
          - condition: sun
            before: sunrise
          - condition: time
            before: "07:00:00"
      - condition: state
        entity_id: light.stairs
        state: "off"
    action:
      - parallel:
        - choose:
          # Bedroom light is on
          - conditions:
              - condition: state
                entity_id: light.bedroom_lamps
                state: "on"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux', with_unit=True) }} <
                    {{ states('input_number.stairs_light_level_threshold', with_unit=True) }})
                    :bed: bedroom light is on and it's :clock12: late but bedroom light(s) are on.
                    Turning :bulb: :high_brightness: light on.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          # Check if night light settings is turned on.
          - conditions:
              - condition: state
                entity_id: input_boolean.enable_stairs_night_light
                state: "on"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and it's :clock12: late.
                    Turning night :bulb: :low_brightness: light on.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_night_light
          default:
            - service: script.send_to_home_log
              data:
                message: >-
                  :paw_prints: Motion upstairs and it's dark
                  ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and it's :clock12: late.
                  Night mode is turned off so turning :bulb: :high_brightness: light on.
                title: "Porch"
                log_level: "Debug"
            - service: scene.turn_on
              target:
                entity_id: scene.stairs_light_on
    mode: single
  - id: "1587595659607"
    alias: "Stairs: Dark, After Bed Time, Light On and Motion Detected After Midnight"
    description: "Deliberately default to dim light because it's safer than having the light go to full
    brightness at night. Bed time ends when the sun is up or after 7am which ever is first."
    trigger:
      - entity_id: binary_sensor.upstairs_area_motion
        from: "off"
        platform: state
        to: "on"
      # If Ring integration d/c then fall back to Zigbee specifically.
      - platform: state
        entity_id: binary_sensor.upstairs_motion_occupancy
        from: "off"
        to: "on"
    condition:
      - below: input_number.stairs_light_level_threshold
        condition: numeric_state
        entity_id: sensor.stairs_motion_illuminance_lux
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - or:
          - condition: sun
            before: sunrise
          - condition: time
            before: "07:00:00"
      - condition: state
        entity_id: light.stairs
        state: "on"
      - condition: numeric_state
        entity_id: light.stairs
        attribute: brightness
        below: "5"
    action:
      - parallel:
        - choose:
          # Bedroom light is on
          - conditions:
              - condition: state
                entity_id: light.bedroom_lamps
                state: "on"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :paw_prints: Motion upstairs and it's dark
                    ({{ states('sensor.stairs_motion_illuminance_lux', with_unit=True) }} <
                    {{ states('input_number.stairs_light_level_threshold', with_unit=True) }})
                    and it's :clock12: late but bedroom light(s) are on.
                    Turning :bulb: :high_brightness: light on.
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_light_on
          # Check if night light settings is turned on.
          - conditions:
              - condition: state
                entity_id: input_boolean.enable_stairs_night_light
                state: "on"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: ":paw_prints: Motion upstairs and it's dark
                  ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and it's :clock1: late.
                  Turning stairs night :bulb: :low_brightness: light up."
                  title: "Porch"
                  log_level: "Debug"
              - service: scene.turn_on
                target:
                  entity_id: scene.stairs_night_light
          default:
            - service: script.send_to_home_log
              data:
                message: >-
                  :paw_prints: Motion upstairs and it's dark
                  ({{ states('sensor.stairs_motion_illuminance_lux') }} < 5 lux) and it's :clock12: late.
                  Night mode is turned off so turning :bulb: :high_brightness: light on.
                title: "Porch"
                log_level: "Debug"
            - service: scene.turn_on
              target:
                entity_id: scene.stairs_light_on
    mode: single
  - id: "1592062695452"
    alias: "Stairs: Motion Detected And MagicMirror Is Off"
    description: ""
    trigger:
      - entity_id: binary_sensor.lounge_area_motion
        platform: state
        to: "on"
      - entity_id: binary_sensor.stairs_motion_occupancy
        platform: state
        to: "on"
    condition:
      - condition: state
        entity_id: switch.magic_mirror_plug
        state: "off"
      - condition: state
        entity_id: input_boolean.enable_magic_mirror_automations
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
    action:
      - parallel:
        - service: switch.turn_on
          target:
            entity_id: switch.magic_mirror_plug
        - service: script.send_to_home_log
          data:
            message: "Turning on :mirror: Maggic Mirror."
            title: ":paw_prints: Motion on the :ladder: stairs/lounge"
            log_level: "Debug"
    mode: queued
    max: 10
  - id: "1587595847618"
    alias: "Stairs: No Motion Detected"
    description: ""
    trigger:
      - entity_id: binary_sensor.upstairs_area_motion
        for: 00:01:00
        platform: state
        to: "off"
        id: upstairs
      - platform: state
        entity_id: binary_sensor.stairs_motion_occupancy
        to: "off"
        for: 00:01:00
        id: bottom_stairs
    condition:
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
    action:
      - parallel:
        - choose:
            - conditions:
                - condition: trigger
                  id: upstairs
              sequence:
                - parallel:
                  - service: script.send_to_home_log
                    data:
                      message: >-
                        :no_pedestrians: No motion at the top of the stairs for 1 minute.
                        Turning light off.
                      title: "Porch"
                      log_level: "Debug"
                  - service: scene.turn_on
                    target:
                      entity_id: scene.stairs_light_off
                    data:
                      transition: 1
          default: []
        - choose:
            - conditions:
                - condition: state
                  entity_id: light.stairs_2
                  state: "on"
              sequence:
                - parallel:
                  - service: script.send_to_home_log
                    data:
                      message: >-
                        :no_pedestrians: No motion at the bottom of the stairs for 1 minute.
                        Turning ambient light off.
                      title: "Porch"
                      log_level: "Debug"
                  - service: scene.turn_on
                    target:
                      entity_id: scene.stairs_light_2_off
                    data:
                      transition: 2
                  - delay:
                      hours: 0
                      minutes: 0
                      seconds: 1
                      milliseconds: 0
                  - service: light.turn_off
                    target:
                      entity_id: light.stairs_2
          default: []
    mode: queued
    max: 10
  - id: "1624918387840"
    alias: "Stairs: No Motion Detected Bottom Of Stairs"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.stairs_motion_occupancy
        to: "off"
        for: 00:01:00
    condition:
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
      - condition: state
        entity_id: light.stairs_2
        state: "on"
    action:
      - parallel:
        - service: script.send_to_home_log
          data:
            message: >-
              :no_pedestrians: No motion at the bottom of the stairs for 1 minute.
              Turning light off.
            title: "Porch"
            log_level: "Debug"
        - service: scene.turn_on
          target:
            entity_id: scene.stairs_light_2_off
          data:
            transition: 2
    mode: single
  - id: "1591553945554"
    alias: "Stairs: No Motion At Night Turn Off Magic Mirror"
    description: ""
    trigger:
      - entity_id: binary_sensor.stairs_motion_occupancy
        for: 00:03:00
        platform: state
        to: "off"
      - platform: time
        at: "23:30:00"
    condition:
      - after: "23:00:00"
        before: "05:00:00"
        condition: time
      - condition: state
        entity_id: switch.magic_mirror_plug
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_magic_mirror_automations
        state: "on"
    action:
      - parallel:
        - service: switch.turn_off
          target:
            entity_id: switch.magic_mirror_plug
        - service: script.send_to_home_log
          data:
            message: >-
              :clock{{ now().strftime('%I') | int }}{% if now().minute | int > 25 and now().minute | int < 35 %}30{% else %}{% endif %}:
              :no_pedestrians: Turning off :mirror: Maggic Mirror because no motion was detected.
            title: "Porch"
            log_level: "Debug"
    mode: single
  # Contact sensor
  - id: "1615849889104"
    alias: "Stairs: Light On And Children's Door Open After Bedtime And Before Midnight"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.leos_bedroom_door
        from: "off"
        to: "on"
      - platform: state
        entity_id: binary_sensor.ashlees_bedroom_door
        from: "off"
        to: "on"
    condition:
      - condition: time
        after: "19:45:00"
        before: "23:59:59"
      - condition: state
        entity_id: light.stairs
        state: "on"
      - not:
          - condition: state
            entity_id: input_select.home_mode
            state: "No Children"
    action:
      - parallel:
        - choose:
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_leos_door_automations
                  state: "on"
                - condition: state
                  entity_id: binary_sensor.leos_bedroom_door
                  state: "on"
              sequence:
                - service: script.send_to_home_log
                  data:
                    message: >-
                      :paw_prints: :door: :low_brightness: {{ trigger.to_state.name }} opened after bed time and
                      the stairs light are on. :bulb: :low_brightness: Dimming all lights.
                    log_level: "Debug"
                - service: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_dim
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_ashlees_door_automations
                  state: "on"
                - condition: state
                  entity_id: binary_sensor.ashlees_bedroom_door
                  state: "on"
              sequence:
                - service: script.send_to_home_log
                  data:
                    message: >-
                      :door: :high_brightness: {{ trigger.to_state.name }} opened after bed time and
                      the stairs light are on. :bulb: :low_brightness: Dimming all lights.
                    log_level: "Debug"
                - service: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_on
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
          default: []
    mode: queued
    max: 10
  - id: "1615850302527"
    alias: "Stairs: Light On And Children's Door Closed Before Midnight"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.leos_bedroom_door
        from: "on"
        to: "off"
      - platform: state
        entity_id: binary_sensor.ashlees_bedroom_door
        from: "on"
        to: "off"
    condition:
      - condition: time
        after: "19:45:00"
        before: "23:59:59"
      - condition: state
        entity_id: light.stairs
        state: "on"
      - condition: state
        entity_id: input_select.home_mode
        state: "Normal"
    action:
      - parallel:
        - choose:
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_leos_door_automations
                  state: "on"
                - condition: state
                  entity_id: input_boolean.enable_ashlees_door_automations
                  state: "on"
                - condition: state
                  entity_id: binary_sensor.childrens_bedroom_doors
                  state: "off"
              sequence:
                - service: script.send_to_home_log
                  data:
                    message: >-
                      :door: :high_brightness: {{ trigger.to_state.name }} closed after bed time, :people_holding_hands:
                      children's :door: doors are closed and the light are on. Turn up :bulb: :high_brightness: all lights.
                    log_level: "Debug"
                - service: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_on
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_leos_door_automations
                  state: "on"
                - condition: state
                  entity_id: input_boolean.enable_ashlees_door_automations
                  state: "off"
                - condition: state
                  entity_id: binary_sensor.leos_bedroom_door
                  state: "off"
              sequence:
                - service: script.send_to_home_log
                  data:
                    message:
                      ":boy: Leo's :door: door closed after bed time and the
                      lights are on. Turn up :bulb: :high_brightness: all lights."
                    log_level: "Debug"
                - service: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_on
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
            - conditions:
                - condition: state
                  entity_id: input_boolean.enable_leos_door_automations
                  state: "off"
                - condition: state
                  entity_id: input_boolean.enable_ashlees_door_automations
                  state: "on"
                - condition: state
                  entity_id: binary_sensor.ashlees_bedroom_door
                  state: "off"
              sequence:
                - service: script.send_to_home_log
                  data:
                    message: >-
                      :girl: Ashlee's :door: door closed after bed time and the
                      stairs light are on. Turn up :bulb: :high_brightness: all lights.
                    log_level: "Debug"
                - service: scene.turn_on
                  target:
                    entity_id:
                      - scene.stairs_light_on
                      - scene.stairs_light_2_on
                  data:
                    transition: 0.5
          default: []
    mode: single
  # Timed
  - id: "1588856667889"
    alias: "MagicMirror: Turn Off Based On Time During Weekday"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.stairs_motion_occupancy
        to: "off"
        for: 00:05:00
        from: "on"
    condition:
      - condition: time
        after: 09:00:00
        before: "17:30:00"
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
      - condition: state
        entity_id: input_boolean.enable_magic_mirror_automations
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_stairs_motion_triggers
        state: "on"
    action:
      - parallel:
        - service: switch.turn_off
          target:
            entity_id: switch.magic_mirror_plug
        - service: script.send_to_home_log
          data:
            message: ":no_pedestrians: No motioned detected. Turning off :mirror: Magic Mirror based on time of the day."
            title: "Porch"
            log_level: "Debug"
    mode: single
  - id: "1630760046947"
    alias: "Stairs: Close Blinds At Night"
    description: ""
    trigger:
      - platform: sun
        event: sunset
        offset: 01:00:00
    condition:
      - condition: state
        entity_id: cover.stairs_blinds
        state: "open"
      - condition: state
        entity_id: input_boolean.enable_stairs_blind_automations
        state: "on"
    action:
      - parallel:
        - service: script.send_to_home_log
          data:
            message: ":city_sunrise: :window: Closing blinds."
            title: "Porch"
            log_level: "Debug"
        - service: cover.close_cover
          target:
            entity_id: cover.stairs_blinds
    mode: single
  - id: "1630760149356"
    alias: "Stairs: Open Blinds In The Morning"
    description: ""
    trigger:
      - platform: time
        at: "08:00:00"
    condition:
      - condition: state
        entity_id: cover.stairs_blinds
        state: "closed"
      - condition: state
        entity_id: input_boolean.enable_stairs_blind_automations
        state: "on"
    action:
      - parallel:
        - service: script.send_to_home_log
          data:
            message: ":sunrise: Opening blinds."
            title: "Porch"
            log_level: "Debug"
        - service: cover.open_cover
          target:
            entity_id: cover.stairs_blinds
    mode: single
  # Camera
  - id: "1630015410190"
    alias: "Stairs: Person Detected"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.stairs_person_detected
        from: "off"
        to: "on"
    condition:
      - condition: state
        entity_id: alarm_control_panel.house_alarm
        state: "armed_away"
    action:
      - parallel:
        - service: camera.snapshot
          data_template:
            filename:
              "{{ states('input_text.latest_frigate_upstairs_person_file_path')
              }}"
          target:
            entity_id: camera.stairs
        - service: script.send_home_log_with_local_attachments
          data_template:
            title: Person detected on stairs
            message: Frigate detected a person on the stairs.
            filePath:
              "{{ states('input_text.latest_frigate_upstairs_person_file_path')
              }}"
    mode: queued
    max: 10
  # Smoke alarm
  - id: "1646778676344"
    alias: "Stairs: Cabon Monoxide Detected"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.nest_protect_upstairs_co_status
        to: "on"
    condition: []
    action:
      - parallel:
        - service: script.send_direct_notification
          data:
            title: ":skull_and_crossbones: CO Detected on the stairs"
            message: ":skull_and_crossbones: Carbon Monide detected on the stairs."
        - service: script.set_central_heating_to_off
          data: {}
        - service: script.set_how_water_to_home_mode
          data: {}
    mode: single
  - id: "1646778927329"
    alias: "Stairs: Smoked Detected"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.nest_protect_upstairs_smoke_status
        to: "on"
    condition: []
    action:
      - parallel:
        - service: script.send_direct_notification
          data:
            title: ":smoking: Smoke detected on the stairs"
            message: ":smoking: Smoke detected on the stairs."
        - service: script.set_central_heating_to_off
          data: {}
        - service: script.set_how_water_to_home_mode
          data: {}
    mode: single

scene:
  - id: "1609512133205"
    name: "Stairs: Turn Light On"
    icon: mdi:lightbulb
    entities:
      light.stairs:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 153
        color_temp: 285
        friendly_name: Stairs Light
        supported_features: 55
        state: "on"
  - id: "stairs_light_off"
    name: "Stairs: Turn Light Off"
    icon: mdi:lightbulb
    entities:
      light.stairs:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Stairs Light
        supported_features: 55
        state: "off"
  - id: "1612221653166"
    name: "Stairs: Dim Light"
    icon: mdi:lightbulb
    entities:
      light.stairs:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 5
        color_temp: 255
        friendly_name: Stairs Light
        supported_features: 55
        state: "on"
  - id: "1623880439954"
    name: Stairs Light 2 On
    icon: mdi:led-strip-variant
    entities:
      light.stairs_2:
        min_mireds: 155
        max_mireds: 495
        effect_list:
          - colorloop
          - random
        supported_color_modes:
          - color_temp
          - hs
        color_mode: color_temp
        brightness: 255
        color_temp: 430
        effect: none
        friendly_name: Stairs 2
        supported_features: 63
        state: "on"
  - id: "1623970390049"
    name: Stairs 2 Light Dim
    icon: mdi:led-strip-variant
    entities:
      light.stairs_2:
        min_mireds: 155
        max_mireds: 495
        effect_list:
          - colorloop
          - random
        supported_color_modes:
          - color_temp
          - hs
        color_mode: color_temp
        brightness: 38
        color_temp: 430
        effect: none
        friendly_name: Stairs 2
        supported_features: 63
        state: "on"
  - id: "stairs_light_2_off"
    name: Stairs Light 2 Off
    icon: mdi:led-strip-variant
    entities:
      light.stairs_2:
        min_mireds: 155
        max_mireds: 495
        effect_list:
          - colorloop
          - random
        supported_color_modes:
          - color_temp
          - hs
        color_mode: color_temp
        brightness: 0
        color_temp: 430
        effect: none
        friendly_name: Stairs 2
        supported_features: 63
        state: "on"
  - id: "1612220515925"
    name: "Landing: Set Light To Blue"
    entities:
      light.stairs:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 128
        hs_color:
          - 237.66
          - 100
        rgb_color:
          - 0
          - 9
          - 255
        xy_color:
          - 0.136
          - 0.041
        friendly_name: Stairs Light
        supported_features: 55
        state: "on"
  - id: "1612220555547"
    name: Landing Set Light To Red
    entities:
      light.stairs:
        min_mireds: 111
        max_mireds: 666
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        supported_color_modes:
          - color_temp
          - hs
        color_mode: hs
        brightness: 128
        hs_color:
          - 357.193
          - 100
        rgb_color:
          - 255
          - 0
          - 11
        xy_color:
          - 0.698
          - 0.298
        friendly_name: Stairs Light
        supported_features: 55
        state: "on"
  - id: "1631754396696"
    name: Stairs Night Light
    entities:
      light.stairs:
        min_mireds: 111
        max_mireds: 666
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        supported_color_modes:
          - color_temp
          - hs
        color_mode: hs
        brightness: 5
        hs_color:
          - 358.599
          - 100
        rgb_color:
          - 255
          - 0
          - 5
        xy_color:
          - 0.7
          - 0.299
        friendly_name: Stairs Light
        supported_features: 55
        state: "on"
