# Created by Danny Tsang <danny@tsang.uk>
automation:
  # Lights related automation.
  - id: "1583956425622"
    alias: "Lounge: Dark And Motion Detected"
    description: Added a second delay https://community.home-assistant.io/t/hue-motion-sensor-with-illuminance-condition/128290
    trigger:
      - entity_id: binary_sensor.lounge_area_motion
        platform: state
        to: "on"
        from: "off"
      - platform: state
        entity_id: binary_sensor.lounge_motion
        to: "on"
      - platform: state
        entity_id: binary_sensor.lounge_motion_2_occupancy
        to: "on"
      - platform: state
        entity_id: binary_sensor.lounge_motion_3_occupancy
        to: "on"
    condition:
      - and:
          - condition: state
            entity_id: input_boolean.enable_lounge_motion_triggers
            state: "on"
          - or:
              - below: input_number.lounge_light_level_2_threshold
                condition: numeric_state
                entity_id: sensor.lounge_motion_2_illuminance
              - below: input_number.lounge_light_level_3_threshold
                condition: numeric_state
                entity_id: sensor.lounge_motion_3_illuminance_lux
          - or:
              - condition: numeric_state
                entity_id: light.lounge_lamp_left
                attribute: brightness
                below: "190"
              - condition: numeric_state
                entity_id: light.lounge_lamp_right
                attribute: brightness
                below: "190"
              - condition: template
                value_template: "{{ state_attr('light.lounge_lamp_left', 'brightness') == none }}"
              - condition: template
                value_template: "{{ state_attr('light.lounge_lamp_right', 'brightness') == none }}"
    action:
      - parallel:
          - choose:
              - conditions:
                  - condition: state
                    entity_id: group.terinas_work_computer
                    state: home
                  - or:
                      - below: input_number.lounge_light_level_2_threshold
                        condition: numeric_state
                        entity_id: sensor.lounge_motion_2_illuminance
                      - below: input_number.lounge_light_level_3_threshold
                        condition: numeric_state
                        entity_id: sensor.lounge_motion_3_illuminance_lux
                sequence:
                  - data:
                      message: >-
                        :paw_prints: Motion detected and it's dark
                        ({{ states('sensor.lounge_motion_2_illuminance')
                        }} & {{ states('sensor.lounge_motion_3_illuminance_lux') }} <
                        {{ states('input_number.lounge_light_level_2_threshold') }} &
                        {{ states('input_number.lounge_light_level_3_threshold', with_unit=True) }})
                        and Terina's work :computer: computer is on. Turning lounge
                        :bulb: :high_brightness: lights on.
                      title: ":couch_and_lamp: Lounge"
                    service: script.send_to_home_log
                  - service: scene.turn_on
                    target:
                      entity_id: scene.lounge_lights
              - conditions:
                  - or:
                      - below: input_number.lounge_light_level_2_threshold
                        condition: numeric_state
                        entity_id: sensor.lounge_motion_2_illuminance
                      - below: input_number.lounge_light_level_3_threshold
                        condition: numeric_state
                        entity_id: sensor.lounge_motion_3_illuminance_lux
                sequence:
                  - service: script.send_to_home_log
                    data:
                      message: >-
                        :paw_prints: Motion detected and it's dark
                        ({{ states('sensor.lounge_motion_2_illuminance') }} &
                        {{ states('sensor.lounge_motion_3_illuminance_lux') }} <
                        {{ states('input_number.lounge_light_level_2_threshold') }} &
                        {{ states('input_number.lounge_light_level_3_threshold', with_unit=True) }})
                        and Terina's work :computer: computer is on. Turning
                        :bulb: :high_brightness: lights on.
                      title: ":couch_and_lamp: Lounge"
                  - service: scene.turn_on
                    target:
                      entity_id: scene.lounge_lights
            default: []
    mode: queued
    max: 10
  - id: "1606170045630"
    alias: "Lounge: No Motion After 10 Minutes And TV Is Off Dim Lights"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.lounge_area_motion
        to: "off"
        for: 00:10:00
        id: doug_off
      - platform: state
        entity_id: binary_sensor.lounge_area_motion
        to: "off"
        for: 00:15:00
        id: doug_on
    condition:
      - condition: state
        entity_id: input_boolean.enable_lounge_motion_triggers
        state: "on"
      - condition: numeric_state
        entity_id: sensor.tv_plug_active_power
        below: input_number.tv_plug_powered_on_threshold
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: device_tracker.doug
                state: "home"
              - condition: trigger
                id: doug_on
            sequence:
              - parallel:
                  - service: script.send_to_home_log
                    data:
                      message: >-
                        :no_pedestrians: No motion for 15 minutes and :tv: TV is off but :computer: computer is on.
                        :bulb: :low_brightness: Dimming lights
                      title: ":couch_and_lamp: Lounge"
                  - service: scene.turn_on
                    target:
                      entity_id: scene.lounge_dim_lights
                    data:
                      transition: 2
        default:
          - parallel:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :no_pedestrians: No motion for 15 minutes and :tv: TV and :computer: is off.
                    :bulb: :low_brightness: Dimming lights
                  title: ":couch_and_lamp: Lounge"
              - service: scene.turn_on
                target:
                  entity_id: scene.lounge_dim_lights
                data:
                  transition: 2
    mode: single
  - id: "1605567425876"
    alias: "Lounge: No Motion After 15 Minutes"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.lounge_area_motion
        from: "on"
        to: "off"
        for: 00:15:00
        id: doug_off
      - platform: state
        entity_id: binary_sensor.lounge_area_motion
        from: "on"
        to: "off"
        for: 00:20:00
        id: doug_on
    condition:
      - condition: state
        entity_id: input_boolean.enable_lounge_motion_triggers
        state: "on"
      - condition: numeric_state
        entity_id: sensor.tv_plug_active_power
        below: input_number.tv_plug_powered_on_threshold
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: device_tracker.doug
                state: "home"
              - condition: trigger
                id: doug_on
            sequence:
              - parallel:
                  - service: script.send_to_home_log
                    data:
                      message: >-
                        :no_pedestrians: No motion for 20 minutes and
                        :tv: TV is off and :computer: computer is on. Turning lounge lights off.
                      title: ":couch_and_lamp: Lounge"
                  - service: scene.turn_on
                    target:
                      entity_id: scene.lounge_lights_off
                    data:
                      transition: 2
        default:
          - parallel:
              - service: script.send_to_home_log
                data:
                  message: >-
                    :no_pedestrians: No motion for 15 minutes and
                    :tv: TV is turned off. Turning lounge lights off.
                  title: ":couch_and_lamp: Lounge"
              - service: scene.turn_on
                target:
                  entity_id: scene.lounge_lights_off
                data:
                  transition: 2
    mode: single
  - id: "1610388245160"
    alias: "Lounge: TV Turned Off Dim Lights"
    description: "TV is turned off and dim lights if there has been no motion."
    trigger:
      - platform: numeric_state
        entity_id: sensor.tv_plug_active_power
        below: input_number.tv_plug_powered_on_threshold
        for: 00:05:00
    condition:
      - condition: state
        entity_id: light.lounge_lamps
        state: "on"
      - condition: state
        entity_id: binary_sensor.lounge_area_motion
        state: "off"
      - condition: state
        entity_id: binary_sensor.lounge_area_motion
        state: "off"
        for:
          hours: 0
          minutes: 5
          seconds: 0
      - condition: state
        entity_id: device_tracker.doug
        state: "not_home"
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: ":tv: TV turned off for 5 minutes. :bulb: :low_brightness: Dimming lights."
              title: ":couch_and_lamp: Lounge"
          - service: scene.turn_on
            target:
              entity_id: scene.lounge_dim_lights
            data:
              transition: 2
    mode: single
  - id: "1610409803685"
    alias: "Lounge: TV Turned Off Turn Off Lights"
    description: "TV is turned off and turn lights off if there has been no motion."
    trigger:
      - platform: numeric_state
        entity_id: sensor.tv_plug_active_power
        for: 00:10:00
        below: input_number.tv_plug_powered_on_threshold
    condition:
      - condition: state
        entity_id: light.lounge_lamps
        state: "on"
      - condition: state
        entity_id: binary_sensor.lounge_area_motion
        state: "off"
      - condition: state
        entity_id: binary_sensor.lounge_area_motion
        state: "off"
        for:
          hours: 0
          minutes: 10
          seconds: 0
      - condition: state
        entity_id: device_tracker.doug
        state: "not_home"
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: ":tv: TV turned off for 10 minutes. Turning lights off."
              title: ":couch_and_lamp: Lounge"
          - service: scene.turn_on
            target:
              entity_id: scene.lounge_lights_off
            data:
              transition: 2
    mode: single
  # Alarm
  - id: "1588859622571"
    alias: "Lounge: Motion Detected In The Morning"
    description: ""
    trigger:
      - entity_id: binary_sensor.lounge_motion
        platform: state
        to: "on"
      - entity_id: binary_sensor.stairs_motion_occupancy
        platform: state
        to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.enable_morning_routine
        state: "on"
      - condition: state
        entity_id: group.adult_people
        state: home
      - condition: state
        entity_id: alarm_control_panel.house_alarm
        state: armed_home
    action:
      - data: {}
        service: script.morning_script
    mode: single
  # Bay Window
  - id: "1608493783373"
    alias: "Lounge: Bay Window High Temperature"
    description: ""
    trigger:
      - platform: event
        event_type: ifttt_webhook_received
        event_data:
          action: bay_window_high_temp
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message:
                ":warning: :thermometer: Bay window is above 35c. Turning server fan
                on."
              title: "Ubibot via IFTTT"
          - service: switch.turn_on
            target:
              entity_id: switch.server_fan
    mode: single
  - id: "1608493853210"
    alias: "Lounge: Bay Window Below High Temperature"
    description: ""
    trigger:
      - platform: event
        event_type: ifttt_webhook_received
        event_data:
          action: bay_window_low_temp
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message:
                ":thermometer: :snowflake: Bay window below high temperature. Turning
                server fan off."
              title: "Ubibot via IFTTT"
          - service: switch.turn_off
            target:
              entity_id: switch.server_fan
    mode: single
  - id: "1611063957341"
    alias: "Lounge: Server Fan Running Longer Than 1 Hour"
    description: ""
    trigger:
      - platform: state
        entity_id: switch.server_fan
        to: "on"
        for: 01:00:00
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message:
                Server fan has been running for more than 1 hour. Consider turning
                Fan off.
              title: ":couch_and_lamp: Lounge"
          - if:
              - condition: state
                entity_id: input_boolean.enable_direct_notifications
                state: "on"
            then:
              - service: script.send_actionable_notification_with_2_buttons
                data:
                  message: Turn off server fan?
                  title: Server fan on for over 1 hour
                  people:
                    - person.danny
                  action1_title: "Yes"
                  action1_name: server_fan_off
                  action2_title: "No"
                  action2_name: ignore
    mode: single
  # Blinds
  - id: "1677711735249"
    alias: "Lounge: Open Blinds In The Morning"
    description: ""
    trigger:
      - platform: time
        at: "07:30:00"
    condition:
      - condition: state
        entity_id: input_boolean.enable_lounge_blind_automations
        state: "on"
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: Opening blinds 25%.
              title: ":couch_and_lamp: Lounge"
          - service: cover.set_cover_tilt_position
            data:
              tilt_position: 25
            target:
              entity_id:
                - cover.lounge_blinds_left
                - cover.lounge_blinds_middle
                - cover.lounge_blinds_right
    mode: single
  - id: "1677711735250"
    alias: "Lounge: Open Blinds In The Morning 2"
    description: ""
    trigger:
      - platform: time
        at: "08:00:00"
    condition:
      - condition: state
        entity_id: input_boolean.enable_lounge_blind_automations
        state: "on"
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: Opening blinds fully.
              title: ":couch_and_lamp: Lounge"
          - service: cover.set_cover_tilt_position
            data:
              tilt_position: 50
            target:
              entity_id:
                - cover.lounge_blinds_left
          - service: cover.set_cover_tilt_position
            data:
              tilt_position: 50
            target:
              entity_id:
                - cover.lounge_blinds_middle
    mode: single
  - id: "1677969986113"
    alias: "Lounge: Close Blinds In The Evening"
    description: ""
    trigger:
      - platform: time
        at: "19:30:00"
    condition:
      - condition: state
        entity_id: input_boolean.enable_lounge_blind_automations
        state: "on"
    action:
      - service: cover.set_cover_tilt_position
        data:
          tilt_position: 0
        target:
          entity_id:
            - cover.lounge_blinds_left
            - cover.lounge_blinds_middle
            - cover.lounge_blinds_right
    mode: single
  # Camera
  - id: "1630015457540"
    alias: "Lounge: Person Detected"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.lounge_person_motion
        from: "off"
        to: "on"
    condition:
      - condition: state
        entity_id: switch.lounge_detect
        state: "on"
    action:
      - service: camera.snapshot
        data_template:
          filename:
            "{{ states('input_text.latest_frigate_lounge_person_file_path')
            }}"
        target:
          entity_id: camera.lounge_person
      - service: script.send_home_log_with_local_attachments
        data_template:
          message: Frigate detected a person in the lounge.
          title: ":bust_in_silhouette: Person detected in :couch_and_lamp: lounge"
          filePath:
            "{{ states('input_text.latest_frigate_lounge_person_file_path')
            }}"
    mode: queued
    max: 10
  # door / window
  - id: "1631454174806"
    alias: "Lounge: Door or Window Open"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.lounge_door_and_windows
        from: "off"
        to: "on"
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: >-
                :door: :window: Door/window opened.
                Turning lounge :camera_with_flash: camera on.
              title: ":couch_and_lamp: Lounge"
          - service: script.lounge_turn_on_camera
    mode: single
  - id: "1631454249839"
    alias: "Lounge: Door Or Windows Closed"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.lounge_door_and_windows
        from: "on"
        to: "off"
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: "All :door: :window: doors/windows closed. Turning lounge :camera: camera off."
              title: ":couch_and_lamp: Lounge"
          - service: script.lounge_turn_off_camera
    mode: single
  # Switches
  - id: "1610918759041"
    alias: "Lounge: Restart Harmony Hub"
    description: ""
    trigger:
      - platform: time
        at: 03:00:00
    condition:
      - condition: time
        weekday:
          - mon
      - condition: state
        entity_id: binary_sensor.tv_powered_on
        state: "off"
    action:
      - service: script.send_to_home_log
        data:
          message: ":TV: Restarting Harmony hub."
          title: ":couch_and_lamp: Lounge"
      - service: switch.turn_off
        target:
          entity_id: switch.harmony_hub_plug
      - delay:
          hours: 0
          minutes: 1
          seconds: 0
          milliseconds: 0
      - service: switch.turn_on
        target:
          entity_id: switch.harmony_hub_plug
    mode: single
  - id: "1610388192224"
    alias: "Lounge: TV Turned On"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.tv_powered_on
        to: "on"
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: ":tv: TV Turned on."
              title: ":couch_and_lamp: Lounge"
          - choose:
              - conditions:
                  - condition: state
                    entity_id: binary_sensor.playstation_powered_on
                    state: "off"
                sequence:
                  - service: script.lounge_select_vcr_dvr_input
            default:
              - service: script.lounge_select_game_input
          - if:
              - condition: state
                entity_id: light.lounge_tv
                state: "off"
            then:
              - parallel:
                  - service: script.send_to_home_log
                    data:
                      message: "Turning on :tv: TV backlight."
                      title: ":couch_and_lamp: Lounge"
                  - service: light.turn_on
                    data: {}
                    target:
                      entity_id: light.lounge_tv
    mode: single
  - id: "1610388192225"
    alias: "Lounge: TV Turned Off"
    description: ""
    trigger:
      - platform: state
        entity_id: binary_sensor.tv_powered_on
        from: "on"
        to: "off"
        for: 00:00:30
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: ":tv: TV Turned off."
              title: ":couch_and_lamp: Lounge"
          - sequence:
              - if:
                  - condition: state
                    entity_id: light.lounge_tv
                    state: "on"
                then:
                  - parallel:
                      - service: script.send_to_home_log
                        data:
                          message: "Turning off :tv: TV backlight."
                          title: ":couch_and_lamp: Lounge"
                      - service: light.turn_off
                        data: {}
                        target:
                          entity_id: light.lounge_tv
              - delay:
                  hours: 0
                  minutes: 0
                  seconds: 5
                  milliseconds: 0
              - if:
                  - condition: state
                    entity_id: light.tv_backlight
                    state: "on"
                then:
                  - parallel:
                      - service: script.send_to_home_log
                        data:
                          message: "Turning off :tv: TV backlight (WLED)."
                          title: ":couch_and_lamp: Lounge"
                      - service: light.turn_off
                        data: {}
                        target:
                          entity_id: light.tv_backlight
    mode: single
  # People / Devices
  - id: "1654005357582"
    alias: "Lounge: Terina's Work Laptop Turned Off"
    description: ""
    trigger:
      - platform: state
        entity_id:
          - group.terinas_work_computer
        not_from: unavailable
        to: not_home
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: Terina's work laptop turned off.
              title: ":couch_and_lamp: Lounge"
          - service: script.check_terinas_work_laptop_status
            data: {}
    mode: single
  - id: "1654005357583"
    alias: "Lounge: Terina's Work Laptop Turned On"
    description: ""
    trigger:
      - platform: state
        entity_id:
          - group.terinas_work_computer
        not_from: unavailable
        to: not_home
    condition: []
    action:
      - parallel:
          - service: script.send_to_home_log
            data:
              message: Terina's work laptop turned on.
              title: ":couch_and_lamp: Lounge"
          - service: script.check_terinas_work_laptop_status
            data: {}
    mode: single

scene:
  - id: "1582387315374"
    name: Lounge Lights On
    entities:
      light.lounge_lamp_left:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 240
        color_temp: 310
        friendly_name: Lounge Left Lamp
        icon: mdi:floor-lamp
        supported_features: 55
        state: "on"
      light.lounge_lamp_right:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 240
        color_temp: 310
        friendly_name: Lounge Right Lamp
        icon: mdi:floor-lamp
        supported_features: 55
        state: "on"
  - id: "1606169827098"
    name: Lounge Dim Lights
    entities:
      light.lounge_lamp_left:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 76
        color_temp: 285
        friendly_name: Lounge Left Lamp
        icon: mdi:floor-lamp
        supported_features: 55
        state: "on"
      light.lounge_lamp_right:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        brightness: 76
        color_temp: 285
        friendly_name: Lounge Right Lamp
        icon: mdi:floor-lamp
        supported_features: 55
        state: "on"
  - id: "1582455234238"
    name: Lounge Lights Off
    entities:
      light.lounge_lamp_right:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Lounge Right Lamp
        icon: mdi:floor-lamp
        supported_features: 55
        state: "off"
      light.lounge_lamp_left:
        min_mireds: 111
        max_mireds: 400
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        friendly_name: Lounge Left Lamp
        icon: mdi:floor-lamp
        supported_features: 55
        state: "off"
  - id: "1634579522178"
    name: "Lounge: Lights Green"
    entities:
      light.lounge_lamp_left:
        min_mireds: 111
        max_mireds: 666
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        supported_color_modes:
          - color_temp
          - hs
        color_mode: hs
        brightness: 255
        hs_color:
          - 119.533
          - 100
        rgb_color:
          - 1
          - 255
          - 0
        xy_color:
          - 0.173
          - 0.747
        friendly_name: Lounge Left Lamp
        icon: mdi:floor-lamp
        supported_features: 55
        state: "on"
      light.lounge_lamp_right:
        min_mireds: 111
        max_mireds: 666
        effect_list:
          - effect_colorloop
          - effect_pulse
          - effect_stop
        supported_color_modes:
          - color_temp
          - hs
        color_mode: hs
        brightness: 255
        hs_color:
          - 119.533
          - 100
        rgb_color:
          - 1
          - 255
          - 0
        xy_color:
          - 0.173
          - 0.747
        friendly_name: Lounge Right Lamp
        icon: mdi:floor-lamp
        supported_features: 55
        state: "on"
    icon: mdi:lamp

script:
  # Camera
  lounge_turn_off_camera:
    alias: Lounge Turn Off Camera
    sequence:
      - choose:
          - conditions:
              - or:
                  - not:
                      - condition: state
                        entity_id: alarm_control_panel.house_alarm
                        state: disarmed
                  - condition: state
                    entity_id: binary_sensor.front_door
                    state: "on"
            sequence:
              - service: script.send_to_home_log
                data:
                  message: "Alarm is on or front door is open. Keeping lounge:camera_with_flash: camera detection on."
        default:
          - service: script.send_to_home_log
            data:
              message: "Turning lounge :camera: camera detection off."
          - service: switch.turn_off
            target:
              entity_id:
                - switch.lounge_detect
                - switch.lounge_snapshots
    mode: single
    icon: mdi:cctv
  lounge_turn_on_camera:
    alias: Lounge Turn On Camera
    sequence:
      - service: script.send_to_home_log
        data:
          message: "Turning lounge :camera_with_flash: camera detection on."
      - service: switch.turn_on
        target:
          entity_id:
            - switch.lounge_detect
            - switch.lounge_snapshots
    mode: single
    icon: mdi:cctv
  # Receiver
  lounge_select_game_input:
    sequence:
      - service: script.send_to_home_log
        data:
          message: "Changing Onkyo to :tv: BD/DVD input."
      - delay:
          hours: 0
          minutes: 0
          seconds: 13
          milliseconds: 0
      - service: remote.send_command
        target:
          entity_id: remote.living_room
        data:
          device: Onkyo AV Receiver
          command: InputBd/Dvd
      - service: script.send_to_home_log
        data:
          message: "Changed Onkyo to :tv: BD/DVD input."
    mode: single
    alias: Lounge Reciever Select Game Input
    icon: mdi:audio-video
  lounge_select_vcr_dvr_input:
    sequence:
      - service: script.send_to_home_log
        data:
          message: "Changing Onkyo to :tv: BD/DVD input."
          title: "Harmony Remote"
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - service: remote.send_command
        target:
          entity_id: remote.living_room
        data:
          device: Onkyo AV Receiver
          command: InputBd/Dvd
      - service: script.send_to_home_log
        data:
          message: "Changed Onkyo to :tv: BD/DVD input."
          title: "Harmony Remote"
      - service: remote.send_command
        data:
          device: Samsung TV
          command: InputHdmi2
        target:
          entity_id: remote.living_room
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
      - service: remote.send_command
        target:
          entity_id: remote.living_room
        data:
          device: Onkyo AV Receiver
          command: InputBd/Dvd
    mode: single
    alias: Lounge Reciever Select VCR/DVR Input
    description: >-
      Cater for Onkyo / Samsung where the HDMI input select changes
      to TV after the 2 devices are powered on."
    icon: mdi:audio-video
  lounge_flash_lounge_lights_green:
    alias: "Lounge: Flash Lounge Lights Green"
    sequence:
      - service: scene.create
        data:
          scene_id: current_lounge_lights
          snapshot_entities:
            - light.lounge_lamp_left
            - light.lounge_lamp_right
      - service: scene.turn_on
        target:
          entity_id: scene.lounge_lights_green
        data:
          transition: 0
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 500
      - service: scene.turn_on
        target:
          entity_id: scene.current_lounge_lights
    mode: single
    icon: mdi:lamp

sensor:
  - platform: history_stats
    name: TV Uptime Today
    entity_id: binary_sensor.tv_powered_on
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: TV Uptime Yesterday
    entity_id: binary_sensor.tv_powered_on
    state: "on"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      hours: 24
  - platform: history_stats
    name: TV Uptime This Week
    entity_id: binary_sensor.tv_powered_on
    state: "on"
    type: time
    start: "{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: TV Uptime Last 30 Days
    entity_id: binary_sensor.tv_powered_on
    state: "on"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      days: 30

template:
  - binary_sensor:
      - name: Playstation Powered On
        unique_id: dee5115e-8e1b-4b3d-b6e5-af3da26f574a
        device_class: "running"
        icon: "mdi:controller{{ '' if states('sensor.playstation_plug_active_power') | float(0) > 15 else '-off' }}"
        state: "{{ states('sensor.playstation_plug_active_power') | float(0) > 15 }}"
      - name: TV Powered On
        unique_id: 018dca5f-259c-4c2e-94b3-0195359ac572
        device_class: "running"
        icon: "mdi:television-classic{{ '' if states('sensor.tv_plug_active_power') | float(0) > 10 else '-off' }}"
        state: "{{ states('sensor.tv_plug_active_power') | float(0) > 10 }}"
      - name: Sky Powered On
        device_class: "running"
        icon: "mdi:television-classic{{ '' if states('sensor.sky_plug_active_power') | float(0) > 15 else '-off' }}"
        state: "{{ states('sensor.sky_plug_active_power') | float(0) > 15 }}"
  - sensor:
      - name: Thermostat Target Temperature
        unique_id: e4890bce-7126-416b-8a5f-1bd6a7bd9ac0
        unit_of_measurement: C
        device_class: "temperature"
        state: "{{ state_attr('climate.thermostat', 'temperature') | float(0) }}"
