# Created by Danny Tsang <danny@tsang.uk>
automation:
  - id: "1583797341647"
    alias: "Kitchen: Turn Off Lights At Night"
    description: ""
    triggers:
      - trigger: time
        at: "23:30:00"
    conditions:
      - condition: state
        entity_id: light.kitchen_lights
        state: "on"
    actions:
      - action: script.send_to_home_log
        data:
          message: >-
            :clock{{ now().strftime('%I') | int }}{% if now().minute | int > 25 and now().minute | int < 35 %}30{% else %}{% endif %}:
            Turning main lights off"
          title: "üßë‚Äçüç≥ Kitchen"
          log_level: "Debug"
      - action: scene.turn_on
        target:
          entity_id: scene.kitchen_main_lights_off
        data:
          transition: 2
    mode: single
  - id: "1606158191303"
    alias: "Kitchen: Motion Detected Table Lights Off"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_area_motion
          - binary_sensor.kitchen_motion_occupancy
          - binary_sensor.kitchen_motion_pir
          - binary_sensor.kitchen_motion_mmwave
          - binary_sensor.kitchen_motion_2_occupancy
        to: "on"
    conditions:
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
      - or:
          - condition: state
            entity_id: light.kitchen_table_white
            state: "off"
          - and:
              - condition: state
                entity_id: light.kitchen_table_white
                state: "on"
              - condition: numeric_state
                entity_id: light.kitchen_table_white
                attribute: brightness
                below: 100
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                üêæ Motion detected.
                Turning table üí° üîÜ lights on.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: scene.turn_on
            target:
              entity_id: scene.kitchen_table_lights_on
          - action: timer.cancel
            target:
              entity_id:
                - timer.kitchen_cooker_light_dim
                - timer.kitchen_cooker_light_off
                - timer.kitchen_table_light_dim
                - timer.kitchen_table_light_off
    mode: queued
    max: 10
  - id: "1606158191306"
    alias: "Kitchen: Motion Detected Cooker Lights Off"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_area_motion
          - binary_sensor.kitchen_motion_occupancy
          - binary_sensor.kitchen_motion_pir
          - binary_sensor.kitchen_motion_mmwave
          - binary_sensor.kitchen_motion_2_occupancy
        to: "on"
    conditions:
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
      - condition: state
        entity_id: light.kitchen_cooker_white
        state: "off"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                üêæ Motion detected and it's dark
                ({{ states('sensor.kitchen_motion_illuminance') }} &
                {{ states('sensor.kitchen_motion_2_illuminance') }}
                < {{ states('input_number.kitchen_light_level_threshold') }} &
                {{ states('input_number.kitchen_light_level_2_threshold', with_unit=True) }}).
                Turning kitchen cooker üí° üîÜ lights on.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: scene.turn_on
            target:
              entity_id: scene.kitchen_cooker_lights_on
          - action: timer.cancel
            target:
              entity_id:
                - timer.kitchen_cooker_light_dim
                - timer.kitchen_cooker_light_off
                - timer.kitchen_table_light_dim
                - timer.kitchen_table_light_off
    mode: queued
    max: 10
  - id: "1606158191309"
    alias: "Kitchen: Motion Detected Cooker Lights On"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_area_motion
          - binary_sensor.kitchen_motion_occupancy
          - binary_sensor.kitchen_motion_pir
          - binary_sensor.kitchen_motion_mmwave
          - binary_sensor.kitchen_motion_2_occupancy
        to: "on"
    conditions:
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
      - condition: state
        entity_id: light.kitchen_cooker_white
        state: "on"
      - condition: numeric_state
        entity_id: light.kitchen_cooker_white
        attribute: brightness
        below: 100
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                üêæ Motion detected and it's dark
                ({{ states('sensor.kitchen_motion_illuminance') }} &
                {{ states('sensor.kitchen_motion_2_illuminance') }}
                < {{ states('input_number.kitchen_light_level_threshold') }} &
                {{ states('input_number.kitchen_light_level_2_threshold', with_unit=True) }}).
                Turning up cooker üí° üîÜ lights.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: scene.turn_on
            target:
              entity_id: scene.kitchen_cooker_lights_on
          - action: timer.cancel
            target:
              entity_id:
                - timer.kitchen_cooker_light_dim
                - timer.kitchen_cooker_light_off
                - timer.kitchen_table_light_dim
                - timer.kitchen_table_light_off
    mode: queued
    max: 10
  - id: "1606158191304"
    alias: "Kitchen: Motion Detected Ambient Lights On"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_area_motion
          - binary_sensor.kitchen_motion_occupancy
          - binary_sensor.kitchen_motion_pir
          - binary_sensor.kitchen_motion_mmwave
          - binary_sensor.kitchen_motion_2_occupancy
        to: "on"
    conditions:
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
      - or:
          - condition: state
            entity_id: light.kitchen_cabinets
            state: "on"
          - condition: state
            entity_id: light.kitchen_down_lights
            state: "on"
          - condition: state
            entity_id: light.kitchen_draws
            state: "on"
    actions:
      - parallel:
          - choose:
              - conditions:
                  - or:
                      - condition: numeric_state
                        entity_id: light.kitchen_cabinets
                        attribute: brightness
                        below: "100"
                      - condition: numeric_state
                        entity_id: light.kitchen_down_lights
                        attribute: brightness
                        below: "100"
                      - condition: numeric_state
                        entity_id: light.kitchen_draws
                        attribute: brightness
                        below: "100"
                sequence:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        üêæ Motion detected.
                        Turning up accent üí° üîÜ lights.
                      title: "üßë‚Äçüç≥ Kitchen"
                      log_level: "Debug"
                  - action: scene.turn_on
                    data:
                      transition: 1
                    target:
                      entity_id: scene.kitchen_accent_lights_on
            default: []
          - action: timer.cancel
            target:
              entity_id:
                - timer.kitchen_cooker_light_dim
                - timer.kitchen_cooker_light_off
                - timer.kitchen_table_light_dim
                - timer.kitchen_table_light_off
    mode: queued
    max: 10
  - id: "1606158191305"
    alias: "Kitchen: Motion Detected Ambient Lights Off"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_area_motion
          - binary_sensor.kitchen_motion_occupancy
          - binary_sensor.kitchen_motion_pir
          - binary_sensor.kitchen_motion_mmwave
          - binary_sensor.kitchen_motion_2_occupancy
        to: "on"
    conditions:
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
      - or:
          - condition: state
            entity_id: light.kitchen_cabinets
            state: "off"
          - condition: state
            entity_id: light.kitchen_down_lights
            state: "off"
          - condition: state
            entity_id: light.kitchen_draws
            state: "off"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                üêæ Motion detected.
                Turning accent üí° üîÜ lights on.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: scene.turn_on
            data:
              transition: 1
            target:
              entity_id: scene.kitchen_dim_accent_lights
          - action: timer.cancel
            target:
              entity_id:
                - timer.kitchen_cooker_light_dim
                - timer.kitchen_cooker_light_off
                - timer.kitchen_table_light_dim
                - timer.kitchen_table_light_off
    mode: single
  - id: "1606652871368"
    alias: "Kitchen: No Motion"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_area_motion
        from: "on"
        to: "off"
    conditions:
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                üö∑ No motion. Starting ‚è≥timers.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: timer.start
            target:
              entity_id:
                - timer.kitchen_cooker_light_dim
            data:
              duration: "00:05:00"
    mode: single
  - id: "1606652871369"
    alias: "Kitchen: No Motion Short Time"
    description: ""
    triggers:
      - trigger: event
        event_type: timer.finished
        event_data:
          entity_id: timer.kitchen_cooker_light_dim
      - trigger: event
        event_type: timer.finished
        event_data:
          entity_id: timer.kitchen_table_light_dim
    conditions:
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                üö∑ No motion after üèôÔ∏è and before üåá.
                Turning main lights off.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: scene.turn_on
            target:
              entity_id: scene.kitchen_main_lights_dim
            data:
              transition: 2
          - action: timer.start
            target:
              entity_id:
                - timer.kitchen_cooker_light_off
            data:
              duration: "00:05:00"
          - choose:
              - conditions:
                  - condition: time
                    after: "00:00:00"
                  - condition: sun
                    before: sunset
                sequence:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        üö∑ No motion after üèôÔ∏è and before üåá.
                        Turning ambient lights off.
                      title: "üßë‚Äçüç≥ Kitchen"
                      log_level: "Debug"
                  - action: scene.turn_on
                    target:
                      entity_id: scene.kitchen_ambient_lights_off
                    data:
                      transition: 2
              - conditions:
                  - and:
                      - condition: sun
                        after: sunset
                      - condition: time
                        before: "23:59:59"
                sequence:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        üö∑ No motion after üåá and before üèôÔ∏è.
                        üîÖ Dimming ambient üí° üîÖ lights.
                      title: "üßë‚Äçüç≥ Kitchen"
                      log_level: "Debug"
                  - action: scene.turn_on
                    target:
                      entity_id: scene.kitchen_ambient_lights_dim
            default: []
    mode: single
  - id: "1606652871370"
    alias: "Kitchen: No Motion Turn Off Lights"
    description: ""
    triggers:
      - trigger: event
        event_type: timer.finished
        event_data:
          entity_id: timer.kitchen_cooker_light_off
      - trigger: event
        event_type: timer.finished
        event_data:
          entity_id: timer.kitchen_table_light_off
    conditions:
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                üö∑ No motion after üèôÔ∏è and before üåá.
                Turning main lights off.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: scene.turn_on
            target:
              entity_id: scene.kitchen_main_lights_off
            data:
              transition: 2
          - choose:
              - conditions:
                  - and:
                      - condition: sun
                        after: sunset
                      - condition: time
                        before: "23:59:59"
                sequence:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        üö∑ No motion after üåá and before üèôÔ∏è.
                        Turning ambient lights off.
                      title: "üßë‚Äçüç≥ Kitchen"
                      log_level: "Debug"
                  - action: scene.turn_on
                    target:
                      entity_id: scene.kitchen_ambient_lights_off
                    data:
                      transition: 2
            default: []
    mode: single
  - id: "1606294735952"
    alias: "Kitchen: Turn Off Lights In The Morning"
    description: ""
    triggers:
      - trigger: time
        at: "09:00:00"
        id: weekend
      - trigger: time
        at: "08:50:00"
        id: weekday
    conditions:
      - condition: time
        weekday:
          - sat
          - sun
      - condition: state
        entity_id: light.kitchen_lights
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_kitchen_motion_triggers
        state: "on"
    actions:
      - parallel:
          - choose:
              - conditions:
                  - condition: time
                    weekday:
                      - mon
                      - tue
                      - wed
                      - thu
                      - fri
                  - condition: trigger
                    id: weekday
                sequence:
                  - action: script.send_to_home_log
                    data:
                      message: >-
                        :clock{{ now().strftime('%I') | int }}{% if now().minute | int > 25 and now().minute | int < 35 %}30{% else %}{% endif %}:
                        Turning ambient lights off.
                      title: "üßë‚Äçüç≥ Kitchen"
                      log_level: "Debug"
                  - action: scene.turn_on
                    target:
                      entity_id: scene.kitchen_ambient_lights_off
                    data:
                      transition: 2
              - conditions:
                  - condition: time
                    weekday:
                      - sat
                      - sun
                  - condition: trigger
                    id: weekend
                sequence:
                  - action: script.send_to_home_log
                    data:
                      message: ":clock{{ now().strftime('%H')}}: Turning ambient lights off."
                      title: "üßë‚Äçüç≥ Kitchen"
                      log_level: "Debug"
                  - action: scene.turn_on
                    target:
                      entity_id: scene.kitchen_ambient_lights_off
                    data:
                      transition: 2
            default: []
    mode: single
  - id: "1588197104336"
    alias: "Kitchen: Timed Turn On Lights (Dim)"
    description: ""
    triggers:
      - trigger: sun
        event: sunset
      - trigger: time
        at: "06:45:00"
    conditions:
      - and:
          - not:
              - condition: state
                entity_id: input_select.home_mode
                state: "Guest"
          - condition: state
            entity_id: group.tracked_people
            state: "home"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: >-
                üí°  At least one person is üè° home.
                Dimming accent üí° üîÖ lights.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: scene.turn_on
            target:
              entity_id: scene.kitchen_dim_accent_lights
            data:
              transition: 2
    mode: single
  # region Switch/Shelly
  - id: "1721248529363"
    alias: "Kitchen: Cooker Light Switch Toggle"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_cooker_light_input
        not_from:
          - unavailable
          - unknown
        not_to:
          - unavailable
          - unknown
    conditions: []
    actions:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
        target:
          entity_id: light.kitchen_cooker_white
    mode: queued
    max: 10
  - id: "1721248529364"
    alias: "Kitchen: Table Light Switch Toggle"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_table_light_input
        not_from:
          - unavailable
          - unknown
        not_to:
          - unavailable
          - unknown
    conditions: []
    actions:
      - action: light.toggle
        metadata: {}
        data:
          transition: 1
        target:
          entity_id: light.kitchen_table_white
    mode: queued
    max: 10
  # Fridge
  - id: "1595678795895"
    alias: "Kitchen: Fridge Door Open"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.kitchen_fridge_door_contact
        from: "off"
        to: "on"
    conditions: []
    actions:
      - action: script.send_to_home_log
        data:
          message: "üö™ ‚ùÑÔ∏è Fridge door opened."
          title: "üßë‚Äçüç≥ Kitchen"
          log_level: "Debug"

    mode: single
  - id: "1595678900778"
    alias: "Kitchen: Fridge Door Closed"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.kitchen_fridge_door_contact
        from: "on"
        to: "off"
    conditions: []
    actions:
      - action: script.send_to_home_log
        data:
          message: "‚ùÑÔ∏è Fridge üö™ door closed."
          title: "üßë‚Äçüç≥ Kitchen"
          log_level: "Debug"
    mode: single
  - id: "1595679010793"
    alias: "Kitchen: Fridge Open For A Long Period Of Time"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.kitchen_fridge_door_contact
        from: "off"
        to: "on"
        for: 00:04:00
      - trigger: state
        entity_id: binary_sensor.kitchen_fridge_door_contact
        to: "on"
        for: 00:30:00
      - trigger: state
        entity_id: binary_sensor.kitchen_fridge_door_contact
        to: "on"
        for: 00:45:00
      - trigger: state
        entity_id: binary_sensor.kitchen_fridge_door_contact
        to: "on"
        for: 01:00:00
    conditions: []
    actions:
      - parallel:
          - action: script.send_direct_notification
            data:
              message: >-
                ‚ùÑÔ∏è Fridge üö™ door is open has been open for more than
                {{ relative_time(states.binary_sensor.kitchen_fridge_door_contact.last_changed) }}!
              title: "‚ö†Ô∏è üßë‚Äçüç≥ Kitchen ‚ö†Ô∏è"
          - action: script.alexa_announce
            data:
              message: >-
                Kitchen Freezer door has been open for more than
                {{ relative_time(states.binary_sensor.kitchen_fridge_door_contact.last_changed) }}!
    mode: single
  # region Freezer
  - id: "1595678795896"
    alias: "Kitchen: Freezer Door Open"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.kitchen_freezer_door_contact
        from: "off"
        to: "on"
    conditions: []
    actions:
      - action: script.send_to_home_log
        data:
          message: "‚ùÑÔ∏è Freezer üö™ door opened."
          title: "üßë‚Äçüç≥ Kitchen"
          log_level: "Debug"
    mode: single
  - id: "1595678900779"
    alias: "Kitchen: Freezer Door Closed"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.kitchen_freezer_door_contact
        from: "on"
        to: "off"
    conditions: []
    actions:
      - action: script.send_to_home_log
        data:
          message: "‚ùÑÔ∏è Freezer üö™ door closed."
          title: "üßë‚Äçüç≥ Kitchen"
          log_level: "Debug"
    mode: single
  - id: "1595679010796"
    alias: "Kitchen: Freezer Open For A Long Period Of Time"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.kitchen_freezer_door_contact
        for: 00:04:00
        from: "off"
        to: "on"
    conditions: []
    actions:
      - action: script.send_direct_notification
        data:
          message: "‚ùÑÔ∏è Freezer üö™ door has been open for more than 4 minutes!"
          title: "‚ö†Ô∏è üßë‚Äçüç≥ Kitchen ‚ö†Ô∏è"
    mode: single
  - id: "1657801925107"
    alias: "Kitchen: Fridge Freezer Plug Turned Off"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - switch.ecoflow_kitchen_plug
        to: "unavailable"
        for:
          hours: 0
          minutes: 2
          seconds: 0
    conditions: []
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: Fridge Freezer plug is turned off.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: script.send_direct_notification
            data:
              message: Fridge Freezer plug is turned unavailable.
              title: "üßë‚Äçüç≥ Kitchen"
              people:
                entity_id:
                  - person.danny
    mode: single
  - id: "1688681085048"
    alias: "Kitchen: Low Water Softener Salt"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sensor.water_softener_salt_level_average
        above: input_number.low_water_softener_salt_level
        for:
          hours: 2
          minutes: 0
          seconds: 0
    conditions: []
    actions:
      - action: script.send_direct_notification
        data:
          message: Low salt in water softener.
          title: "üßë‚Äçüç≥ Kitchen"
          people:
            entity_id:
              - person.danny
              - person.terina
    mode: single
  - id: "1688681085049"
    alias: "Kitchen: No Water Softener Salt"
    description: ""
    triggers:
      - trigger: state
        entity_id: sensor.water_softener_salt_level_average
        to: input_number.no_water_softener_salt_level
    conditions: []
    actions:
      - action: script.send_direct_notification
        data:
          message: "‚ö†Ô∏è No salt in water softener. ‚ö†Ô∏è"
          title: "üßë‚Äçüç≥ Kitchen"
          people:
            entity_id:
              - person.danny
              - person.terina
    mode: single
  - id: "1694521590170"
    alias: "Kitchen: Oven Preheated"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id: sensor.oven_channel_1_power
        below: 100
    conditions:
      - condition: state
        entity_id: binary_sensor.oven_powered_on
        state: "on"
      - condition: state
        entity_id: input_boolean.oven_preheated
        state: "off"
      - condition: state
        entity_id: input_boolean.enable_oven_automations
        state: "on"
    actions:
      - parallel:
          - action: script.kitchen_oven_preheated_notification
            data:
              message: "Oven has ‚ô®Ô∏è preheated."
              title: "üßë‚Äçüç≥ Kitchen"
          - action: input_boolean.turn_on
            data: {}
            target:
              entity_id: input_boolean.oven_preheated
          - action: script.alexa_announce
            data:
              message: "Oven has preheated."
    mode: single
  - id: "1694521864037"
    alias: "Kitchen: Reset Oven Preheated"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.oven_powered_on
        to: "off"
        for:
          hours: 0
          minutes: 1
          seconds: 0
    conditions:
      - condition: state
        entity_id: input_boolean.oven_preheated
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_oven_automations
        state: "on"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: Turning off oven preheat indicator.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: Normal
          - action: input_boolean.turn_off
            data: {}
            target:
              entity_id: input_boolean.oven_preheated
    mode: single
  # region Dishwashing Machine
  - id: "1694521590172"
    alias: "Kitchen: Dishwasher Cycle Starts"
    description: ""
    triggers:
      - trigger: state
        entity_id: binary_sensor.dishwasher_powered_on
        to: "on"
    conditions:
      - condition: state
        entity_id: input_boolean.dishwasher_cycle_in_progress
        state: "off"
      - condition: state
        entity_id: input_boolean.enable_dishwasher_automations
        state: "on"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: "Dishwasher has started."
              title: "üßë‚Äçüç≥ Kitchen"
          - action: input_boolean.turn_on
            data: {}
            target:
              entity_id: input_boolean.dishwasher_cycle_in_progress
    mode: single
  - id: "1694521864038"
    alias: "Kitchen: Reset Oven Preheated"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.dishwasher_powered_on
        to: "off"
        for:
          hours: 0
          minutes: 31
          seconds: 0
    conditions:
      - condition: state
        entity_id: input_boolean.dishwasher_cycle_in_progress
        state: "on"
      - condition: state
        entity_id: input_boolean.enable_dishwasher_automations
        state: "on"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: Dishwasher cycle completed.
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: Normal
          - action: input_boolean.turn_off
            data: {}
            target:
              entity_id: input_boolean.dishwasher_cycle_in_progress
    mode: single
  - id: "1595679010797"
    alias: "Kitchen: Dishwasher Started"
    description: ""
    triggers:
      - trigger: state
        entity_id: input_boolean.dishwasher_cycle_in_progress
        to: "on"
    conditions: []
    actions:
      - if:
          - condition: state
            entity_id: input_boolean.dishwasher_clean_cycle
            state: "off"
        then:
          - action: script.send_to_home_log
            data:
              message: ":knife_fork_plate: :soap: Dishwasher :arrow_forward: Started."
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: rest_command.consume_dishwasher_tablet
            data: {}
          - action: homeassistant.update_entity
            data:
              entity_id:
                - sensor.dishwasher_tablet_stock
          - if:
              - condition: numeric_state
                entity_id: sensor.dishwasher_tablet_stock
                below: 9
            then:
              - action: script.send_direct_notification
                data:
                  message: >-
                    Dishwasher tablets are running low (
                    {{ states('sensor.dishwasher_tablet_stock') }}
                    remaining). Consider ordering more.
                  title: "üßë‚Äçüç≥ Kitchen"
                  people:
                    entity_id:
                      - person.danny
                      - person.terina
        else:
          - action: script.send_to_home_log
            data:
              message: ":knife_fork_plate: :soap: Dishwasher :arrow_forward: Started in clean mode."
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: "Debug"
          - action: input_boolean.turn_off
            target:
              entity_id: input_boolean.dishwasher_clean_cycle
            data: {}
    mode: single
  - id: "1595679010798"
    alias: "Kitchen: Dishwasher Finished"
    description: ""
    triggers:
      - trigger: state
        entity_id: input_boolean.dishwasher_cycle_in_progress
        from: "on"
        to: "off"
    conditions: []
    actions:
      - action: script.dishwashing_complete_notification
        data:
          message: ":knife_fork_plate: :soap: Dishwasher :checkered_flag: Finished."
          title: "üßë‚Äçüç≥ Kitchen"
    mode: single
  # region General
  - id: "1716112515827"
    alias: "Kitchen: Paper Draw Opened"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_paper_draw_contact
        from: "off"
        to: "on"
    conditions: []
    actions:
      - action: script.send_direct_notification
        metadata: {}
        data:
          message: Paper draw opened
          title: Kitchen
    mode: single
  # region Notifications
  - id: "1735567472488"
    alias: "Kitchen: Using Power From The Grid"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id:
          - sensor.grid_power
        above: 100
    conditions:
      - condition: state
        entity_id: binary_sensor.kitchen_area_motion
        state: "on"
      - condition: state
        entity_id: light.kitchen_cooker_rgb
        state: "off"
      - condition: state
        entity_id: light.kitchen_table_rgb
        state: "off"
      - condition: numeric_state
        entity_id: sensor.growatt_sph_battery_state_of_charge
        above: input_number.growatt_battery_discharge_stop_soc
      - not:
          - condition: state
            entity_id: sensor.growatt_sph_inverter_mode
            state: "Battery first"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: Pulling power from the grid
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: Debug
          - choose:
              - alias: Battery has charge left
                conditions:
                  - or:
                      - condition: numeric_state
                        entity_id: sensor.growatt_sph_battery_state_of_charge
                        above: input_number.growatt_battery_discharge_stop_soc
                      - condition: numeric_state
                        entity_id: sensor.growatt_battery_discharge_power
                        below: 100
                sequence:
                  - action: scene.turn_on
                    target:
                      entity_id:
                        - scene.kitchen_table_ambient_light_to_pink
                        - scene.kitchen_cooker_ambient_light_to_pink
              - alias: Battery has charge left
                conditions:
                  - or:
                      - condition: template
                        value_template: >-
                          {{ states('sensor.growatt_sph_battery_state_of_charge')|float(0) <= states('input_number.growatt_battery_discharge_stop_soc')|float(0) }}
                      - condition: numeric_state
                        entity_id: sensor.growatt_battery_discharge_power
                        below: 100
                sequence:
                  - action: script.kitchen_pulse_ambient_light_pink
                    data: {}
    mode: single
  - id: "1735567472489"
    alias: "Kitchen: Stops using Power From The Grid"
    description: ""
    triggers:
      - trigger: numeric_state
        entity_id:
          - sensor.grid_power
        below: 100
    conditions:
      - condition: state
        entity_id: light.kitchen_cooker_rgb
        state: "on"
      - condition: state
        entity_id: light.kitchen_table_rgb
        state: "on"
      - condition: state
        entity_id: binary_sensor.front_door
        state: "off"
    actions:
      - parallel:
          - action: script.send_to_home_log
            data:
              message: Pulling power from the grid
              title: "üßë‚Äçüç≥ Kitchen"
              log_level: Debug
          - action: light.turn_off
            target:
              entity_id:
                - light.kitchen_cooker_rgb
                - light.kitchen_table_rgb
    mode: single
  # region Smoke Alarm
  - id: "1757836826541"
    alias: "Kitchen: Smoke Alarm"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - binary_sensor.kitchen_smoke_alarm_smoke
        to: "on"
    conditions: []
    actions:
      - parallel:
          - action: script.send_direct_notification
            metadata: {}
            data:
              message: "‚ö†Ô∏è Smoke alarm triggered ‚ö†Ô∏è"
              title: "‚ö†Ô∏è üßë‚Äçüç≥ Kitchen ‚ö†Ô∏è"
          - action: script.alexa_announce
            data:
              message: >-
                Warning! Kitchen smoke alarm triggered.
    mode: single
  # region Kettle
  - id: "1759577733332"
    alias: "Kitchen: Kettle Boiled"
    description: ""
    triggers:
      - trigger: state
        entity_id:
          - sensor.kettle_status
        from: heating
        to: standby
    conditions: []
    actions:
      - parallel:
          - action: script.send_to_home_log
            metadata: {}
            data:
              log_level: Debug
              message: Kettle finised boiling water
              title: "üßë‚Äçüç≥Kitchen"
          - action: script.alexa_announce
            metadata: {}
            data:
              method: speak
              message: Kettle boiled
    mode: single

scene:
  - id: "kitchen_main_lights_dim"
    name: Kitchen Main Lights Dim
    icon: "mdi:wall-sconce-flat"
    entities:
      light.kitchen_cooker_white:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 10
        color_temp_kelvin: 2702
        color_temp: 370
        hs_color:
          - 28.391
          - 65.659
        rgb_color:
          - 255
          - 166
          - 87
        xy_color:
          - 0.526
          - 0.387
        friendly_name: Kitchen Cooker
        supported_features: 40
        state: "on"
      light.kitchen_table_white:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 10
        color_temp_kelvin: 2702
        color_temp: 370
        hs_color:
          - 28.391
          - 65.659
        rgb_color:
          - 255
          - 166
          - 87
        xy_color:
          - 0.526
          - 0.387
        friendly_name: Kitchen Table
        supported_features: 40
        state: "on"
  - id: "kitchen_main_lights_off"
    name: Kitchen Main Lights Off
    icon: "mdi:wall-sconce-flat"
    entities:
      light.kitchen_cooker_white:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 10
        color_temp_kelvin: 2702
        color_temp: 370
        hs_color:
          - 28.391
          - 65.659
        rgb_color:
          - 255
          - 166
          - 87
        xy_color:
          - 0.526
          - 0.387
        friendly_name: Kitchen Cooker
        supported_features: 40
        state: "off"
      light.kitchen_table_white:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 10
        color_temp_kelvin: 2702
        color_temp: 370
        hs_color:
          - 28.391
          - 65.659
        rgb_color:
          - 255
          - 166
          - 87
        xy_color:
          - 0.526
          - 0.387
        friendly_name: Kitchen Table
        supported_features: 40
        state: "off"
  - id: "kitchen_ambient_lights_off"
    name: Kitchen Ambient Lights Off
    icon: "mdi:lightbulb-spot-off"
    entities:
      light.kitchen_ambient_lights:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 10
        color_temp_kelvin: 2702
        color_temp: 370
        hs_color:
          - 28.391
          - 65.659
        rgb_color:
          - 255
          - 166
          - 87
        xy_color:
          - 0.526
          - 0.387
        friendly_name: Kitchen Cooker
        supported_features: 40
        state: "off"
  - id: "scene.kitchen_all_lights_off"
    name: Kitchen All Lights Off
    icon: "mdi:lightbulb-spot-off"
    entities:
      light.kitchen_accent_lights:
        min_mireds: 153
        max_mireds: 65535
        effect_list:
          - colorloop
          - random
        supported_color_modes:
          - color_temp
          - hs
        color_mode: color_temp
        brightness: 52
        color_temp: 42964
        effect: none
        friendly_name: Kitchen Down Light
        supported_features: 63
        icon: mdi:led-strip-variant
        state: "on"
      light.kitchen_ambient_lights:
        min_mireds: 111
        max_mireds: 500
        supported_color_modes:
          - color_temp
        friendly_name: Kitchen Left
        supported_features: 35
        state: "off"
  - id: kitchen_accent_lights_on
    name: Kitchen Accent Lights On
    icon: mdi:led-strip-variant
    entities:
      light.kitchen_accent_lights:
        min_mireds: 153
        max_mireds: 500
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        hs_color:
          - 36.568
          - 66.275
        rgb_color:
          - 255
          - 189
          - 86
        xy_color:
          - 0.5018
          - 0.4152
        mode: normal
        dynamics: none
        friendly_name: Kitchen Down Light
        supported_features: 40
        icon: mdi:led-strip-variant
        state: "on"
  - id: "kitchen_dim_accent_lights"
    name: Kitchen Dim Accent Lights
    icon: mdi:led-strip-variant
    entities:
      light.kitchen_accent_lights:
        min_mireds: 155
        max_mireds: 495
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 26
        hs_color:
          - 24.878
          - 64.314
        rgb_color:
          - 255
          - 159
          - 91
        xy_color:
          - 0.534
          - 0.376
        mode: normal
        dynamics: none
        friendly_name: Kitchen Draws
        supported_features: 40
        icon: mdi:led-strip-variant
        state: "on"
  - id: "kitchen_accent_lights_off"
    name: Kitchen Accent Lights Off
    icon: "mdi:lightbulb-spot-off"
    entities:
      light.kitchen_accent_lights:
        min_mireds: 0
        max_mireds: 65535
        supported_color_modes:
          - color_temp
          - xy
        mode: normal
        dynamics: none
        friendly_name: Kitchen Cabinet Light
        supported_features: 40
        icon: mdi:led-strip-variant
        state: "off"
  - id: "1629659622093"
    name: Kitchen Table Lights On
    icon: "mdi:lightbulb-spot"
    entities:
      light.kitchen_table_white:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 200
        color_temp_kelvin: 2702
        color_temp: 370
        hs_color:
          - 28.391
          - 65.659
        rgb_color:
          - 255
          - 166
          - 87
        xy_color:
          - 0.526
          - 0.387
        friendly_name: Kitchen Table
        supported_features: 40
        state: "on"
  - id: "1629659622094"
    name: Kitchen Cooker Lights On
    icon: "mdi:lightbulb-spot"
    entities:
      light.kitchen_cooker_white:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
        color_mode: color_temp
        brightness: 200
        color_temp_kelvin: 2702
        color_temp: 370
        hs_color:
          - 28.391
          - 65.659
        rgb_color:
          - 255
          - 166
          - 87
        xy_color:
          - 0.526
          - 0.387
        friendly_name: Kitchen Cooker
        supported_features: 40
        state: "on"
    metadata:
      light.kitchen_cooker_white:
        entity_only: true
  - id: "1613560870965"
    name: "Kitchen Cooker Ambient Light To Blue"
    entities:
      light.kitchen_cooker_rgb:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        color_temp_kelvin:
        hs_color:
          - 237.073
          - 96.471
        rgb_color:
          - 9
          - 21
          - 255
        xy_color:
          - 0.136
          - 0.042
        friendly_name: Kitchen Cooker Ambient
        supported_features: 40
        state: "on"
    metadata:
      light.kitchen_cooker_rgb:
        entity_only: true
  - id: "1613560870966"
    name: "Kitchen Table Ambient Light To Blue"
    entities:
      light.kitchen_table_rgb:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        color_temp_kelvin:
        hs_color:
          - 237.073
          - 96.471
        rgb_color:
          - 9
          - 21
          - 255
        xy_color:
          - 0.136
          - 0.042
        friendly_name: Kitchen Table Ambient
        supported_features: 40
        state: "on"
    metadata:
      light.kitchen_table_rgb:
        entity_only: true
  - id: "1721576220791"
    name: Kitchen Cooker Light To Red
    entities:
      light.kitchen_cooker_rgb:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        color_temp_kelvin:
        hs_color:
          - 9.231
          - 66.275
        rgb_color:
          - 255
          - 112
          - 86
        xy_color:
          - 0.589
          - 0.329
        friendly_name: Kitchen Cooker Ambient
        supported_features: 40
        state: "on"
    metadata:
      light.kitchen_cooker_rgb:
        entity_only: true
  - id: "1721576220791"
    name: Kitchen Table Light To Red
    entities:
      light.kitchen_table_rgb:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        color_temp_kelvin:
        hs_color:
          - 9.231
          - 66.275
        rgb_color:
          - 255
          - 112
          - 86
        xy_color:
          - 0.589
          - 0.329
        friendly_name: Kitchen Table Ambient
        supported_features: 40
        state: "on"
    metadata:
      light.kitchen_table_rgb:
        entity_only: true
  - id: "1613560870967"
    name: "Kitchen Cooker Ambient Light To Pink"
    entities:
      light.kitchen_cooker_rgb:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        hs_color:
          - 297.857
          - 98.824
        rgb_color:
          - 246
          - 3
          - 255
        xy_color:
          - 0.375
          - 0.15
        friendly_name: Kitchen Cooker Ambient
        supported_features: 40
        state: "on"
    metadata:
      light.kitchen_cooker_rgb:
        entity_only: true
  - id: "1613560870968"
    name: "Kitchen Table Ambient Light To Pink"
    entities:
      light.kitchen_table_rgb:
        min_color_temp_kelvin: 2702
        max_color_temp_kelvin: 6535
        min_mireds: 153
        max_mireds: 370
        supported_color_modes:
          - color_temp
          - xy
        color_mode: xy
        brightness: 255
        hs_color:
          - 297.857
          - 98.824
        rgb_color:
          - 246
          - 3
          - 255
        xy_color:
          - 0.375
          - 0.15
        friendly_name: Kitchen Table Ambient
        supported_features: 40
        state: "on"
    metadata:
      light.kitchen_table_rgb:
        entity_only: true

script:
  kitchen_oven_preheated_notification:
    alias: Kitchen Oven Preheated Notification
    fields:
      message:
        description: Message to post
        required: true
        selector:
          text:
            multiline: true
      title:
        description: (optional)Title to the message posted.
        selector:
          text:
            multiline: true
    variables:
      people_home: "{% set people = namespace(home=[]) %}
        {% for p in state_attr('group.tracked_people', 'entity_id')|default([]) %}
        {% if states(p) == 'home' %}
        {% set people.home = people.home + [p] %}
        {% endif %}
        {% endfor %}
        {{ people.home }}"
    sequence:
      - action: script.send_direct_notification
        data:
          message: "{{ message }}"
          title: "{{ title }}"
          people:
            entity_id: "{{ people_home }}"
    mode: single
    icon: mdi:toaster-oven
  kitchen_toggle_kitchen_ambient_lights:
    alias: Kitchen Toggle Kitchen Ambient Lights
    sequence:
      - action: light.toggle
        data: {}
        target:
          entity_id: light.kitchen_ambient_lights
    mode: single
    icon: mdi:lightbulb-spot
  kitchen_toggle_accent_lights:
    alias: Kitchen Toggle Accent Lights
    sequence:
      - action: light.toggle
        data: {}
        target:
          entity_id: light.kitchen_accent_lights
    mode: single
    icon: mdi:led-strip-variant
  dishwashing_complete_notification:
    alias: Dishwashing Complete Notification
    description: "TODO: refactor this with washing machine complete notification."
    fields:
      message:
        description: Message to post
        required: true
        selector:
          text:
            multiline: true
      title:
        description: (optional)Title to the message posted.
        selector:
          text:
    variables:
      people_home: "{% set people = namespace(home=[]) %}
        {% for p in state_attr('group.tracked_people', 'entity_id')|default([]) %}
        {% if states(p) == 'home' %}
        {% set people.home = people.home + [p] %}
        {% endif %}
        {% endfor %}
        {{ people.home }}"
    sequence:
      - choose:
          - conditions:
              - condition: state
                entity_id: group.tracked_people
                state: "home"
              - condition: time
                before: "22:00:00"
                after: "09:00:00"
            sequence:
              - parallel:
                  - action: script.send_direct_notification
                    data:
                      message: "{{ message }}"
                      title: "{{ title }}"
                      people:
                        entity_id: "{{ people_home }}"
                  - action: script.alexa_announce
                    data:
                      message: "{{ message|replace(':knife_fork_plate:', '')|replace(':soap:', '')|replace(':checkered_flag: ', '') }}"
                      title: "{{ title }}"
        default:
          - parallel:
              - action: script.send_to_home_log
                data:
                  message: "{{ message }}"
                  title: "{{ title }}"
                  log_level: "Debug"
              - action: todo.add_item
                data:
                  item: "{{ message }}"
                target:
                  entity_id: todo.dannys_notifications
    mode: single
    icon: mdi:dishwasher
  kitchen_pulse_ambient_light_pink:
    alias: Kitchen Pulse Ambient Light Pink
    sequence:
      - repeat:
          count: 5
          sequence:
            - action: scene.turn_on
              target:
                entity_id:
                  - scene.kitchen_table_ambient_light_to_pink
                  - scene.kitchen_cooker_ambient_light_to_pink
            - delay:
                seconds: 1
            - action: light.turn_off
              target:
                entity_id:
                  - light.kitchen_cooker_rgb
                  - light.kitchen_table_rgb

sensor:
  # Dishwasher
  - platform: history_stats
    name: Dishwasher Running Time Today
    unique_id: dfc20507-2172-47ad-ad2d-f0805474abf0
    entity_id: binary_sensor.dishwasher_powered_on
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: Dishwasher Running Time Last 24 Hours
    unique_id: c9e71749-f19f-40b0-b370-d088599b05d1
    entity_id: binary_sensor.dishwasher_powered_on
    state: "on"
    type: time
    end: "{{ now() }}"
    duration:
      hours: 24
  - platform: history_stats
    name: Dishwasher Running Time Yesterday
    unique_id: e4becc0b-a54f-4042-a51f-b2eb2bdf0dbe
    entity_id: binary_sensor.dishwasher_powered_on
    state: "on"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      hours: 24
  - platform: history_stats
    name: Dishwasher Running Time This Week
    unique_id: 24efdcd1-35d0-4674-882c-2fbe30492317
    entity_id: binary_sensor.dishwasher_powered_on
    state: "on"
    type: time
    start: "{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: Dishwasher Running Time Last 30 Days
    unique_id: 6b063270-43e4-4365-9fbf-ece59c682b55
    entity_id: binary_sensor.dishwasher_powered_on
    state: "on"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      days: 30
  # Fridge
  - platform: history_stats
    name: Fridge Opened Today
    entity_id: binary_sensor.kitchen_fridge_door_contact
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: Fridge Opened Yesterday
    entity_id: binary_sensor.kitchen_fridge_door_contact
    state: "on"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      hours: 24
  - platform: history_stats
    name: Fridge Freezer Running Time Today
    unique_id: b75ee65e-3f1f-47f7-a23a-e97a1f32b3c3
    entity_id: binary_sensor.fridge_freezer_powered_on
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: Fridge Freezer Running Time Last 24 Hours
    unique_id: 88f1c5f3-6523-4eb1-8f6a-dac85201f702
    entity_id: binary_sensor.fridge_freezer_powered_on
    state: "on"
    type: time
    end: "{{ now() }}"
    duration:
      hours: 24
  - platform: history_stats
    name: Fridge Freezer Running Time Yesterday
    unique_id: e7f7b331-7915-4c10-ba59-57181266b187
    entity_id: binary_sensor.fridge_freezer_powered_on
    state: "on"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      hours: 24
  - platform: history_stats
    name: Fridge Freezer Running Time This Week
    unique_id: 0c2cef79-5b99-4151-90e9-bcbac230220a
    entity_id: binary_sensor.fridge_freezer_powered_on
    state: "on"
    type: time
    start: "{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}"
    end: "{{ now() }}"
  - platform: history_stats
    name: Fridge Freezer Running Time Last 30 Days
    unique_id: b858a82c-4320-4518-8245-0ca3512c23a9
    entity_id: binary_sensor.fridge_freezer_powered_on
    state: "on"
    type: time
    end: "{{ now().replace(hour=0, minute=0, second=0) }}"
    duration:
      days: 30
  # Mould indicator
  - platform: mold_indicator
    name: Kitchen Mould Indicator
    indoor_temp_sensor: sensor.kitchen_motion_temperature
    indoor_humidity_sensor: sensor.kitchen_motion_humidity
    outdoor_temp_sensor: sensor.gw2000a_outdoor_temperature
    calibration_factor: 2.01

template:
  - binary_sensor:
      - name: Kettle Powered On
        unique_id: 76b99ef4-c4d8-47fa-88f8-17ba6f8ef3cf
        icon: "mdi:kettle{{ '' if states('sensor.kettle_plug_power') | float(0) >= 10 else '-off' }}"
        device_class: running
        state: "{{ states('sensor.kettle_plug_power') | float(0) >= 10 }}"
  - trigger:
      - trigger: numeric_state
        entity_id: sensor.dishwasher_switch_0_power
        above: 3
        for:
          minutes: 1
      - trigger: numeric_state
        entity_id: sensor.dishwasher_switch_0_power
        below: 4
        for:
          seconds: 20
    binary_sensor:
      - name: Dishwasher Powered On
        unique_id: 63be053e-e80c-4b19-b6a4-32ec1405bb8f
        icon: "mdi:dishwasher{{ '' if states('sensor.dishwasher_switch_0_power') | float(0) >= 4 else '-off' }}"
        device_class: running
        state: "{{ states('sensor.dishwasher_switch_0_power') | float(0) >= 4 }}"
  - trigger:
      - trigger: state
        entity_id:
          - sensor.ecoflow_kitchen_ac_out_power
        not_to: "unavailable"
    binary_sensor:
      - name: Fridge Freezer Powered On
        unique_id: eec7ea28-790f-4dcd-b756-2ab7fd70868f
        icon: "mdi:fridge"
        device_class: running
        state: "{{ states('sensor.ecoflow_kitchen_ac_out_power') | float(0) >= 10 and states('sensor.ecoflow_kitchen_ac_out_power') | float(0) <= 100 }}"
  - trigger:
      - trigger: state
        entity_id:
          - sensor.oven_channel_1_power
        not_to: "unavailable"
      - trigger: state
        entity_id:
          - sensor.oven_channel_1_power
        to: "0.0"
        for: "00:30:00"
    binary_sensor:
      - name: Oven Powered On
        unique_id: 41566148-cf56-468f-a714-974b6977cc85
        icon: "mdi:toaster-oven"
        device_class: running
        state: "{{ states('sensor.oven_channel_1_power') | float(0) >= 10 }}"
  - trigger:
      - trigger: state
        entity_id:
          - input_number.low_water_softener_salt_level
          - sensor.water_softener_salt_level_average
    binary_sensor:
      - name: Low Water Softener Salt
        unique_id: f074e7cf-d53c-419b-8677-833f615f4483
        icon: "mdi:water-alert"
        state: "{{ states('sensor.water_softener_salt_level_average') | float(100) >= states('input_number.low_water_softener_salt_level') | float(0) }}"
  - trigger:
      - trigger: state
        entity_id:
          - input_number.no_water_softener_salt_level
          - sensor.water_softener_salt_level_average
    binary_sensor:
      - name: No Water Softener Salt
        unique_id: c02df70f-1b4c-4cef-8032-35a235eb4479
        icon: "mdi:water-alert-outline"
        state: "{{ states('sensor.water_softener_salt_level_average') | float(100) >= states('input_number.no_water_softener_salt_level') | float(0) }}"
