# Created by Danny Tsang <danny@tsang.uk>
group:
  attic_area_temperature:
    name: Attic Temperature
    icon: mdi:thermometer
    entities:
      - sensor.attic_temperature
      - sensor.attic_temperature_2
template:
  sensor:
    - name: Attic Water Tank Percent
      unit_of_measurement: "%"
      # Dry resistance value (max) = 0.54
      # Fully submerged in tank (min) = 0.36/0.37
      # Formula for calculating the percent for the above range: ((input - min) * 100) / (max - min)
      # The above would result in the inverse i.e full tank = 0% and empty = 100%.
      # Inverse formula: max / (1 + current %).
      # Full formala: max / (1 + ((input - min) * 100) / (max - min))
      # References:
      #  https://stackoverflow.com/questions/25835591/how-to-calculate-percentage-between-the-range-of-two-values-a-third-value-is/25835683
      #  https://www.quora.com/How-do-you-calculate-a-reverse-percentage-What-is-the-formula
      state: "{{ (0.54/(1+((states('sensor.water_tank_level') | float - 0.37) / (0.54 - 0.37)))/0.54)*100 }}"
      icon: "{% if (0.54/(1+((states('sensor.water_tank_level') | float - 0.37) / (0.54 - 0.37)))/0.54)*100 | int > 50 %}
      mdi:water-percent {% elif (0.54/(1+((states('sensor.water_tank_level') | float - 0.37) / (0.54 - 0.37)))/0.54)*100 | int > 15 %}
      mdi:water-percent-alert{% else %}
      mdi:water-remove{% endif %}"
