# Created by Danny Tsang <danny@tsang.uk>
# Integration: https://github.com/alandtse/tesla
# Integration: https://github.com/teslamate-org/teslamate
automation:
  - id: "1726077652711"
    alias: "Tesla: USB Archive"
    description: ""
    triggers:
      - trigger: webhook
        allowed_methods:
          - POST
        local_only: true
        webhook_id: teslausb
    conditions: []
    actions:
      - action: script.send_to_home_log
        data:
          message: >-
            {{ trigger.json.value2 }}
          title: "Tesla"
          log_level: "Normal"
    mode: queued
    max: 10
  - id: "1750161174574"
    alias: "Tesla: Windows Open At Night"
    description: ""
    triggers:
      - trigger: time
        at: "23:00:00"
    conditions:
      - condition: state
        entity_id: binary_sensor.model_3_windows
        state: "on"
    actions:
      - action: script.send_direct_notification
        metadata: {}
        data:
          title: "Car :car:"
          message: "Model 3 windows ðŸªŸ are open."
          people:
            entity_id:
              - person.danny
    mode: single

mqtt:
  sensor:
    # Car 1
    - name: Display Name
      object_id: tesla_display_name  # entity_id
      unique_id: teslamate_1_display_name  # internal id, used for device grouping
      availability: &teslamate_availability
        - topic: teslamate/cars/1/healthy
          payload_available: "true"
          payload_not_available: "false"
      device: &teslamate_device_info
        identifiers: [teslamate_car_1]
        configuration_url: !secret teslamate_url
        manufacturer: Tesla
        model: Model Y
        name: Tesla Model Y
      state_topic: "teslamate/cars/1/display_name"
      icon: mdi:car
    - name: State
      object_id: tesla_state
      unique_id: teslamate_1_state
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/state"
      icon: mdi:car-connected
    - name: Since
      object_id: tesla_since
      unique_id: teslamate_1_since
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/since"
      device_class: timestamp
      icon: mdi:clock-outline
    - name: Version
      object_id: tesla_version
      unique_id: teslamate_1_version
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/version"
      icon: mdi:alphabetical
    - name: Update Version
      object_id: tesla_update_version
      unique_id: teslamate_1_update_version
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/update_version"
      icon: mdi:alphabetical
    - name: Model
      object_id: tesla_model
      unique_id: teslamate_1_model
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/model"
    - name: Trim Badging
      object_id: tesla_trim_badging
      unique_id: teslamate_1_trim_badging
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/trim_badging"
      icon: mdi:shield-star-outline
    - name: Exterior Color
      object_id: tesla_exterior_color
      unique_id: teslamate_1_exterior_color
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/exterior_color"
      icon: mdi:palette
    - name: Wheel Type
      object_id: tesla_wheel_type
      unique_id: teslamate_1_wheel_type
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/wheel_type"
    - name: Spoiler Type
      object_id: tesla_spoiler_type
      unique_id: teslamate_1_spoiler_type
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/spoiler_type"
      icon: mdi:car-sports
    - name: Geofence
      object_id: tesla_geofence
      unique_id: teslamate_1_geofence
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/geofence"
      icon: mdi:earth
    - name: Latitude
      object_id: tesla_latitude
      unique_id: teslamate_1_latitude
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/latitude"
      unit_of_measurement: Â°
      icon: mdi:crosshairs-gps
    - name: Longitude
      object_id: tesla_longitude
      unique_id: teslamate_1_longitude
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/longitude"
      unit_of_measurement: Â°
      icon: mdi:crosshairs-gps
    - name: Shift State
      object_id: tesla_shift_state
      unique_id: teslamate_1_shift_state
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/shift_state"
      icon: mdi:car-shift-pattern
    - name: Power
      object_id: tesla_power
      unique_id: teslamate_1_power
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/power"
      device_class: power
      unit_of_measurement: kW
      icon: mdi:flash
    - name: Speed
      object_id: tesla_speed
      unique_id: teslamate_1_speed
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/speed"
      unit_of_measurement: "km/h"
      icon: mdi:speedometer
    - name: Heading
      object_id: tesla_heading
      unique_id: teslamate_1_heading
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/heading"
      unit_of_measurement: Â°
      icon: mdi:compass
    - name: Elevation
      object_id: tesla_elevation
      unique_id: teslamate_1_elevation
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/elevation"
      unit_of_measurement: m
      icon: mdi:image-filter-hdr
    - name: Inside Temp
      object_id: tesla_inside_temp
      unique_id: teslamate_1_inside_temp
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/inside_temp"
      device_class: temperature
      unit_of_measurement: Â°C
      icon: mdi:thermometer-lines
    - name: Outside Temp
      object_id: tesla_outside_temp
      unique_id: teslamate_1_outside_temp
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/outside_temp"
      device_class: temperature
      unit_of_measurement: Â°C
      icon: mdi:thermometer-lines
    - name: Odometer
      object_id: tesla_odometer
      unique_id: teslamate_1_odometer
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/odometer"
      unit_of_measurement: km
      icon: mdi:counter
    - name: Est Battery Range
      object_id: tesla_est_battery_range_km
      unique_id: teslamate_1_est_battery_range_km
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/est_battery_range_km"
      unit_of_measurement: km
      icon: mdi:gauge
    - name: Rated Battery Range
      object_id: tesla_rated_battery_range_km
      unique_id: teslamate_1_rated_battery_range_km
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/rated_battery_range_km"
      unit_of_measurement: km
      icon: mdi:gauge
    - name: Ideal Battery Range
      object_id: tesla_ideal_battery_range_km
      unique_id: teslamate_1_ideal_battery_range_km
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/ideal_battery_range_km"
      unit_of_measurement: km
      icon: mdi:gauge
    - name: Battery Level
      object_id: tesla_battery_level
      unique_id: teslamate_1_battery_level
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/battery_level"
      device_class: battery
      unit_of_measurement: "%"
      icon: mdi:battery-80
    - name: Usable Battery Level
      object_id: tesla_usable_battery_level
      unique_id: teslamate_1_usable_battery_level
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/usable_battery_level"
      unit_of_measurement: "%"
      icon: mdi:battery-80
    - name: Charge Energy Added
      object_id: tesla_charge_energy_added
      unique_id: teslamate_1_charge_energy_added
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/charge_energy_added"
      device_class: energy
      unit_of_measurement: kWh
      icon: mdi:battery-charging
    - name: Charge Limit Soc
      object_id: tesla_charge_limit_soc
      unique_id: teslamate_1_charge_limit_soc
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/charge_limit_soc"
      unit_of_measurement: "%"
      icon: mdi:battery-charging-100
    - name: Charger Actual Current
      object_id: tesla_charger_actual_current
      unique_id: teslamate_1_charger_actual_current
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/charger_actual_current"
      device_class: current
      unit_of_measurement: A
      icon: mdi:lightning-bolt
    - name: Charger Phases
      object_id: tesla_charger_phases
      unique_id: teslamate_1_charger_phases
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/charger_phases"
      icon: mdi:sine-wave
    - name: Charger Power
      object_id: tesla_charger_power
      unique_id: teslamate_1_charger_power
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/charger_power"
      device_class: power
      unit_of_measurement: kW
      icon: mdi:lightning-bolt
    - name: Charger Voltage
      object_id: tesla_charger_voltage
      unique_id: teslamate_1_charger_voltage
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/charger_voltage"
      device_class: voltage
      unit_of_measurement: V
      icon: mdi:lightning-bolt
    - name: Scheduled Charging Start Time
      object_id: tesla_scheduled_charging_start_time
      unique_id: teslamate_1_scheduled_charging_start_time
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/scheduled_charging_start_time"
      device_class: timestamp
      icon: mdi:clock-outline
    - name: Time To Full Charge
      object_id: tesla_time_to_full_charge
      unique_id: teslamate_1_time_to_full_charge
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/time_to_full_charge"
      unit_of_measurement: h
      icon: mdi:clock-outline
    - name: TPMS Pressure Front Left
      object_id: tesla_tpms_fl
      unique_id: teslamate_1_tpms_fl
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/tpms_pressure_fl"
      unit_of_measurement: bar
      icon: mdi:car-tire-alert
    - name: TPMS Pressure Front Right
      object_id: tesla_tpms_fr
      unique_id: teslamate_1_tpms_fr
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/tpms_pressure_fr"
      unit_of_measurement: bar
      icon: mdi:car-tire-alert
    - name: TPMS Pressure Rear Left
      object_id: tesla_tpms_rl
      unique_id: teslamate_1_tpms_rl
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/tpms_pressure_rl"
      unit_of_measurement: bar
      icon: mdi:car-tire-alert
    - name: TPMS Pressure Rear Right
      object_id: tesla_tpms_rr
      unique_id: teslamate_1_tpms_rr
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/tpms_pressure_rr"
      unit_of_measurement: bar
      icon: mdi:car-tire-alert

    # Car 2
    - name: Display Name
      object_id: tesla_display_name  # entity_id
      unique_id: teslamate_2_display_name  # internal id, used for device grouping
      availability: &teslamate_availability_2
        - topic: teslamate/cars/2/healthy
          payload_available: "true"
          payload_not_available: "false"
      device: &teslamate_device_info_2
        identifiers: [teslamate_car_2]
        configuration_url: !secret teslamate_url
        manufacturer: Tesla
        model: Model 3
        name: Tesla Model 3
      state_topic: "teslamate/cars/2/display_name"
      icon: mdi:car
    - name: State
      object_id: tesla_state
      unique_id: teslamate_2_state
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/state"
      icon: mdi:car-connected
    - name: Since
      object_id: tesla_since
      unique_id: teslamate_2_since
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/since"
      device_class: timestamp
      icon: mdi:clock-outline
    - name: Version
      object_id: tesla_version
      unique_id: teslamate_2_version
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/version"
      icon: mdi:alphabetical
    - name: Update Version
      object_id: tesla_update_version
      unique_id: teslamate_2_update_version
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/update_version"
      icon: mdi:alphabetical
    - name: Model
      object_id: tesla_model
      unique_id: teslamate_2_model
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/model"
    - name: Trim Badging
      object_id: tesla_trim_badging
      unique_id: teslamate_2_trim_badging
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/trim_badging"
      icon: mdi:shield-star-outline
    - name: Exterior Color
      object_id: tesla_exterior_color
      unique_id: teslamate_2_exterior_color
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/exterior_color"
      icon: mdi:palette
    - name: Wheel Type
      object_id: tesla_wheel_type
      unique_id: teslamate_2_wheel_type
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/wheel_type"
    - name: Spoiler Type
      object_id: tesla_spoiler_type
      unique_id: teslamate_2_spoiler_type
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/spoiler_type"
      icon: mdi:car-sports
    - name: Geofence
      object_id: tesla_geofence
      unique_id: teslamate_2_geofence
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/geofence"
      icon: mdi:earth
    - name: Latitude
      object_id: tesla_latitude
      unique_id: teslamate_2_latitude
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/latitude"
      unit_of_measurement: Â°
      icon: mdi:crosshairs-gps
    - name: Longitude
      object_id: tesla_longitude
      unique_id: teslamate_2_longitude
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/longitude"
      unit_of_measurement: Â°
      icon: mdi:crosshairs-gps
    - name: Shift State
      object_id: tesla_shift_state
      unique_id: teslamate_2_shift_state
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/shift_state"
      icon: mdi:car-shift-pattern
    - name: Power
      object_id: tesla_power
      unique_id: teslamate_2_power
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/power"
      device_class: power
      unit_of_measurement: kW
      icon: mdi:flash
    - name: Speed
      object_id: tesla_speed
      unique_id: teslamate_2_speed
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/speed"
      unit_of_measurement: "km/h"
      icon: mdi:speedometer
    - name: Heading
      object_id: tesla_heading
      unique_id: teslamate_2_heading
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/heading"
      unit_of_measurement: Â°
      icon: mdi:compass
    - name: Elevation
      object_id: tesla_elevation
      unique_id: teslamate_2_elevation
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/elevation"
      unit_of_measurement: m
      icon: mdi:image-filter-hdr
    - name: Inside Temp
      object_id: tesla_inside_temp
      unique_id: teslamate_2_inside_temp
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/inside_temp"
      device_class: temperature
      unit_of_measurement: Â°C
      icon: mdi:thermometer-lines
    - name: Outside Temp
      object_id: tesla_outside_temp
      unique_id: teslamate_2_outside_temp
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/outside_temp"
      device_class: temperature
      unit_of_measurement: Â°C
      icon: mdi:thermometer-lines
    - name: Odometer
      object_id: tesla_odometer
      unique_id: teslamate_2_odometer
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/odometer"
      unit_of_measurement: km
      icon: mdi:counter
    - name: Est Battery Range
      object_id: tesla_est_battery_range_km
      unique_id: teslamate_2_est_battery_range_km
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/est_battery_range_km"
      unit_of_measurement: km
      icon: mdi:gauge
    - name: Rated Battery Range
      object_id: tesla_rated_battery_range_km
      unique_id: teslamate_2_rated_battery_range_km
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/rated_battery_range_km"
      unit_of_measurement: km
      icon: mdi:gauge
    - name: Ideal Battery Range
      object_id: tesla_ideal_battery_range_km
      unique_id: teslamate_2_ideal_battery_range_km
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/ideal_battery_range_km"
      unit_of_measurement: km
      icon: mdi:gauge
    - name: Battery Level
      object_id: tesla_battery_level
      unique_id: teslamate_2_battery_level
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/battery_level"
      device_class: battery
      unit_of_measurement: "%"
      icon: mdi:battery-80
    - name: Usable Battery Level
      object_id: tesla_usable_battery_level
      unique_id: teslamate_2_usable_battery_level
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/usable_battery_level"
      unit_of_measurement: "%"
      icon: mdi:battery-80
    - name: Charge Energy Added
      object_id: tesla_charge_energy_added
      unique_id: teslamate_2_charge_energy_added
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/charge_energy_added"
      device_class: energy
      unit_of_measurement: kWh
      icon: mdi:battery-charging
    - name: Charge Limit Soc
      object_id: tesla_charge_limit_soc
      unique_id: teslamate_2_charge_limit_soc
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/charge_limit_soc"
      unit_of_measurement: "%"
      icon: mdi:battery-charging-100
    - name: Charger Actual Current
      object_id: tesla_charger_actual_current
      unique_id: teslamate_2_charger_actual_current
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/charger_actual_current"
      device_class: current
      unit_of_measurement: A
      icon: mdi:lightning-bolt
    - name: Charger Phases
      object_id: tesla_charger_phases
      unique_id: teslamate_2_charger_phases
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/charger_phases"
      icon: mdi:sine-wave
    - name: Charger Power
      object_id: tesla_charger_power
      unique_id: teslamate_2_charger_power
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/charger_power"
      device_class: power
      unit_of_measurement: kW
      icon: mdi:lightning-bolt
    - name: Charger Voltage
      object_id: tesla_charger_voltage
      unique_id: teslamate_2_charger_voltage
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/charger_voltage"
      device_class: voltage
      unit_of_measurement: V
      icon: mdi:lightning-bolt
    - name: Scheduled Charging Start Time
      object_id: tesla_scheduled_charging_start_time
      unique_id: teslamate_2_scheduled_charging_start_time
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/scheduled_charging_start_time"
      device_class: timestamp
      icon: mdi:clock-outline
    - name: Time To Full Charge
      object_id: tesla_time_to_full_charge
      unique_id: teslamate_2_time_to_full_charge
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/time_to_full_charge"
      unit_of_measurement: h
      icon: mdi:clock-outline
    - name: TPMS Pressure Front Left
      object_id: tesla_tpms_fl
      unique_id: teslamate_2_tpms_fl
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/tpms_pressure_fl"
      unit_of_measurement: bar
      icon: mdi:car-tire-alert
    - name: TPMS Pressure Front Right
      object_id: tesla_tpms_fr
      unique_id: teslamate_2_tpms_fr
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/tpms_pressure_fr"
      unit_of_measurement: bar
      icon: mdi:car-tire-alert
    - name: TPMS Pressure Rear Left
      object_id: tesla_tpms_rl
      unique_id: teslamate_2_tpms_rl
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/tpms_pressure_rl"
      unit_of_measurement: bar
      icon: mdi:car-tire-alert
    - name: TPMS Pressure Rear Right
      object_id: tesla_tpms_rr
      unique_id: teslamate_2_tpms_rr
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/tpms_pressure_rr"
      unit_of_measurement: bar
      icon: mdi:car-tire-alert

  binary_sensor:
    - name: Healthy
      object_id: tesla_healthy
      unique_id: teslamate_1_healthy
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/healthy"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:heart-pulse

    - name: Update Available
      object_id: tesla_update_available
      unique_id: teslamate_1_update_available
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/update_available"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:alarm

    - name: Locked
      object_id: tesla_locked
      unique_id: teslamate_1_locked
      availability: *teslamate_availability
      device: *teslamate_device_info
      device_class: lock
      state_topic: "teslamate/cars/1/locked"
      payload_on: "false"
      payload_off: "true"

    - name: Sentry Mode
      object_id: tesla_sentry_mode
      unique_id: teslamate_1_sentry_mode
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/sentry_mode"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:cctv

    - name: Windows Open
      object_id: tesla_windows_open
      unique_id: teslamate_1_windows_open
      availability: *teslamate_availability
      device: *teslamate_device_info
      device_class: window
      state_topic: "teslamate/cars/1/windows_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:car-door

    - name: Doors Open
      object_id: tesla_doors_open
      unique_id: teslamate_1_doors_open
      availability: *teslamate_availability
      device: *teslamate_device_info
      device_class: door
      state_topic: "teslamate/cars/1/doors_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:car-door

    - name: Trunk Open
      object_id: tesla_trunk_open
      unique_id: teslamate_1_trunk_open
      availability: *teslamate_availability
      device: *teslamate_device_info
      device_class: opening
      state_topic: "teslamate/cars/1/trunk_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:car-side

    - name: Frunk Open
      object_id: tesla_frunk_open
      unique_id: teslamate_1_frunk_open
      availability: *teslamate_availability
      device: *teslamate_device_info
      device_class: opening
      state_topic: "teslamate/cars/1/frunk_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:car-side

    - name: Is User Present
      object_id: tesla_is_user_present
      unique_id: teslamate_1_is_user_present
      availability: *teslamate_availability
      device: *teslamate_device_info
      device_class: presence
      state_topic: "teslamate/cars/1/is_user_present"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:human-greeting

    - name: Is Climate On
      object_id: tesla_is_climate_on
      unique_id: teslamate_1_is_climate_on
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/is_climate_on"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:fan

    - name: Is Preconditioning
      object_id: tesla_is_preconditioning
      unique_id: teslamate_1_is_preconditioning
      availability: *teslamate_availability
      device: *teslamate_device_info
      state_topic: "teslamate/cars/1/is_preconditioning"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:fan

    - name: Plugged In
      object_id: tesla_plugged_in
      unique_id: teslamate_1_plugged_in
      availability: *teslamate_availability
      device: *teslamate_device_info
      device_class: plug
      state_topic: "teslamate/cars/1/plugged_in"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:ev-station

    - name: Charge Port Door OPEN
      object_id: tesla_charge_port_door_open
      unique_id: teslamate_1_charge_port_door_open
      availability: *teslamate_availability
      device: *teslamate_device_info
      device_class: opening
      state_topic: "teslamate/cars/1/charge_port_door_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:ev-plug-tesla
    # Car 2
    - name: Healthy
      object_id: tesla_healthy
      unique_id: teslamate_2_healthy
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/healthy"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:heart-pulse

    - name: Update Available
      object_id: tesla_update_available
      unique_id: teslamate_2_update_available
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/update_available"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:alarm

    - name: Locked
      object_id: tesla_locked
      unique_id: teslamate_2_locked
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      device_class: lock
      state_topic: "teslamate/cars/2/locked"
      payload_on: "false"
      payload_off: "true"

    - name: Sentry Mode
      object_id: tesla_sentry_mode
      unique_id: teslamate_2_sentry_mode
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/sentry_mode"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:cctv

    - name: Windows Open
      object_id: tesla_windows_open
      unique_id: teslamate_2_windows_open
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      device_class: window
      state_topic: "teslamate/cars/2/windows_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:car-door

    - name: Doors Open
      object_id: tesla_doors_open
      unique_id: teslamate_2_doors_open
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      device_class: door
      state_topic: "teslamate/cars/2/doors_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:car-door

    - name: Trunk Open
      object_id: tesla_trunk_open
      unique_id: teslamate_2_trunk_open
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      device_class: opening
      state_topic: "teslamate/cars/2/trunk_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:car-side

    - name: Frunk Open
      object_id: tesla_frunk_open
      unique_id: teslamate_2_frunk_open
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      device_class: opening
      state_topic: "teslamate/cars/2/frunk_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:car-side

    - name: Is User Present
      object_id: tesla_is_user_present
      unique_id: teslamate_2_is_user_present
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      device_class: presence
      state_topic: "teslamate/cars/2/is_user_present"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:human-greeting

    - name: Is Climate On
      object_id: tesla_is_climate_on
      unique_id: teslamate_2_is_climate_on
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/is_climate_on"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:fan

    - name: Is Preconditioning
      object_id: tesla_is_preconditioning
      unique_id: teslamate_2_is_preconditioning
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      state_topic: "teslamate/cars/2/is_preconditioning"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:fan

    - name: Plugged In
      object_id: tesla_plugged_in
      unique_id: teslamate_2_plugged_in
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      device_class: plug
      state_topic: "teslamate/cars/2/plugged_in"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:ev-station

    - name: Charge Port Door OPEN
      object_id: tesla_charge_port_door_open
      unique_id: teslamate_2_charge_port_door_open
      availability: *teslamate_availability_2
      device: *teslamate_device_info_2
      device_class: opening
      state_topic: "teslamate/cars/2/charge_port_door_open"
      payload_on: "true"
      payload_off: "false"
      icon: mdi:ev-plug-tesla

script:
  tesla_notify_low_electricity_rates:
    alias: Tesla Notify Low Electricity Rates
    description: ""
    fields:
      current_electricity_import_rate:
        description: Pounds per kiloWatt for importing.
        example: "0.15"
        selector:
          number:
            min: -15
            max: 100
            step: 2
    sequence:
      - variables:
          current_import_rate: "{{ current_electricity_import_rate|default(states('sensor.octopus_energy_electricity_current_rate'), true) }}"
      - choose:
          - alias: Rates Below 0p/kW
            conditions:
              - condition: template
                value_template: "{{ current_import_rate < 0}}"
              - condition: state
                entity_id: device_tracker.tesla_2
                state: "home"
            sequence:
              - action: script.send_direct_notification
                data:
                  message: >-
                    Car is not plugged in and electricity rates are below 0p/kWh ({{ states('sensor.octopus_energy_electricity_current_rate') }}).

                    Your car is {{ states('sensor.model_y_battery', with_unit=True) }} charged.
                  title: "Tesla"
                  people:
                    entity_id:
                      - person.terina
          - alias: Rates Cost Nothing
            conditions:
              - condition: template
                value_template: "{{ current_import_rate == 0}}"
              - condition: state
                entity_id: device_tracker.tesla_2
                state: "home"
            sequence:
              - action: script.send_direct_notification
                data:
                  message: >-
                    Car is not plugged in and electricity rates is {{ states('sensor.octopus_energy_electricity_current_rate', with_unit=True) }}.

                    Your car is {{ states('sensor.model_y_battery', with_unit=True) }} charged.
                  title: "Tesla"
                  people:
                    entity_id:
                      - person.terina
          - alias: Cheap Rates And Near Home
            conditions:
              - condition: template
                value_template: "{{ current_import_rate <= 0}}"
              - condition: state
                entity_id: device_tracker.tesla_2
                state: "not_home"
              - condition: numeric_state
                entity_id: sensor.tesla_model_y_home_location_tracker_distance
                below: 5000
            sequence:
              - action: script.send_direct_notification
                data:
                  message: >-
                    Electricity rates is or below 0p/kWh ({{ states('sensor.octopus_energy_electricity_current_rate', with_unit=True) }}).

                    You're close to home ({{ states('sensor.tesla_model_y_home_location_tracker_distance') }}
                    < 5000m) so this is a FYI.

                    Your car is {{ states('sensor.model_y_battery', with_unit=True) }} charged.
                  title: "Tesla"
                  people:
                    entity_id:
                      - person.terina
        default: []
    mode: single

template:
  - trigger:
      - trigger: state
        entity_id:
          - sensor.tesla_charger_power
          - switch.model_y_charger
    binary_sensor:
      - name: "Tesla Charging"
        unique_id: 38c00574-6feb-4712-8089-24f84291ad69
        state: >-
          {{ states('sensor.tesla_charger_power')|float(0) > 0 or states('switch.model_y_charger') == 'off' }}
        availability: >-
          {{ states('sensor.tesla_charger_power')|is_number and states('switch.model_y_charger') != 'unavailable' }}
  # Car 2
  - trigger:
      - trigger: state
        entity_id:
          - sensor.tesla_charger_power_2
          - switch.model_3_charger
    binary_sensor:
      - name: "Tesla Charging"
        unique_id: 6389f66e-f7ce-4b3e-9b41-e006c4f713ea
        state: >-
          {{ states('sensor.tesla_charger_power_2')|float(0) > 0 or states('switch.model_3_charger') == 'off' }}
        availability: >-
          {{ states('sensor.tesla_charger_power_2')|is_number and states('switch.model_3_charger') != 'unavailable' }}
  # Teslamate
  - binary_sensor:
      # Car 1
      - name: Parking Brake
        state: >-
          {% if is_state('sensor.tesla_shift_state', 'P') %}
            ON
          {% else %}
            OFF
          {% endif %}
        unique_id: tesla_park_brake
        icon: mdi:car-brake-parking
      # Car 2
      - name: Parking Brake
        state: >-
          {% if is_state('sensor.tesla_shift_state_2', 'P') %}
            ON
          {% else %}
            OFF
          {% endif %}
        unique_id: tesla_park_brake
        icon: mdi:car-brake-parking
  - sensor:
      # Car 1
      - name: Estimated Range (mi)
        unique_id: tesla_est_battery_range_mi
        state: >
          {{ (states('sensor.tesla_est_battery_range_km')|float / 1.609344)|round(2) }}
        unit_of_measurement: mi
        availability: >-
          {{ states('sensor.tesla_est_battery_range_km')|is_number }}
        icon: mdi:gauge
      - name: Rated Range (mi)
        unique_id: tesla_rated_battery_range_mi
        state: >
          {{ (states('sensor.tesla_rated_battery_range_km')|float / 1.609344)|round(2) }}
        unit_of_measurement: mi
        availability: >-
          {{ states('sensor.tesla_rated_battery_range_km')|is_number }}
        icon: mdi:gauge
      - name: Ideal Range (mi)
        unique_id: tesla_ideal_battery_range_mi
        state: >
          {{ (states('sensor.tesla_ideal_battery_range_km')|float / 1.609344)|round(2) }}
        unit_of_measurement: mi
        availability: >-
          {{ states('sensor.tesla_ideal_battery_range_km')|is_number }}
        icon: mdi:gauge
      - name: Odometer (mi)
        unique_id: tesla_odometer_mi
        state: >
          {{ (states('sensor.tesla_odometer')|float / 1.609344)|round(2) }}
        unit_of_measurement: mi
        availability: >-
          {{ states('sensor.tesla_odometer')|is_number }}
        icon: mdi:counter
      - name: Speed (MPH)
        unique_id: tesla_speed_mph
        state: >
          {{ (states('sensor.tesla_speed')|float / 1.609344)|round(2) }}
        unit_of_measurement: mph
        availability: >-
          {{ states('sensor.tesla_speed')|is_number }}
        icon: mdi:speedometer
      - name: Elevation (ft)
        icon: mdi:image-filter-hdr
        state: >
          {{ (states('sensor.tesla_elevation')|float * 3.2808 )|round(2) }}
        unique_id: tesla_elevation_ft
        unit_of_measurement: ft
        availability: >-
          {{ states('sensor.tesla_elevation')|is_number }}
      # Tyres (Bar)
      - name: Front Left Tyre Pressure (bar)
        unique_id: tesla_tpms_pressure_fl_bar
        state: >
          {{ (states('sensor.tesla_tpms_fl')|float(0))|round(2) }}
        unit_of_measurement: bar
        availability: >-
          {{ states('sensor.tesla_tpms_fl')|is_number }}
        icon: mdi:car-tire-alert
      - name: Front Right Tyre Pressure (bar)
        unique_id: tesla_tpms_pressure_fr_bar
        state: >
          {{ (states('sensor.tesla_tpms_fr')|float(0))|round(2) }}
        unit_of_measurement: bar
        availability: >-
          {{ states('sensor.tesla_tpms_fr')|is_number }}
        icon: mdi:car-tire-alert
      - name: Rear Left Tyre Pressure (bar)
        unique_id: tesla_tpms_pressure_rl_bar
        state: >
          {{ (states('sensor.tesla_tpms_rl')|float(0))|round(2) }}
        unit_of_measurement: bar
        availability: >-
          {{ states('sensor.tesla_tpms_rl')|is_number }}
        icon: mdi:car-tire-alert
      - name: Rear Right Tyre Pressure (bar)
        unique_id: tesla_tpms_pressure_rr_bar
        state: >
          {{ (states('sensor.tesla_tpms_rr')|float(0))|round(2) }}
        unit_of_measurement: bar
        availability: >-
          {{ states('sensor.tesla_tpms_rr')|is_number }}
        icon: mdi:car-tire-alert
      # Tyres (PSI)
      - name: Front Left Tyre Pressure (psi)
        unique_id: tesla_tpms_pressure_fl_psi
        state: >
          {{ (states('sensor.tesla_tpms_fl')|float(0) * 14.50377)|round(2) }}
        unit_of_measurement: psi
        availability: >-
          {{ states('sensor.tesla_tpms_fl')|is_number }}
        icon: mdi:car-tire-alert
      - name: Front Right Tyre Pressure (psi)
        unique_id: tesla_tpms_pressure_fr_psi
        state: >
          {{ (states('sensor.tesla_tpms_fr')|float(0) * 14.50377)|round(2) }}
        unit_of_measurement: psi
        availability: >-
          {{ states('sensor.tesla_tpms_fr')|is_number }}
        icon: mdi:car-tire-alert
      - name: Rear Left Tyre Pressure (psi)
        unique_id: tesla_tpms_pressure_rl_psi
        state: >
          {{ (states('sensor.tesla_tpms_rl')|float(0) * 14.50377)|round(2) }}
        unit_of_measurement: psi
        availability: >-
          {{ states('sensor.tesla_tpms_rl')|is_number }}
        icon: mdi:car-tire-alert
      - name: Rear Right Tyre Pressure (psi)
        unique_id: tesla_tpms_pressure_rr_psi
        state: >
          {{ (states('sensor.tesla_tpms_rr')|float(0) * 14.50377)|round(2) }}
        unit_of_measurement: psi
        availability: >-
          {{ states('sensor.tesla_tpms_rr')|is_number }}
        icon: mdi:car-tire-alert
      # Car 2
      - name: Estimated Range (mi)
        unique_id: tesla_est_battery_range_mi
        state: >
          {{ (states('sensor.tesla_est_battery_range_km_2')|float / 1.609344)|round(2) }}
        unit_of_measurement: mi
        availability: >-
          {{ states('sensor.tesla_est_battery_range_km_2')|is_number }}
        icon: mdi:gauge
      - name: Rated Range (mi)
        unique_id: tesla_rated_battery_range_mi
        state: >
          {{ (states('sensor.tesla_rated_battery_range_km_2')|float / 1.609344)|round(2) }}
        unit_of_measurement: mi
        availability: >-
          {{ states('sensor.tesla_rated_battery_range_km_2')|is_number }}
        icon: mdi:gauge
      - name: Ideal Range (mi)
        unique_id: tesla_ideal_battery_range_mi
        state: >
          {{ (states('sensor.tesla_ideal_battery_range_km_2')|float / 1.609344)|round(2) }}
        unit_of_measurement: mi
        availability: >-
          {{ states('sensor.tesla_ideal_battery_range_km_2')|is_number }}
        icon: mdi:gauge
      - name: Odometer (mi)
        unique_id: tesla_odometer_mi
        state: >
          {{ (states('sensor.tesla_odometer_2')|float / 1.609344)|round(2) }}
        unit_of_measurement: mi
        availability: >-
          {{ states('sensor.tesla_odometer_2')|is_number }}
        icon: mdi:counter
      - name: Speed (MPH)
        unique_id: tesla_speed_mph
        state: >
          {{ (states('sensor.tesla_speed_2')|float / 1.609344)|round(2) }}
        unit_of_measurement: mph
        availability: >-
          {{ states('sensor.tesla_speed_2')|is_number }}
        icon: mdi:speedometer
      - name: Elevation (ft)
        icon: mdi:image-filter-hdr
        state: >
          {{ (states('sensor.tesla_elevation_2')|float * 3.2808 )|round(2) }}
        unique_id: tesla_elevation_ft
        unit_of_measurement: ft
        availability: >-
          {{ states('sensor.tesla_elevation_2')|is_number }}
      # Tyres (Bar)
      - name: Front Left Tyre Pressure (bar)
        unique_id: tesla_tpms_pressure_fl_bar
        state: >
          {{ (states('sensor.tesla_tpms_fl_2')|float(0))|round(2) }}
        unit_of_measurement: bar
        availability: >-
          {{ states('sensor.tesla_tpms_fl_2')|is_number }}
        icon: mdi:car-tire-alert
      - name: Front Right Tyre Pressure (bar)
        unique_id: tesla_tpms_pressure_fr_bar
        state: >
          {{ (states('sensor.tesla_tpms_fr_2')|float(0))|round(2) }}
        unit_of_measurement: bar
        availability: >-
          {{ states('sensor.tesla_tpms_fr_2')|is_number }}
        icon: mdi:car-tire-alert
      - name: Rear Left Tyre Pressure (bar)
        unique_id: tesla_tpms_pressure_rl_bar
        state: >
          {{ (states('sensor.tesla_tpms_rl_2')|float(0))|round(2) }}
        unit_of_measurement: bar
        availability: >-
          {{ states('sensor.tesla_tpms_rl_2')|is_number }}
        icon: mdi:car-tire-alert
      - name: Rear Right Tyre Pressure (bar)
        unique_id: tesla_tpms_pressure_rr_bar
        state: >
          {{ (states('sensor.tesla_tpms_rr_2')|float(0))|round(2) }}
        unit_of_measurement: bar
        availability: >-
          {{ states('sensor.tesla_tpms_rr_2')|is_number }}
        icon: mdi:car-tire-alert
      # Tyres (PSI)
      - name: Front Left Tyre Pressure (psi)
        unique_id: tesla_tpms_pressure_fl_psi
        state: >
          {{ (states('sensor.tesla_tpms_fl_2')|float(0) * 14.50377)|round(2) }}
        unit_of_measurement: psi
        availability: >-
          {{ states('sensor.tesla_tpms_fl_2')|is_number }}
        icon: mdi:car-tire-alert
      - name: Front Right Tyre Pressure (psi)
        unique_id: tesla_tpms_pressure_fr_psi
        state: >
          {{ (states('sensor.tesla_tpms_fr_2')|float(0) * 14.50377)|round(2) }}
        unit_of_measurement: psi
        availability: >-
          {{ states('sensor.tesla_tpms_fr_2')|is_number }}
        icon: mdi:car-tire-alert
      - name: Rear Left Tyre Pressure (psi)
        unique_id: tesla_tpms_pressure_rl_psi
        state: >
          {{ (states('sensor.tesla_tpms_rl_2')|float(0) * 14.50377)|round(2) }}
        unit_of_measurement: psi
        availability: >-
          {{ states('sensor.tesla_tpms_rl_2')|is_number }}
        icon: mdi:car-tire-alert
      - name: Rear Right Tyre Pressure (psi)
        unique_id: tesla_tpms_pressure_rr_psi
        state: >
          {{ (states('sensor.tesla_tpms_rr_2')|float(0) * 14.50377)|round(2) }}
        unit_of_measurement: psi
        availability: >-
          {{ states('sensor.tesla_tpms_rr_2')|is_number }}
        icon: mdi:car-tire-alert
