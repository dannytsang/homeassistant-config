# Created by Danny Tsang <danny@tsang.uk>
automation:
  # Echo: Leo's Bedroom
  - id: "1612998168529"
    alias: "^Leo's Bedroom: Echo Playing"
    description: ""
    trigger:
      - platform: state
        entity_id: media_player.leos_bedroom
        to: playing
    condition: []
    action:
      - choose:
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('media_player.leos_bedroom','media_position') !=
                  none and
                  state_attr('media_player.leos_bedroom','media_duration') !=
                  none and
                  state_attr('media_player.leos_bedroom','media_title') !=
                  none and
                  state_attr('media_player.leos_bedroom','media_artist') !=
                  none }}
            sequence:
              - service: script.post_to_home_log
                data:
                  message:
                    ":radio: Echo office playing *{{ state_attr('media_player.leos_bedroom',
                    'media_title') }}* by _{{ state_attr('media_player.leos_bedroom',
                    'media_artist') }}_ and is at {{ state_attr('media_player.leos_bedroom','media_position') |
                    int | timestamp_custom('%H:%M:%S') }}/{{ state_attr('media_player.leos_bedroom','media_duration') |
                    int | timestamp_custom('%H:%M:%S') }} ({{ ((state_attr('media_player.leos_bedroom',
                    'media_position') | int / state_attr('media_player.leos_bedroom',
                    'media_duration') | int) * 100) | round(2, 'common') }}%) way through."
        default:
          - service: script.post_to_home_log
            data:
              message:
                ":radio: Echo office playing *{{ state_attr('media_player.leos_bedroom',
                'media_content_type') }}*."
    mode: queued
    max: 10
  # Echo: Office
  - id: "1612998168528"
    alias: "^Office: Echo Status Change"
    description: ""
    trigger:
      - platform: state
        entity_id: media_player.office_echo
    condition: []
    action:
      - choose:
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('media_player.office_echo','media_position') !=
                  none or
                  state_attr('media_player.office_echo','media_duration') !=
                  none or
                  state_attr('media_player.office_echo','media_title') !=
                  none or
                  state_attr('media_player.office_echo','media_artist') !=
                  none }}
            sequence:
              - service: script.post_to_home_log
                data:
                  message:
                    ":radio: Echo office {{ states('media_player.office_echo') }}
                    *{% if state_attr('media_player.office_echo','media_title') != none %}by _{{ state_attr('media_player.office_echo', 'media_title') }}_{% endif %}*
                    {% if state_attr('media_player.office_echo','media_artist') != none %}by _{{ state_attr('media_player.office_echo', 'media_artist') }}_{% endif %}
                    {% if state_attr('media_player.office_echo','media_position') != none and state_attr('media_player.office_echo','media_duration') != none %}
                    and is at {{ state_attr('media_player.office_echo','media_position') |
                    int | timestamp_custom('%H:%M:%S') }}/{{ state_attr('media_player.office_echo','media_duration') |
                    int | timestamp_custom('%H:%M:%S') }} ({{ ((state_attr('media_player.office_echo',
                    'media_position') | int / state_attr('media_player.office_echo',
                    'media_duration') | int) * 100) | round(2, 'common') }}%) the way through.
                    {% elif state_attr('media_player.office_echo','media_position') != none %}
                    and is at {{ state_attr('media_player.office_echo','media_position') |
                    int | timestamp_custom('%H:%M:%S') }} the way through.
                    {% endif %}"
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('media_player.office_echo','media_content_type') !=
                  none }}
            sequence:
              - service: script.post_to_home_log
                data:
                  message:
                    ":radio: Echo office {{ state('media_player.office_echo') }}
                    *{{ state_attr('media_player.office_echo', 'media_content_type') }}*."
        default:
          - service: script.post_to_home_log
            data:
              message: ":radio: Echo office {{ state('media_player.office_echo') }}."
    mode: queued
    max: 10
